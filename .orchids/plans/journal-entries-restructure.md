# ุฅุนุงุฏุฉ ููููุฉ ูุธุงู ุงููููุฏ ุงูููููุฉ - Premium Journal Entries System

## Requirements
ุฅุนุงุฏุฉ ููููุฉ ูุงููุฉ ููุธุงู ุงููููุฏ ุงูููููุฉ ููุตุจุญ ูุธุงููุง ูุงุฎุฑูุง ููุชูุงููุงู ูุดูู:
- **ูุตู ุจูุงูุงุช ุงูุดุฑูุงุช**: ุฑุจุท ูู ููุฏ ุจุดุฑูุฉ ุงููุณุชุฎุฏู ุงููุณุฌู ุฏุฎูู
- **ุดุฌุฑุฉ ุงูุญุณุงุจุงุช ููุฑุงูุฒ ุงูุชูููุฉ**: ุฏูุฌ ูุงูู ูู ุงูุฅุถุงูุฉ ูุงูุชุนุฏูู ูุงูุนุฑุถ
- **ุฅุดุนุงุฑุงุช ูุงุฎุฑุฉ**: ููุญุฐู ูุงูุชุนุฏูู ูุงูุญูุธ
- **ูุธุงู ููุงููุงุช**: (ุจุณูุท) - ูุณูุฏุฉ / ูุนุชูุฏ
- **ูุงุฌูุฉ ูุณุชุฎุฏู Premium**: ุชุตููู ูุงุฎุฑ ูุชูุงุณุจ ูุน ุจุงูู ุงููุธุงู

## Current State Analysis

### ุงููุดุงูู ุงูุญุงููุฉ:
1. **ูุดููุฉ ุนุฒู ุงูุจูุงูุงุช**: `const companyId = searchParams.get("company_id") || "1";` - ูุณุชุฎุฏู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ "1" ุจุฏูุงู ูู ุฌูุณุฉ ุงููุณุชุฎุฏู
2. **ุนุฏู ุชูุฑูุฑ company_id ูู ุงูุฎุงุฏู**: ุตูุญุฉ `page.tsx` ูุง ุชูุฑุฑ companyId ูู ุงูุฌูุณุฉ
3. **ูุงุฌูุฉ ุงููุณุชุฎุฏู ุจุณูุทุฉ**: ูุง ุชุชูุงุณุจ ูุน ุงูุชุตููู ุงููุงุฎุฑ ูุจุงูู ุงูุตูุญุงุช
4. **ููุต ูู ุงููููุฒุงุช**: ูุง ููุฌุฏ ููุชุฑ ุจุงูุชุงุฑูุฎุ ุชุตุฏูุฑ CSVุ ุฅุญุตุงุฆูุงุชุ ุฑุณูู ุจูุงููุฉ

### ุงููููุงุช ุงูุญุงููุฉ:
- `app/(dashboard)/journal-entries/page.tsx` - ุตูุญุฉ ุจุณูุทุฉ ุจุฏูู ุฌูุจ company_id
- `app/(dashboard)/journal-entries/journal-entries-client.tsx` - ุงูุนููู ุงูุญุงูู
- `app/api/journal-entries/metadata/route.ts` - ุฌูุจ ุงูุจูุงูุงุช ุงููุตููุฉ
- `app/api/journal-entries/save/route.ts` - ุญูุธ ุงููููุฏ
- `app/api/journal-entries/delete/route.ts` - ุญุฐู ุงููููุฏ

## Implementation Phases

### Phase 1: ุฅุตูุงุญ ุนุฒู ุจูุงูุงุช ุงูุดุฑูุงุช

**1.1 ุชุนุฏูู `app/(dashboard)/journal-entries/page.tsx`:**
```typescript
// ุฅุถุงูุฉ ุฌูุจ session.company_id ูู ุงูููููุฒ
// ุชูุฑูุฑ companyId ู companyInfo ููุนููู
// ููุณ ุงูููุท ุงููุณุชุฎุฏู ูู income-statement ู general-ledger
```

**1.2 ุชุนุฏูู `journal-entries-client.tsx`:**
- ุฅุฒุงูุฉ `useSearchParams` ูุงุณุชุฎุฏุงู props ุจุฏูุงู ููู
- ุงุณุชูุจุงู `companyId` ู `companyInfo` ูู props

### Phase 2: ุฅุนุงุฏุฉ ูุชุงุจุฉ API ุงูุฎุงุต ุจุงููููุฏ

**2.1 ุฅูุดุงุก `app/api/journal-entries/route.ts` (GET):**
- ุฌูุจ ุฌููุน ุงููููุฏ ูุน ุงูููุชุฑุฉ
- ููุชุฑ ุญุณุจ ุงูุชุงุฑูุฎ (from_date, to_date)
- ููุชุฑ ุญุณุจ ููุน ุงููุตุฏุฑ (source_type)
- ููุชุฑ ุญุณุจ ุงูุญุงูุฉ (status)
- ุงูุจุญุซ ูู ุงููุตู ูุฑูู ุงูููุฏ
- ุฅุญุตุงุฆูุงุช (totalDebit, totalCredit, entriesCount)
- ุจูุงูุงุช ุงูุฑุณูู ุงูุจูุงููุฉ (monthly trend)

**2.2 ุชุญุฏูุซ `app/api/journal-entries/save/route.ts`:**
- ุฅุถุงูุฉ ุญูู `status` (draft/approved)
- ุฅุถุงูุฉ `created_at` ู `updated_at`
- ุงูุชุญูู ูู company_id ูู ุงูุฌูุณุฉ
- ุฅุฑุฌุงุน ุจูุงูุงุช ุงูููุฏ ุงููุญููุธ

**2.3 ุชุญุฏูุซ `app/api/journal-entries/delete/route.ts`:**
- ุงูุชุญูู ูู ุฃู ุงูููุฏ ููุชูู ููุดุฑูุฉ ุงูุญุงููุฉ
- ููุน ุญุฐู ุงููููุฏ ุงูุชููุงุฆูุฉ (source_type != manual)

**2.4 ุฅุถุงูุฉ `app/api/journal-entries/approve/route.ts`:**
- ุชุบููุฑ ุญุงูุฉ ุงูููุฏ ูู ูุณูุฏุฉ ุฅูู ูุนุชูุฏ

### Phase 3: ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงููุงุฎุฑุฉ

**3.1 ุงูููุฏุฑ ุงููุงุฎุฑ:**
```tsx
// ุดุฑูุท ุนููู ูุชุฏุฑุฌ ูุน:
// - ุงุณู ุงูุดุฑูุฉ ูุดุนุงุฑูุง
// - ุฑูู ุงูููุฏ ุงูุชุงูู
// - ุนุฏุฏ ุงููููุฏ
// - ุญุงูุฉ ุงูุชูุงุฒู
```

**3.2 ุจุทุงูุงุช ุงูุฅุญุตุงุฆูุงุช (5 ุจุทุงูุงุช):**
- ุฅุฌูุงูู ุงููุฏูู
- ุฅุฌูุงูู ุงูุฏุงุฆู
- ุนุฏุฏ ุงููููุฏ
- ุงููุณูุฏุงุช
- ุงููุนุชูุฏุฉ

**3.3 ุดุฑูุท ุงููุตุงุฏุฑ (Source Tabs):**
```tsx
// tabs: ุงููู | ูุฏูู | ุฑูุงุชุจ | ูุตุฑููุงุช | ููุงุชูุฑ | ุงุณุชูุทุงุนุงุช
// ูุน ุนุฏุฏ ุงููููุฏ ููู ูุตุฏุฑ
```

**3.4 ุดุฑูุท ุงูููุงุชุฑ:**
- ูู ุชุงุฑูุฎ / ุฅูู ุชุงุฑูุฎ
- ุงูุจุญุซ ุงูููุฑู (client-side)
- ููุชุฑ ุงูุญุงูุฉ (ุงููู/ูุณูุฏุฉ/ูุนุชูุฏ)
- ุฒุฑ ุชุจุฏูู ุงูุฑุณูู ุงูุจูุงููุฉ
- ุฒุฑ ุงูุชุตุฏูุฑ CSV
- ุฒุฑ ุงูุทุจุงุนุฉ

**3.5 ุงูุฑุณูู ุงูุจูุงููุฉ (ูุงุจูุฉ ููุฅุฎูุงุก):**
- Bar Chart: ุงูุงุชุฌุงู ุงูุดูุฑู (ูุฏูู vs ุฏุงุฆู)
- Bar Chart: ุฃุนูู ุงูุญุณุงุจุงุช ุญุฑูุฉ

**3.6 ุฌุฏูู ุงููููุฏ ุงูุฑุฆูุณู:**
```tsx
// ุชุตููู ูุงุจู ููุทู (expandable rows)
// ุงูุฃุนูุฏุฉ: ุฑูู ุงูููุฏ | ุงูุชุงุฑูุฎ | ุงููุตู | ุงููุตุฏุฑ | ุงูุญุงูุฉ | ุงููุฏูู | ุงูุฏุงุฆู | ุฅุฌุฑุงุกุงุช
// ุนูุฏ ุงูุชูุณูุน: ุนุฑุถ ุชูุงุตูู ุงูุฃุณุทุฑ
```

**3.7 Modal ุฅูุดุงุก/ุชุนุฏูู ุงูููุฏ:**
- ุชุตููู ูุงุฎุฑ ูุน header ูุชุฏุฑุฌ
- ุงุฎุชูุงุฑ ุงูุญุณุงุจ (HierarchicalSearchableSelect)
- ุงุฎุชูุงุฑ ูุฑูุฒ ุงูุชูููุฉ (HierarchicalSearchableSelect)
- ุฌุฏูู ุงูุฃุณุทุฑ ูุน ุฅุถุงูุฉ/ุญุฐู ุฏููุงูููู
- ุนุฑุถ ุงูุชูุงุฒู ูู ุงูููุช ุงููุนูู
- ุฃุฒุฑุงุฑ: ุฅูุบุงุก | ุญูุธ ููุณูุฏุฉ | ุญูุธ ูุงุนุชูุงุฏ

**3.8 Modal ุงูุชูุงุตูู (ุนูุฏ ุงูููุฑ ุนูู ุฃููููุฉ ุงูุนูู):**
- ุชูุงุตูู ุงูููุฏ ุงููุงููุฉ
- ุฃุณุทุฑ ุงููุฏูู ูุงูุฏุงุฆู
- ูุฑุงูุฒ ุงูุชูููุฉ
- ุชุงุฑูุฎ ุงูุฅูุดุงุก ูุงูุชุนุฏูู
- ุงูููุดุฆ

**3.9 ุฅุดุนุงุฑุงุช Sonner ุงููุงุฎุฑุฉ:**
```tsx
// ูุฌุงุญ ุงูุญูุธ: โ ุชู ุญูุธ ุงูููุฏ ุจูุฌุงุญ
// ูุฌุงุญ ุงูุญุฐู: ๐๏ธ ุชู ุญุฐู ุงูููุฏ
// ูุฌุงุญ ุงูุงุนุชูุงุฏ: โ ุชู ุงุนุชูุงุฏ ุงูููุฏ
// ุฎุทุฃ: โ ูุน ุชูุงุตูู ุงูุฎุทุฃ
// ุชุญุฐูุฑ ุนุฏู ุงูุชูุงุฒู: โ๏ธ ุงูููุฏ ุบูุฑ ูุชูุงุฒู
```

### Phase 4: ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุฅุฐุง ูุฒู ุงูุฃูุฑ)

**4.1 ุงูุชุญูู ูู ุฌุฏูู `journal_entries` ูู Supabase:**
ุงูุญููู ุงููุทููุจุฉ:
- id (serial)
- company_id (integer, FK)
- entry_number (varchar)
- entry_date (date)
- account_id (integer, FK)
- cost_center_id (integer, nullable, FK)
- description (text)
- debit (decimal)
- credit (decimal)
- created_by (varchar)
- source_type (varchar: manual, payroll, expense, invoice, deduction)
- source_id (varchar, nullable)
- status (varchar: draft, approved) - **ุฌุฏูุฏ**
- created_at (timestamp)
- updated_at (timestamp) - **ุฌุฏูุฏ**

### Phase 5: ุฅุถุงูุฉ ุงูุชุฑุฌูุงุช

**5.1 ุชุญุฏูุซ `messages/ar.json`:**
```json
{
  "journalEntries": {
    // ุฅุถุงูุฉ ููุงุชูุญ ุฌุฏูุฏุฉ
    "sources": "ุงููุตุงุฏุฑ",
    "draft": "ูุณูุฏุฉ",
    "approved": "ูุนุชูุฏ",
    "approve": "ุงุนุชูุงุฏ",
    "saveAsDraft": "ุญูุธ ููุณูุฏุฉ",
    "saveAndApprove": "ุญูุธ ูุงุนุชูุงุฏ",
    "fromDate": "ูู ุชุงุฑูุฎ",
    "toDate": "ุฅูู ุชุงุฑูุฎ",
    "applyFilter": "ุชุทุจูู",
    "reset": "ุฅุนุงุฏุฉ ุชุนููู",
    "charts": "ุงูุฑุณูู ุงูุจูุงููุฉ",
    "monthlyTrend": "ุงูุงุชุฌุงู ุงูุดูุฑู",
    "topAccounts": "ุฃุนูู ุงูุญุณุงุจุงุช",
    "exportCsv": "ุชุตุฏูุฑ CSV",
    "print": "ุทุจุงุนุฉ",
    "manual": "ูุฏูู",
    "payroll": "ุฑูุงุชุจ",
    "expense": "ูุตุฑููุงุช",
    "invoice": "ููุงุชูุฑ",
    "deduction": "ุงุณุชูุทุงุนุงุช",
    "entryDetails": "ุชูุงุตูู ุงูููุฏ",
    "approveSuccess": "ุชู ุงุนุชูุงุฏ ุงูููุฏ ุจูุฌุงุญ",
    "cannotDeleteAuto": "ูุง ูููู ุญุฐู ุงููููุฏ ุงูุชููุงุฆูุฉ",
    "cannotEditAuto": "ูุง ูููู ุชุนุฏูู ุงููููุฏ ุงูุชููุงุฆูุฉ",
    "totalDebitLabel": "ุฅุฌูุงูู ุงููุฏูู",
    "totalCreditLabel": "ุฅุฌูุงูู ุงูุฏุงุฆู",
    "draftsCount": "ุงููุณูุฏุงุช",
    "approvedCount": "ุงููุนุชูุฏุฉ"
  }
}
```

**5.2 ุชุญุฏูุซ `messages/en.json`:**
```json
{
  "journalEntries": {
    "sources": "Sources",
    "draft": "Draft",
    "approved": "Approved",
    "approve": "Approve",
    // ... ุจุงูู ุงูุชุฑุฌูุงุช
  }
}
```

## File Changes Summary

| File | Action | Description |
|------|--------|-------------|
| `app/(dashboard)/journal-entries/page.tsx` | Modify | ุฌูุจ company_id ูู ุงูุฌูุณุฉ ูุชูุฑูุฑู |
| `app/(dashboard)/journal-entries/journal-entries-client.tsx` | Rewrite | ูุงุฌูุฉ ูุณุชุฎุฏู ูุงุฎุฑุฉ ุฌุฏูุฏุฉ |
| `app/api/journal-entries/route.ts` | Create | GET endpoint ุฌุฏูุฏ ูุน ุงูููุงุชุฑ |
| `app/api/journal-entries/save/route.ts` | Modify | ุฅุถุงูุฉ status ู timestamps |
| `app/api/journal-entries/delete/route.ts` | Modify | ุงูุชุญูู ูู ุงูุตูุงุญูุงุช |
| `app/api/journal-entries/approve/route.ts` | Create | endpoint ุงุนุชูุงุฏ ุงููููุฏ |
| `messages/ar.json` | Modify | ุฅุถุงูุฉ ุชุฑุฌูุงุช ุฌุฏูุฏุฉ |
| `messages/en.json` | Modify | ุฅุถุงูุฉ ุชุฑุฌูุงุช ุฌุฏูุฏุฉ |

## Dependencies
- `sonner` - ููุฅุดุนุงุฑุงุช ุงููุงุฎุฑุฉ (ููุฌูุฏ)
- `recharts` - ููุฑุณูู ุงูุจูุงููุฉ (ููุฌูุฏ)
- `framer-motion` - ููุญุฑูุงุช (ููุฌูุฏ)
- `lucide-react` - ููุฃููููุงุช (ููุฌูุฏ)
- `@/components/ui/hierarchical-searchable-select` - ูุงุฎุชูุงุฑ ุงูุญุณุงุจุงุช (ููุฌูุฏ)

## Testing Checklist
- [ ] ุงูุชุญูู ูู ุนุฒู ุจูุงูุงุช ุงูุดุฑูุงุช (ูู ุดุฑูุฉ ุชุฑู ูููุฏูุง ููุท)
- [ ] ุฅูุดุงุก ููุฏ ุฌุฏูุฏ (ูุฏูู) โ ูุธูุฑ ูู ุงููุงุฆูุฉ
- [ ] ุชุนุฏูู ููุฏ ูุฏูู โ ุงูุชุบููุฑุงุช ุชูุนูุณ
- [ ] ุญุฐู ููุฏ ูุฏูู โ ูุฎุชูู ูู ุงููุงุฆูุฉ
- [ ] ูุญุงููุฉ ุญุฐู ููุฏ ุชููุงุฆู โ ุฑุณุงูุฉ ุฎุทุฃ
- [ ] ููุชุฑ ุญุณุจ ุงูุชุงุฑูุฎ โ ูุชุงุฆุฌ ุตุญูุญุฉ
- [ ] ููุชุฑ ุญุณุจ ุงููุตุฏุฑ โ ูุชุงุฆุฌ ุตุญูุญุฉ
- [ ] ุงูุจุญุซ ุงูููุฑู โ ูุนูู ุจุฏูู ุชุฃุฎูุฑ
- [ ] ุชุตุฏูุฑ CSV โ ููู ุตุญูุญ
- [ ] ุงูุฑุณูู ุงูุจูุงููุฉ โ ุจูุงูุงุช ุตุญูุญุฉ
- [ ] ุงูุฅุดุนุงุฑุงุช โ ุชุธูุฑ ุจุดูู ุตุญูุญ
- [ ] ุงูุชุตููู RTL โ ูุนูู ุจุดูู ุตุญูุญ

## Estimated Effort
- Phase 1: 30 ุฏูููุฉ
- Phase 2: 1 ุณุงุนุฉ
- Phase 3: 2-3 ุณุงุนุงุช
- Phase 4: 15 ุฏูููุฉ (ุฅุฐุง ูุฒู ุงูุฃูุฑ)
- Phase 5: 20 ุฏูููุฉ

**ุงููุฌููุน: 4-5 ุณุงุนุงุช**
