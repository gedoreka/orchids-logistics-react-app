exports.id=1187,exports.ids=[1187],exports.modules={38366:(a,b,c)=>{"use strict";c.r(b),c.d(b,{"402353f3612f493dc35c33ab5dc018535af568f6d4":()=>z,"4043b9fe51e2af57fbfa1a1206221e04f2abab7464":()=>A,"405182685953fc55b094f39e41536e0d3877b4179a":()=>r,"4072ce4f4db8037adbe6ae4fac76c05b03d13c5dac":()=>u,"4090fe67845a5bb88981b1ac3b7817683ab38b0535":()=>i,"409ae2c9f570e87266d5b9ef4f772e31a2671157c3":()=>x,"409fbba8a242ef1934359c20f4ae91cc625d1d95aa":()=>h,"40d07faa810fc73a14e48c2b636c2ba71c89b86041":()=>B,"40f07e09cac28f56db4c11d57bc6882855eae6c38e":()=>o,"40fbc1309a716a69e6e5ddbc1f37d2b50332fa92fe":()=>g,"600c469eb32f2a94e40318bc5700f3391c91fb6bf2":()=>E,"60161f6e001d117cbc72fd0209f79f7af3fa39fbd8":()=>n,"6017d48f4a0415ccb177dd8e1236d54364bb8fe0dc":()=>l,"60232ddc2e3818b1f4e82c96b46a3d0557a63bddfd":()=>D,"603f759efb6fbea0b10febcc140a98993bf83f587c":()=>w,"604d6802f7836db62eb8b18d33ee3d7ff0df612aad":()=>t,"60b6b2fe646ec12f1dc964da9a12b1db7ef9a5938a":()=>q,"60c2e1a347b7ae1b635dd15072665cc81369fc1f1a":()=>y,"60c2f505af333d38b67142beee3a33f8a9f27667e1":()=>m,"60ce660e0ef5f9a7f1b56eded9c5b0fb94d0762bf2":()=>j,"60eeca6176c0e6977d66c24261753ce1f56c604159":()=>k,"7057322886a3b175514ced6acc8801479976843b68":()=>s,"706519806fac16deac251b9e7482b88b2487f7e399":()=>v,"70882135e32da5170206fe4ae32fbef155b432b9ec":()=>p,"70abde58cb48c24c3671d8427927a7bc7e4e6aedf6":()=>C});var d=c(91488);c(27806);var e=c(67697),f=c(91837);async function g(a){try{await (0,e.P)("INSERT INTO employee_packages (group_name, work_type, monthly_target, bonus_after_target, company_id) VALUES (?, ?, ?, ?, ?)",[a.group_name,a.work_type,a.monthly_target,a.bonus_after_target,a.company_id]);let b=(await (0,e.P)("SELECT LAST_INSERT_ID() as id"))[0].id;if(a.employees&&a.employees.length>0)for(let c of a.employees)c.name&&await (0,e.P)(`INSERT INTO employees (
            name, iqama_number, identity_number, nationality, user_code, 
            phone, email, job_title, basic_salary, housing_allowance, 
            vehicle_plate, iban, package_id, company_id, is_active
          ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 1)`,[c.name,c.iqama_number||null,c.identity_number||null,c.nationality||null,c.user_code||null,c.phone||null,c.email||null,c.job_title||null,c.basic_salary||0,c.housing_allowance||0,c.vehicle_plate||null,c.iban||null,b,a.company_id]);return(0,f.revalidatePath)("/hr"),(0,f.revalidatePath)("/hr/packages"),{success:!0}}catch(a){return console.error("Error creating package with employees:",a),{success:!1,error:a.message}}}async function h(a){try{return await (0,e.P)("INSERT INTO employee_packages (group_name, work_type, monthly_target, bonus_after_target, company_id) VALUES (?, ?, ?, ?, ?)",[a.group_name,a.work_type,a.monthly_target,a.bonus_after_target,a.company_id]),(0,f.revalidatePath)("/hr"),(0,f.revalidatePath)("/hr/packages"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function i(a){try{let b=await (0,e.P)("SELECT COUNT(*) as count FROM employees WHERE package_id = ?",[a]);if(Number(b[0].count)>0)return{success:!1,error:"لا يمكن حذف هذه الباقة لأنها مرتبطة بموظفين."};return await (0,e.P)("DELETE FROM employee_packages WHERE id = ?",[a]),(0,f.revalidatePath)("/hr"),(0,f.revalidatePath)("/hr/packages"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function j(a,b){try{for(let c of b)await (0,e.P)(`INSERT INTO employees (
          name, iqama_number, identity_number, nationality, user_code, 
          phone, email, job_title, basic_salary, housing_allowance, 
          vehicle_plate, iban, package_id, company_id, is_active
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 1)`,[c.name,c.iqama_number||null,c.identity_number||null,c.nationality,c.user_code||null,c.phone||null,c.email||null,c.job_title||null,c.basic_salary,c.housing_allowance||0,c.vehicle_plate||null,c.iban||null,a,c.company_id]);return(0,f.revalidatePath)(`/hr/packages/${a}`),(0,f.revalidatePath)("/hr"),{success:!0,message:"تم حفظ الموظفين بنجاح"}}catch(a){return{success:!1,error:a.message}}}async function k(a,b){try{return await (0,e.P)(`UPDATE employees SET 
        iqama_number = ?, identity_number = ?, job_title = ?, user_code = ?, nationality = ?, 
        phone = ?, email = ?, vehicle_plate = ?, 
        birth_date = ?, passport_number = ?, operation_card_number = ?,
        basic_salary = ?, housing_allowance = ?
      WHERE id = ?`,[b.iqama_number,b.identity_number,b.job_title,b.user_code,b.nationality,b.phone,b.email,b.vehicle_plate,b.birth_date||null,b.passport_number,b.operation_card_number,b.basic_salary,b.housing_allowance,a]),(0,f.revalidatePath)(`/hr/employees/${a}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function l(a,b){try{return await (0,e.P)("UPDATE employees SET bank_account = ?, iban = ?, bank_name = ? WHERE id = ?",[b.bank_account,b.iban,b.bank_name,a]),(0,f.revalidatePath)(`/hr/employees/${a}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function m(a,b){try{return await (0,e.P)("UPDATE employees SET is_active = ? WHERE id = ?",[+(1!==b),a]),(0,f.revalidatePath)("/hr"),(0,f.revalidatePath)("/hr/packages"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function n(a,b){try{return await (0,e.P)("UPDATE employees SET is_frozen = ? WHERE id = ?",[+(1!==b),a]),(0,f.revalidatePath)("/hr/packages"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function o(a){try{return await (0,e.P)("DELETE FROM employees WHERE id = ?",[a]),(0,f.revalidatePath)("/hr"),(0,f.revalidatePath)("/hr/packages"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function p(a,b,c){try{if(!["personal_photo","iqama_file","license_file","vehicle_file","agir_permit_file","work_contract_file","vehicle_operation_card"].includes(b))throw Error("Field not allowed");return await (0,e.P)(`UPDATE employees SET ${b} = ? WHERE id = ?`,[c,a]),(0,f.revalidatePath)(`/hr/employees/${a}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function q(a,b){try{return await (0,e.P)("UPDATE employees SET iqama_expiry = ? WHERE id = ?",[b,a]),(0,f.revalidatePath)("/hr"),(0,f.revalidatePath)("/hr/packages"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function r(a){try{let b=a.violation_amount-a.deducted_amount;return await (0,e.P)(`INSERT INTO employee_violations 
      (employee_id, violation_type, violation_date, violation_amount, deducted_amount, remaining_amount, status, violation_description) 
      VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,[a.employee_id,a.violation_type,a.violation_date,a.violation_amount,a.deducted_amount,b,a.status,a.violation_description]),(0,f.revalidatePath)(`/hr/employees/${a.employee_id}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function s(a,b,c){try{let d=c.violation_amount-c.deducted_amount;return await (0,e.P)(`UPDATE employee_violations SET 
        violation_type = ?, violation_date = ?, violation_amount = ?, 
        deducted_amount = ?, remaining_amount = ?, status = ?, violation_description = ? 
      WHERE id = ?`,[c.violation_type,c.violation_date,c.violation_amount,c.deducted_amount,d,c.status,c.violation_description,a]),(0,f.revalidatePath)(`/hr/employees/${b}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function t(a,b){try{return await (0,e.P)("DELETE FROM employee_violations WHERE id = ?",[a]),(0,f.revalidatePath)(`/hr/employees/${b}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function u(a){try{return await (0,e.P)(`INSERT INTO employee_letters 
      (employee_id, letter_type, start_date, end_date, duration_days, violation_amount, letter_details, document_path) 
      VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,[a.employee_id,a.letter_type,a.start_date,a.end_date,a.duration_days,a.violation_amount,a.letter_details,a.document_path||null]),(0,f.revalidatePath)(`/hr/employees/${a.employee_id}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function v(a,b,c){try{return await (0,e.P)(`UPDATE employee_letters SET 
        letter_type = ?, start_date = ?, end_date = ?, 
        duration_days = ?, violation_amount = ?, letter_details = ? 
      WHERE id = ?`,[c.letter_type,c.start_date,c.end_date,c.duration_days,c.violation_amount,c.letter_details,a]),(0,f.revalidatePath)(`/hr/employees/${b}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function w(a,b){try{return await (0,e.P)("DELETE FROM employee_letters WHERE id = ?",[a]),(0,f.revalidatePath)(`/hr/employees/${b}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function x(a){try{return await (0,e.P)(`INSERT INTO employee_tasks (title, description, assigned_to, company_id, due_date, priority, status, created_by) 
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,[a.title,a.description,a.assigned_to||null,a.company_id,a.due_date,a.priority,a.status,a.created_by]),(0,f.revalidatePath)("/hr/tasks"),(0,f.revalidatePath)("/hr"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function y(a,b){try{return await (0,e.P)("UPDATE employee_tasks SET status = ? WHERE id = ?",[b,a]),(0,f.revalidatePath)("/hr/tasks"),(0,f.revalidatePath)("/hr"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function z(a){try{return await (0,e.P)("DELETE FROM employee_tasks WHERE id = ?",[a]),(0,f.revalidatePath)("/hr/tasks"),(0,f.revalidatePath)("/hr"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function A(a){try{let b=await (0,e.P)("SELECT * FROM employee_bank_accounts WHERE employee_id = ? ORDER BY is_primary DESC, created_at DESC",[a]);return{success:!0,data:b}}catch(a){return{success:!1,error:a.message,data:[]}}}async function B(a){try{return a.is_primary&&await (0,e.P)("UPDATE employee_bank_accounts SET is_primary = false WHERE employee_id = ?",[a.employee_id]),await (0,e.P)(`INSERT INTO employee_bank_accounts (employee_id, bank_name, account_number, iban, is_primary) 
       VALUES (?, ?, ?, ?, ?)`,[a.employee_id,a.bank_name,a.account_number,a.iban,a.is_primary||!1]),(0,f.revalidatePath)(`/hr/employees/${a.employee_id}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function C(a,b,c){try{return c.is_primary&&await (0,e.P)("UPDATE employee_bank_accounts SET is_primary = false WHERE employee_id = ?",[b]),await (0,e.P)("UPDATE employee_bank_accounts SET bank_name = ?, account_number = ?, iban = ?, is_primary = ? WHERE id = ?",[c.bank_name,c.account_number,c.iban,c.is_primary||!1,a]),(0,f.revalidatePath)(`/hr/employees/${b}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function D(a,b){try{return await (0,e.P)("DELETE FROM employee_bank_accounts WHERE id = ?",[a]),(0,f.revalidatePath)(`/hr/employees/${b}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function E(a,b){try{return await (0,e.P)("UPDATE employee_bank_accounts SET is_primary = false WHERE employee_id = ?",[b]),await (0,e.P)("UPDATE employee_bank_accounts SET is_primary = true WHERE id = ?",[a]),(0,f.revalidatePath)(`/hr/employees/${b}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}(0,c(40410).D)([g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E]),(0,d.A)(g,"40fbc1309a716a69e6e5ddbc1f37d2b50332fa92fe",null),(0,d.A)(h,"409fbba8a242ef1934359c20f4ae91cc625d1d95aa",null),(0,d.A)(i,"4090fe67845a5bb88981b1ac3b7817683ab38b0535",null),(0,d.A)(j,"60ce660e0ef5f9a7f1b56eded9c5b0fb94d0762bf2",null),(0,d.A)(k,"60eeca6176c0e6977d66c24261753ce1f56c604159",null),(0,d.A)(l,"6017d48f4a0415ccb177dd8e1236d54364bb8fe0dc",null),(0,d.A)(m,"60c2f505af333d38b67142beee3a33f8a9f27667e1",null),(0,d.A)(n,"60161f6e001d117cbc72fd0209f79f7af3fa39fbd8",null),(0,d.A)(o,"40f07e09cac28f56db4c11d57bc6882855eae6c38e",null),(0,d.A)(p,"70882135e32da5170206fe4ae32fbef155b432b9ec",null),(0,d.A)(q,"60b6b2fe646ec12f1dc964da9a12b1db7ef9a5938a",null),(0,d.A)(r,"405182685953fc55b094f39e41536e0d3877b4179a",null),(0,d.A)(s,"7057322886a3b175514ced6acc8801479976843b68",null),(0,d.A)(t,"604d6802f7836db62eb8b18d33ee3d7ff0df612aad",null),(0,d.A)(u,"4072ce4f4db8037adbe6ae4fac76c05b03d13c5dac",null),(0,d.A)(v,"706519806fac16deac251b9e7482b88b2487f7e399",null),(0,d.A)(w,"603f759efb6fbea0b10febcc140a98993bf83f587c",null),(0,d.A)(x,"409ae2c9f570e87266d5b9ef4f772e31a2671157c3",null),(0,d.A)(y,"60c2e1a347b7ae1b635dd15072665cc81369fc1f1a",null),(0,d.A)(z,"402353f3612f493dc35c33ab5dc018535af568f6d4",null),(0,d.A)(A,"4043b9fe51e2af57fbfa1a1206221e04f2abab7464",null),(0,d.A)(B,"40d07faa810fc73a14e48c2b636c2ba71c89b86041",null),(0,d.A)(C,"70abde58cb48c24c3671d8427927a7bc7e4e6aedf6",null),(0,d.A)(D,"60232ddc2e3818b1f4e82c96b46a3d0557a63bddfd",null),(0,d.A)(E,"600c469eb32f2a94e40318bc5700f3391c91fb6bf2",null)},67697:(a,b,c)=>{"use strict";c.d(b,{P:()=>f,g7:()=>g});let d=c(56275).createPool({host:process.env.DB_HOST,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME,waitForConnections:!0,connectionLimit:10,queueLimit:0,enableKeepAlive:!0,keepAliveInitialDelay:1e4,idleTimeout:6e4,maxIdle:10});async function e(a,b=3){let c;for(let d=0;d<b;d++)try{return await a()}catch(a){if(c=a,("PROTOCOL_CONNECTION_LOST"===a.code||"EPIPE"===a.code||"ECONNRESET"===a.code||!0===a.fatal)&&d<b-1){let a=500*Math.pow(2,d);await new Promise(b=>setTimeout(b,a));continue}throw a}throw c}async function f(a,b=[]){let c=b.map(a=>void 0===a?null:a);return e(async()=>{let[b]=await d.execute(a,c);return b})}async function g(a,b=[]){let c=b.map(a=>void 0===a?null:a);return e(async()=>{let[b]=await d.execute(a,c);return b})}d.on("error",a=>{console.error("Unexpected error on idle database connection",a)})},87080:a=>{function b(a){var b=Error("Cannot find module '"+a+"'");throw b.code="MODULE_NOT_FOUND",b}b.keys=()=>[],b.resolve=b,b.id=87080,a.exports=b}};