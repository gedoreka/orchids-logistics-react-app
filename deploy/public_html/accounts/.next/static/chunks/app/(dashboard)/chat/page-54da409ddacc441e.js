(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3705],{5370:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]])},5917:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},6191:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},8803:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]])},14755:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("headset",[["path",{d:"M3 11h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-5Zm0 0a9 9 0 1 1 18 0m0 0v5a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3Z",key:"12oyoe"}],["path",{d:"M21 16v2a4 4 0 0 1-4 4h-5",key:"1x7m43"}]])},24033:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},30926:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{callServer:function(){return a.callServer},createServerReference:function(){return r.createServerReference},findSourceMapURL:function(){return i.findSourceMapURL}});let a=s(41209),i=s(85153),r=s(77197)},58256:(e,t,s)=>{"use strict";s.d(t,{ChatClient:()=>I});var a=s(95155),i=s(12115),r=s(26497),l=s(34544),n=s(85998),o=s(14755),d=s(71847);let c=(0,d.A)("ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]]);var x=s(24033),h=s(37107),m=s(6191),u=s(5370),p=s(89559),g=s(65229),f=s(75426),b=s(26983),v=s(69152),y=s(5917);let w=(0,d.A)("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);var j=s(8803),N=s(92001),k=s(71360),_=s(40725),A=s(14285),z=s(18098),S=s(39142),C=s(18085),M=s(53511),R=s(85921),E=s(39867),P=s(18720),D=s(30926);let T=(0,D.createServerReference)("409756ce249f7dd583b840d8788ea743fdd3236400",D.callServer,void 0,D.findSourceMapURL,"getMessages"),L=(0,D.createServerReference)("40feb29e23e356b92297024c355046a8362a15f0dd",D.callServer,void 0,D.findSourceMapURL,"sendMessage"),H=["\uD83D\uDE0A","\uD83D\uDC4D","❤️","\uD83D\uDE02","\uD83D\uDE4F","\uD83D\uDC4F","\uD83C\uDF89","✅","⭐","\uD83D\uDD25","\uD83D\uDCAF","\uD83D\uDE0D","\uD83E\uDD1D","\uD83D\uDC4B","\uD83D\uDCAA","\uD83D\uDE4C","\uD83D\uDE0E","\uD83E\uDD14","\uD83D\uDE22","\uD83E\uDD73"];function I(e){let{initialMessages:t,companyId:s,senderRole:d,companyToken:M,companyName:R}=e,[E,D]=(0,i.useState)(t),[I,V]=(0,i.useState)(""),[O,F]=(0,i.useState)(!1),[W,q]=(0,i.useState)(!1),[B,K]=(0,i.useState)(!1),[Z,G]=(0,i.useState)(0),[J,Q]=(0,i.useState)(null),[X,Y]=(0,i.useState)(!1),[$,ee]=(0,i.useState)(!1),[et,es]=(0,i.useState)(0),[ea,ei]=(0,i.useState)(!1),[er,el]=(0,i.useState)(""),[en,eo]=(0,i.useState)(!1),[ed,ec]=(0,i.useState)(null),[ex,eh]=(0,i.useState)([]),[em,eu]=(0,i.useState)(!1),ep=(0,i.useRef)(null),eg=(0,i.useRef)(null),ef=(0,i.useRef)(null),eb=(0,i.useRef)(null),ev=(0,i.useRef)([]),ey=(0,i.useRef)(null),ew=(0,i.useRef)(null),ej=(0,i.useRef)(E.length),eN=(0,i.useCallback)(()=>{var e;null==(e=ep.current)||e.scrollIntoView({behavior:"smooth"})},[]);(0,i.useEffect)(()=>{eN()},[E,eN]),(0,i.useEffect)(()=>{let e=eg.current;if(!e)return;let t=()=>{let{scrollTop:t,scrollHeight:s,clientHeight:a}=e;q(s-t-a>100)};return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)},[]),(0,i.useEffect)(()=>{let e=async()=>{try{let a=await T(s);if(a.success&&a.data){let s=a.data;if(s.length>ej.current){let a=s[s.length-1];if(a.sender_role!==d){var e,t;es(e=>e+(s.length-ej.current)),el((null==(e=a.message)?void 0:e.substring(0,50))||"رسالة جديدة"),ei(!0),setTimeout(()=>ei(!1),5e3),"Notification"in window&&"granted"===Notification.permission&&new Notification("رسالة جديدة من الدعم الفني",{body:null==(t=a.message)?void 0:t.substring(0,100),icon:"/favicon.ico"})}}ej.current=s.length,D(s);let i=[...new Set(s.filter(e=>e.ticket_id).map(e=>e.ticket_id))];eh(i.map(e=>({id:e,status:"open"})))}}catch(e){console.error("Polling error:",e)}};return"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission(),ef.current=setInterval(e,2e3),()=>{ef.current&&clearInterval(ef.current)}},[s,d]);let ek=async e=>{let t=new FormData;t.append("file",e);let s=await fetch("/api/upload",{method:"POST",body:t});if(!s.ok)throw Error((await s.json()).error||"Failed to upload file");return await s.json()},e_=()=>{let e=Date.now().toString(36).toUpperCase(),t=Math.random().toString(36).substring(2,6).toUpperCase();return"TKT-".concat(e,"-").concat(t)},eA=async(e,t)=>{if(e&&e.preventDefault(),!I.trim()&&!J&&!t||O||X)return;F(!0);let a=(null==t?void 0:t.file_path)||"",i=(null==t?void 0:t.message_type)||"text",r=(null==t?void 0:t.message)||I.trim(),l=ed||e_();ed||(ec(l),eh(e=>[...e,{id:l,status:"open"}]));try{J&&!t&&(Y(!0),a=(await ek(J)).url,i=ez(J.type),r||(r="أرسل ".concat(eS(J.type))),Q(null));let e="temp_".concat(Date.now()),n={id:e,company_id:s,sender_role:d,message:r,file_path:a,message_type:i,ticket_id:l,created_at:new Date().toISOString(),is_read:0,_pending:!0};D(e=>[...e,n]),V(""),ee(!1);let o=await L({company_id:s,sender_role:d,message:r,file_path:a,message_type:i,ticket_id:l});o.success?D(t=>t.map(t=>t.id===e?{...t,id:o.insertId,_pending:!1}:t)):(D(t=>t.filter(t=>t.id!==e)),P.oR.error("فشل في إرسال الرسالة"))}catch(e){P.oR.error(e.message||"حدث خطأ أثناء الإرسال")}finally{F(!1),Y(!1)}},ez=e=>e.startsWith("image/")?"image":e.startsWith("audio/")?"audio":e.startsWith("video/")?"video":"file",eS=e=>e.startsWith("image/")?"صورة":e.startsWith("audio/")?"ملف صوتي":e.startsWith("video/")?"مقطع فيديو":"ملف",eC=async()=>{try{var e,t;if(!(null==(t=navigator)||null==(e=t.mediaDevices)?void 0:e.getUserMedia))return void P.oR.error("متصفحك لا يدعم تسجيل الصوت أو أن الموقع غير آمن (HTTPS)");let s=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}}),a=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4",i=new MediaRecorder(s,{mimeType:a});eb.current=i,ev.current=[],i.ondataavailable=e=>{e.data.size>0&&ev.current.push(e.data)},i.onstop=async()=>{let e=new Blob(ev.current,{type:a}),t=a.includes("webm")?"webm":"mp4",i=new File([e],"voice_".concat(Date.now(),".").concat(t),{type:a});Y(!0);try{let e=await ek(i);await eA(void 0,{message:"\uD83C\uDFA4 رسالة صوتية",file_path:e.url,message_type:"audio"}),P.oR.success("تم إرسال الرسالة الصوتية")}catch(e){P.oR.error("فشل رفع الرسالة الصوتية")}finally{Y(!1)}s.getTracks().forEach(e=>e.stop())},i.start(100),K(!0),G(0),ey.current=setInterval(()=>{G(e=>e+1)},1e3),P.oR.success("جاري التسجيل...")}catch(e){console.error("Microphone error:",e),"NotAllowedError"===e.name?P.oR.error("يرجى السماح بالوصول للميكروفون من إعدادات المتصفح"):"NotFoundError"===e.name?P.oR.error("لم يتم العثور على ميكروفون"):P.oR.error("حدث خطأ في الوصول للميكروفون")}},eM=()=>{eb.current&&B&&(eb.current.stop(),K(!1),ey.current&&clearInterval(ey.current))},eR=(()=>{let e={};return E.forEach(t=>{let s=new Date(t.created_at).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});e[s]||(e[s]=[]),e[s].push(t)}),e})();return(0,a.jsxs)("div",{className:"flex flex-col h-[85vh] bg-white rounded-3xl overflow-hidden shadow-2xl border-4 border-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 relative",style:{borderImage:"linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%) 1"},children:[(0,a.jsx)(r.N,{children:ea&&(0,a.jsx)(l.P.div,{initial:{opacity:0,y:-50,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-50,scale:.9},className:"fixed top-1/3 left-1/2 -translate-x-1/2 z-[100] pointer-events-none",children:(0,a.jsxs)("div",{className:"bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white px-8 py-5 rounded-2xl shadow-2xl flex items-center gap-4 animate-bounce",children:[(0,a.jsx)("div",{className:"w-14 h-14 rounded-full bg-white/20 flex items-center justify-center",children:(0,a.jsx)(n.A,{size:28,className:"animate-pulse"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold text-lg",children:"رسالة جديدة من الدعم!"}),(0,a.jsx)("p",{className:"text-white/80 text-sm truncate max-w-[250px]",children:er})]})]})})}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 px-6 py-5 flex items-center justify-between shrink-0 z-10 shadow-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-14 h-14 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center shadow-xl border border-white/30",children:(0,a.jsx)(o.A,{size:28,className:"text-white"})}),(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 bg-emerald-400 rounded-full border-2 border-white shadow-lg animate-pulse"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-white font-bold text-xl drop-shadow-lg",children:"مركز الدعم الفني"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-pulse"}),(0,a.jsx)("p",{className:"text-white/90 text-sm font-medium",children:"متصل الآن • استجابة فورية"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[et>0&&(0,a.jsx)(l.P.div,{initial:{scale:0},animate:{scale:1},className:"relative",children:(0,a.jsxs)("div",{className:"bg-red-500 text-white text-xs font-bold px-3 py-1.5 rounded-full shadow-lg animate-pulse flex items-center gap-1",children:[(0,a.jsx)(n.A,{size:14}),(0,a.jsxs)("span",{children:[et," جديدة"]})]})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>eu(!em),className:"flex items-center gap-2 bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-xl transition-all border border-white/20",children:[(0,a.jsx)(c,{size:18}),(0,a.jsx)("span",{className:"text-sm font-bold hidden sm:inline",children:ed?"#".concat(ed.slice(-8)):"تذكرة جديدة"}),(0,a.jsx)(x.A,{size:16})]}),(0,a.jsx)(r.N,{children:em&&(0,a.jsxs)(l.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute top-full left-0 mt-2 bg-white rounded-xl shadow-2xl border border-gray-100 overflow-hidden min-w-[250px] z-50",children:[(0,a.jsx)("div",{className:"p-3 border-b border-gray-100 bg-gray-50",children:(0,a.jsx)("p",{className:"text-xs font-bold text-gray-600",children:"تذاكر الدعم"})}),(0,a.jsx)("div",{className:"max-h-[200px] overflow-y-auto",children:ex.map(e=>(0,a.jsxs)("button",{onClick:()=>{ec(e.id),eu(!1)},className:"w-full px-4 py-3 flex items-center gap-3 hover:bg-gray-50 transition-all ".concat(ed===e.id?"bg-indigo-50":""),children:[(0,a.jsx)(h.A,{size:16,className:"text-indigo-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.id.slice(-8)}),"open"===e.status&&(0,a.jsx)("span",{className:"text-[10px] bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full",children:"مفتوحة"})]},e.id))}),(0,a.jsxs)("button",{onClick:()=>{let e=e_();ec(e),eh(t=>[...t,{id:e,status:"open"}]),eu(!1),P.oR.success("تم إنشاء تذكرة جديدة: ".concat(e))},className:"w-full px-4 py-3 flex items-center gap-3 bg-indigo-50 hover:bg-indigo-100 transition-all border-t border-gray-100",children:[(0,a.jsx)(m.A,{size:16,className:"text-indigo-600"}),(0,a.jsx)("span",{className:"text-sm font-bold text-indigo-600",children:"تذكرة جديدة"})]})]})})]}),(0,a.jsx)("button",{onClick:()=>eo(!en),className:"p-3 bg-white/20 hover:bg-white/30 rounded-xl transition-all border border-white/20",children:(0,a.jsx)(u.A,{size:20,className:"text-white"})}),(0,a.jsxs)("div",{className:"hidden sm:flex items-center gap-2 px-4 py-2 bg-white/20 rounded-xl border border-white/20",children:[(0,a.jsx)(p.A,{size:16,className:"text-white ".concat(O?"animate-spin":"")}),(0,a.jsx)("span",{className:"text-xs text-white font-medium",children:"مزامنة"})]})]})]}),(0,a.jsx)(r.N,{children:en&&M&&(0,a.jsx)(l.P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"absolute top-24 left-4 right-4 sm:left-auto sm:right-4 sm:w-80 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-100 overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(u.A,{size:18,className:"text-white"}),(0,a.jsx)("span",{className:"text-white font-bold",children:"رمز الاشتراك"})]}),(0,a.jsx)("button",{onClick:()=>eo(!1),className:"text-white/70 hover:text-white",children:(0,a.jsx)(g.A,{size:18})})]})}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:"رمز الاشتراك الخاص بك:"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("code",{className:"flex-1 bg-gray-100 px-4 py-3 rounded-xl text-sm font-mono text-gray-800 select-all overflow-x-auto",children:M}),(0,a.jsx)("button",{onClick:()=>{M&&(navigator.clipboard.writeText(M),P.oR.success("تم نسخ رمز الاشتراك"))},className:"p-3 bg-indigo-100 hover:bg-indigo-200 rounded-xl transition-all",children:(0,a.jsx)(f.A,{size:18,className:"text-indigo-600"})})]}),(0,a.jsx)("p",{className:"text-[10px] text-gray-400 mt-3 text-center",children:"أرسل هذا الرمز للدعم الفني عند الطلب"})]})]})})}),(0,a.jsxs)("div",{ref:eg,className:"flex-1 overflow-y-auto px-6 py-8 relative scroll-smooth",style:{background:"\n            linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%),\n            url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")\n          "},children:[ed&&(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsxs)("div",{className:"bg-white/90 backdrop-blur-sm px-4 py-2 rounded-full shadow-md border border-gray-200 flex items-center gap-2",children:[(0,a.jsx)(c,{size:14,className:"text-indigo-600"}),(0,a.jsxs)("span",{className:"text-xs font-bold text-gray-700",children:["تذكرة رقم: ",ed]})]})}),(0,a.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[Object.entries(eR).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex justify-center sticky top-2 z-10",children:(0,a.jsx)("span",{className:"bg-white/95 backdrop-blur-md text-gray-600 text-xs font-bold px-5 py-2 rounded-full shadow-lg border border-gray-200",children:t})}),s.map(e=>{let t=e.sender_role===d;return(0,a.jsx)(l.P.div,{initial:{opacity:0,x:t?-20:20,scale:.95},animate:{opacity:e._pending?.7:1,x:0,scale:1},className:"flex ".concat(t?"justify-start":"justify-end"),children:(0,a.jsx)("div",{className:"flex flex-col max-w-[85%] md:max-w-[70%] ".concat(t?"items-start":"items-end"),children:(0,a.jsxs)("div",{className:"relative p-4 rounded-2xl shadow-lg ".concat(t?"bg-white text-gray-800 border border-gray-100 rounded-tr-sm":"bg-gradient-to-br from-indigo-600 to-purple-600 text-white rounded-tl-sm"),children:[(0,a.jsx)(U,{msg:e,isMe:t}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2 ".concat(t?"justify-start":"justify-end"),children:[(0,a.jsx)("span",{className:"text-[10px] font-medium ".concat(t?"text-gray-400":"text-white/70"),children:new Date(e.created_at).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})}),!t&&(e._pending?(0,a.jsx)(b.A,{size:12,className:"text-white/50"}):e.is_read?(0,a.jsx)(v.A,{size:14,className:"text-white"}):(0,a.jsx)(y.A,{size:14,className:"text-white/70"}))]})]})})},e.id)})]},t)}),0===E.length&&(0,a.jsxs)("div",{className:"text-center py-20",children:[(0,a.jsx)("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center",children:(0,a.jsx)(w,{size:40,className:"text-indigo-500"})}),(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-700 mb-2",children:"مرحباً بك في الدعم الفني"}),(0,a.jsx)("p",{className:"text-gray-500 max-w-sm mx-auto",children:"أرسل رسالتك وسيقوم فريق الدعم بالرد عليك في أقرب وقت ممكن"})]})]}),(0,a.jsx)("div",{ref:ep})]}),(0,a.jsx)(r.N,{children:W&&(0,a.jsxs)(l.P.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},onClick:()=>{eN(),es(0)},className:"absolute bottom-36 left-1/2 -translate-x-1/2 w-14 h-14 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-full shadow-2xl flex items-center justify-center hover:scale-110 transition-all z-20",children:[(0,a.jsx)(j.A,{size:24,className:"text-white"}),et>0&&(0,a.jsx)("span",{className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center",children:et})]})}),(0,a.jsx)(r.N,{children:J&&(0,a.jsxs)(l.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"bg-gradient-to-r from-gray-50 to-gray-100 border-t border-gray-200 px-6 py-4 flex items-center justify-between overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-14 h-14 rounded-xl bg-white flex items-center justify-center border-2 border-indigo-200 shadow-lg",children:(0,a.jsx)(N.A,{size:24,className:"text-indigo-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-bold text-gray-900 line-clamp-1",children:J.name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[(J.size/1024/1024).toFixed(2)," MB • جاهز للرفع"]})]})]}),(0,a.jsx)("button",{onClick:()=>Q(null),className:"p-3 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-xl transition-all",children:(0,a.jsx)(k.A,{size:22})})]})}),(0,a.jsxs)("div",{className:"bg-white px-6 py-5 border-t border-gray-200 shrink-0 shadow-inner",children:[(0,a.jsxs)("form",{onSubmit:eA,className:"max-w-4xl mx-auto flex items-end gap-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{type:"button",onClick:()=>ee(!$),className:"w-12 h-12 rounded-2xl flex items-center justify-center text-gray-400 hover:text-yellow-500 hover:bg-yellow-50 transition-all",children:(0,a.jsx)(_.A,{size:26})}),(0,a.jsx)(r.N,{children:$&&(0,a.jsx)(l.P.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},className:"absolute bottom-16 right-0 bg-white rounded-2xl shadow-2xl border border-gray-100 p-3 grid grid-cols-5 gap-2 z-50",children:H.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{V(t=>t+e),ee(!1)},className:"w-10 h-10 flex items-center justify-center text-2xl hover:bg-gray-100 rounded-xl transition-all hover:scale-125",children:e},e))})})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;return null==(e=ew.current)?void 0:e.click()},className:"w-12 h-12 rounded-2xl flex items-center justify-center text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 transition-all",children:(0,a.jsx)(A.A,{size:26})}),(0,a.jsx)("input",{type:"file",ref:ew,className:"hidden",accept:"image/*,audio/*,video/*,.pdf,.doc,.docx,.zip,.rar",onChange:e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];s&&Q(s)}}),(0,a.jsx)("div",{className:"flex-1 bg-gray-100 rounded-2xl border-2 border-gray-200 focus-within:border-indigo-500 focus-within:bg-white transition-all overflow-hidden px-5 py-3",children:B?(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),(0,a.jsx)("span",{className:"text-lg font-bold text-gray-900",children:(e=>{let t=Math.floor(e/60);return"".concat(t,":").concat((e%60).toString().padStart(2,"0"))})(Z)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{eb.current&&B&&(eb.current.stream.getTracks().forEach(e=>e.stop()),K(!1),ey.current&&clearInterval(ey.current),ev.current=[],P.oR.info("تم إلغاء التسجيل"))},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-xl text-sm font-bold hover:bg-gray-300 transition-all",children:"إلغاء"}),(0,a.jsx)("button",{type:"button",onClick:eM,className:"px-4 py-2 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-xl text-sm font-bold hover:opacity-90 transition-all shadow-lg",children:"إرسال"})]})]}):(0,a.jsx)("textarea",{value:I,onChange:e=>V(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),eA(e))},placeholder:"اكتب رسالتك هنا...",rows:1,className:"w-full text-base resize-none focus:outline-none max-h-32 bg-transparent leading-relaxed text-gray-800",style:{minHeight:"28px"}})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:B?eM:eC,disabled:X,className:"w-12 h-12 rounded-2xl flex items-center justify-center transition-all shadow-lg ".concat(B?"bg-gradient-to-r from-red-500 to-pink-500 text-white animate-pulse":"bg-gradient-to-r from-emerald-500 to-teal-500 text-white hover:opacity-90"),children:B?(0,a.jsx)(z.A,{size:24}):(0,a.jsx)(S.A,{size:24})}),(0,a.jsx)("button",{type:"submit",disabled:O||X||!I.trim()&&!J,className:"w-14 h-14 rounded-2xl bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white flex items-center justify-center hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-xl shrink-0",children:O||X?(0,a.jsx)("div",{className:"w-6 h-6 border-3 border-white/30 border-t-white rounded-full animate-spin"}):(0,a.jsx)(C.A,{size:26,className:"rotate-180"})})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-400 text-center mt-4 font-medium",children:"نظام الدعم الفني • Logistics Pro"})]})]})}function U(e){let{msg:t,isMe:s}=e,[r,l]=(0,i.useState)(!1),[n,o]=(0,i.useState)(0),d=(0,i.useRef)(null);return((0,i.useEffect)(()=>{let e=d.current;if(!e)return;let t=()=>{o(e.currentTime/e.duration*100||0)};return e.addEventListener("timeupdate",t),()=>e.removeEventListener("timeupdate",t)},[]),"image"===t.message_type)?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("img",{src:t.file_path,alt:"صورة",className:"rounded-xl max-w-full max-h-[300px] object-cover cursor-pointer hover:opacity-95 transition-opacity shadow-md",onClick:()=>window.open(t.file_path,"_blank")}),t.message&&!t.message.includes("أرسل")&&(0,a.jsx)("p",{className:"text-sm leading-relaxed break-words",children:t.message})]}):"audio"===t.message_type?(0,a.jsxs)("div",{className:"flex items-center gap-4 py-2 min-w-[220px]",children:[(0,a.jsx)("button",{onClick:()=>{d.current&&(r?d.current.pause():d.current.play(),l(!r))},className:"w-12 h-12 rounded-full flex items-center justify-center transition-all shadow-md ".concat(s?"bg-indigo-100 text-indigo-600 hover:bg-indigo-200":"bg-white/30 text-white hover:bg-white/40"),children:r?(0,a.jsx)(M.A,{size:20,fill:"currentColor"}):(0,a.jsx)(R.A,{size:20,fill:"currentColor",className:"ml-1"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"h-2 rounded-full overflow-hidden ".concat(s?"bg-gray-200":"bg-white/20"),children:(0,a.jsx)("div",{className:"h-full rounded-full transition-all ".concat(s?"bg-indigo-500":"bg-white"),style:{width:"".concat(n,"%")}})}),(0,a.jsx)("p",{className:"text-xs mt-1.5 font-bold ".concat(s?"text-gray-500":"text-white/80"),children:"\uD83C\uDFA4 رسالة صوتية"})]}),(0,a.jsx)("audio",{ref:d,src:t.file_path,onEnded:()=>{l(!1),o(0)},className:"hidden"})]}):"video"===t.message_type?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("video",{src:t.file_path,controls:!0,className:"rounded-xl max-w-full max-h-[300px] shadow-md"}),t.message&&!t.message.includes("أرسل")&&(0,a.jsx)("p",{className:"text-sm leading-relaxed break-words",children:t.message})]}):"file"===t.message_type?(0,a.jsxs)("div",{className:"flex items-center gap-4 p-3 rounded-xl ".concat(s?"bg-gray-100":"bg-white/10"),children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-md ".concat(s?"bg-white text-indigo-600":"bg-white/20 text-white"),children:(0,a.jsx)(N.A,{size:24})}),(0,a.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,a.jsx)("p",{className:"text-sm font-bold truncate",children:t.message}),(0,a.jsxs)("a",{href:t.file_path,target:"_blank",download:!0,className:"text-xs flex items-center gap-1 mt-1 hover:underline ".concat(s?"text-indigo-600":"text-white/80"),children:[(0,a.jsx)(E.A,{size:12})," تحميل الملف"]})]})]}):(0,a.jsx)("p",{className:"text-[15px] leading-relaxed whitespace-pre-wrap break-words",children:t.message})}},85998:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]])},95091:(e,t,s)=>{Promise.resolve().then(s.bind(s,58256))}},e=>{e.O(0,[2418,8720,9004,8441,1255,7358],()=>e(e.s=95091)),_N_E=e.O()}]);