(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1583],{6132:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(71847).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},26333:(e,s,t)=>{"use strict";t.d(s,{AM:()=>l,Wv:()=>d,hl:()=>n});var a=t(95155);t(12115);var r=t(31138),c=t(64269);function l(e){let{...s}=e;return(0,a.jsx)(r.bL,{"data-slot":"popover",...s})}function d(e){let{...s}=e;return(0,a.jsx)(r.l9,{"data-slot":"popover-trigger",...s})}function n(e){let{className:s,align:t="center",sideOffset:l=4,...d}=e;return(0,a.jsx)(r.ZL,{children:(0,a.jsx)(r.UC,{"data-slot":"popover-content",align:t,sideOffset:l,className:(0,c.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",s),...d})})}},27937:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(71847).A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},42041:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(71847).A)("hand-coins",[["path",{d:"M11 15h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 17",key:"geh8rc"}],["path",{d:"m7 21 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9",key:"1fto5m"}],["path",{d:"m2 16 6 6",key:"1pfhp9"}],["circle",{cx:"16",cy:"9",r:"2.9",key:"1n0dlu"}],["circle",{cx:"6",cy:"5",r:"3",key:"151irh"}]])},61362:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(71847).A)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},64269:(e,s,t)=>{"use strict";t.d(s,{cn:()=>c});var a=t(2821),r=t(75889);function c(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,r.QP)((0,a.$)(s))}},93471:(e,s,t)=>{"use strict";t.d(s,{default:()=>I});var a=t(95155),r=t(88661),c=t.n(r),l=t(12115),d=t(86651),n=t(24033),o=t(23327),i=t(6191),x=t(42041),p=t(67030),m=t(15870),b=t(54485),h=t(89715),u=t(69880),f=t(19408),j=t(71360),y=t(14285),g=t(65229),N=t(46046),v=t(42529),w=t(52987),_=t(34544),k=t(26497),C=t(20063),A=t(61362),S=t(6132),M=t(89559),O=t(91456),T=t(27937),E=t(83884);let P={advances:"advances",deductions:"deductions",other:"other"};function q(e){let{companyId:s,userId:t,onClose:r,onRefresh:c}=e,d=(0,E.c)("expenses"),[n,o]=(0,l.useState)([]),[x,p]=(0,l.useState)(!0),[b,h]=(0,l.useState)({main_type:"advances",subtype_name:"",sort_order:0}),[u,f]=(0,l.useState)(!1),[y,N]=(0,l.useState)(null),v=async()=>{p(!0);try{let e=await fetch("/api/expenses/deductions/subtypes?company_id=".concat(s,"&user_id=").concat(t)),a=await e.json();a.success&&o(a.subtypes)}catch(e){console.error("Failed to fetch subtypes",e)}finally{p(!1)}};(0,l.useEffect)(()=>{v()},[s,t]);let w=async e=>{if(e.preventDefault(),b.main_type&&b.subtype_name.trim()){f(!0);try{let e=await fetch("/api/expenses/deductions/subtypes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...b,company_id:s,user_id:t})}),a=await e.json();a.success?(N({type:"success",text:d("common.success")}),h(e=>({...e,subtype_name:"",sort_order:0})),await v(),c()):N({type:"error",text:a.error||d("common.error")})}catch(e){N({type:"error",text:d("errors.serverError")})}finally{f(!1),setTimeout(()=>N(null),3e3)}}},C=async e=>{if(confirm(d("subtypeManager.confirmDelete")))try{let s=await fetch("/api/expenses/deductions/subtypes?id=".concat(e,"&user_id=").concat(t),{method:"DELETE"}),a=await s.json();a.success?(N({type:"success",text:d("common.success")}),await v(),c()):N({type:"error",text:a.error||d("common.error")})}catch(e){N({type:"error",text:d("errors.serverError")})}finally{setTimeout(()=>N(null),3e3)}};return(0,a.jsxs)("div",{className:"fixed inset-0 z-[150] flex items-center justify-center p-4 sm:p-6 rtl",dir:"rtl",children:[(0,a.jsx)(_.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm",onClick:r}),(0,a.jsxs)(_.P.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative w-full max-w-4xl bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] border border-white/20",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-rose-900 via-rose-800 to-rose-900 p-6 text-white relative",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between relative z-10",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 space-x-reverse",children:[(0,a.jsx)("div",{className:"p-3 bg-white/10 rounded-2xl backdrop-blur-md border border-white/10",children:(0,a.jsx)(m.A,{className:"w-6 h-6 text-rose-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold tracking-tight",children:d("subtypeManager.title")}),(0,a.jsx)("p",{className:"text-rose-100/70 text-sm mt-0.5",children:d("subtypeManager.subtitle")})]})]}),(0,a.jsx)("button",{onClick:r,className:"p-2 hover:bg-white/10 rounded-xl transition-all border border-transparent hover:border-white/10 group",children:(0,a.jsx)(g.A,{className:"w-5 h-5 group-hover:rotate-90 transition-transform"})})]}),(0,a.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-rose-500/50 to-transparent"})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-8 bg-slate-50/30",children:[(0,a.jsx)(k.N,{children:y&&(0,a.jsxs)(_.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"p-4 rounded-2xl flex items-center space-x-3 space-x-reverse font-bold text-sm ".concat("success"===y.type?"bg-emerald-50 text-emerald-700 border border-emerald-100":"bg-rose-50 text-rose-700 border border-rose-100"),children:["success"===y.type?(0,a.jsx)(A.A,{className:"w-5 h-5"}):(0,a.jsx)(S.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:y.text})]})}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-2xl border border-slate-200 shadow-sm space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse",children:[(0,a.jsx)("div",{className:"w-1.5 h-6 bg-rose-600 rounded-full"}),(0,a.jsx)("h3",{className:"text-base font-bold text-slate-900",children:d("subtypeManager.addNew")})]}),(0,a.jsxs)("form",{onSubmit:w,className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)("label",{className:"text-xs font-bold text-slate-500 mr-1",children:d("subtypeManager.mainType")}),(0,a.jsx)("select",{className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-2.5 text-sm focus:ring-2 focus:ring-rose-500 focus:bg-white outline-none transition-all",value:b.main_type,onChange:e=>h(s=>({...s,main_type:e.target.value})),required:!0,children:Object.entries(P).map(e=>{let[s]=e;return(0,a.jsx)("option",{value:s,children:d("types.".concat(s))},s)})})]}),(0,a.jsxs)("div",{className:"space-y-1.5 md:col-span-2",children:[(0,a.jsx)("label",{className:"text-xs font-bold text-slate-500 mr-1",children:d("subtypeManager.subtypeName")}),(0,a.jsx)("input",{type:"text",placeholder:d("subtypeManager.subtypePlaceholder"),className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-2.5 text-sm focus:ring-2 focus:ring-rose-500 focus:bg-white outline-none transition-all",value:b.subtype_name,onChange:e=>h(s=>({...s,subtype_name:e.target.value})),required:!0})]}),(0,a.jsxs)("button",{type:"submit",disabled:u,className:"bg-rose-600 hover:bg-rose-700 text-white rounded-xl px-6 py-2.5 font-bold text-sm transition-all flex items-center justify-center space-x-2 space-x-reverse shadow-lg shadow-rose-100 disabled:opacity-50 h-[45px]",children:[u?(0,a.jsx)(M.A,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(i.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:d("subtypeManager.addBtn")})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 bg-slate-50/50 border-b border-slate-100 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse",children:[(0,a.jsx)(O.A,{className:"w-4 h-4 text-slate-400"}),(0,a.jsx)("h3",{className:"text-sm font-bold text-slate-700",children:d("subtypeManager.listTitle")})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 space-x-reverse text-[10px] font-bold",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1 space-x-reverse",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-rose-500"}),(0,a.jsx)("span",{className:"text-slate-500",children:d("subtypeManager.custom")})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 space-x-reverse",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-slate-300"}),(0,a.jsxs)("span",{className:"text-slate-500",children:[d("subtypeManager.general")," \uD83C\uDF1F"]})]})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-right border-collapse",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-slate-50 text-slate-500 text-xs font-bold uppercase tracking-wider",children:[(0,a.jsx)("th",{className:"px-6 py-4 border-b border-slate-100",children:d("subtypeManager.mainTypeCol")}),(0,a.jsx)("th",{className:"px-6 py-4 border-b border-slate-100",children:d("subtypeManager.subtypeNameCol")}),(0,a.jsx)("th",{className:"px-6 py-4 border-b border-slate-100 text-center",children:d("common.status")}),(0,a.jsx)("th",{className:"px-6 py-4 border-b border-slate-100 text-center",children:d("subtypeManager.options")})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-50",children:x?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,className:"px-6 py-12 text-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)(M.A,{className:"w-8 h-8 text-rose-500 animate-spin"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:d("subtypeManager.loading")})]})})}):0===(n||[]).length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,className:"px-6 py-12 text-center",children:(0,a.jsx)("p",{className:"text-sm text-slate-400",children:d("subtypeManager.noCustom")})})}):(n||[]).map(e=>(0,a.jsxs)("tr",{className:"group hover:bg-slate-50/80 transition-colors ".concat(e.is_custom?"":"opacity-70"),children:[(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse",children:[(0,a.jsx)(T.A,{className:"w-3 h-3 ".concat(e.is_custom?"text-rose-400":"text-slate-300")}),(0,a.jsx)("span",{className:"text-sm font-medium text-slate-900",children:d("types.".concat(e.main_type))})]})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("span",{className:"text-sm ".concat(e.is_custom?"font-bold text-slate-800":"text-slate-500"),children:e.subtype_name})}),(0,a.jsx)("td",{className:"px-6 py-4 text-center",children:e.is_custom?(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 bg-rose-50 text-rose-600 text-[10px] font-bold rounded-lg border border-rose-100",children:[d("subtypeManager.custom")," ✏️"]}):(0,a.jsxs)("span",{className:"inline-flex items-center px-2 py-1 bg-slate-100 text-slate-500 text-[10px] font-bold rounded-lg",children:[d("subtypeManager.general")," \uD83C\uDF1F"]})}),(0,a.jsx)("td",{className:"px-6 py-4 text-center",children:e.is_custom?(0,a.jsx)("button",{onClick:()=>C(e.id),className:"p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all",title:d("common.delete"),children:(0,a.jsx)(j.A,{className:"w-4 h-4"})}):(0,a.jsx)("span",{className:"text-[10px] text-slate-300 font-bold select-none",children:"—"})})]},e.id))})]})})]})]}),(0,a.jsxs)("div",{className:"p-4 bg-slate-50 border-t border-slate-200 flex justify-between items-center px-8",children:[(0,a.jsx)("p",{className:"text-[10px] text-slate-400 font-medium",children:d("subtypeManager.footerNote")}),(0,a.jsx)("button",{onClick:r,className:"bg-slate-900 hover:bg-slate-800 text-white px-8 py-2 rounded-xl font-bold text-sm transition-all shadow-lg shadow-slate-200",children:d("subtypeManager.close")})]})]})]})}var D=t(26333);let z={advances:"advances",deductions:"deductions",other:"other"},F={advances:"سلفية",deductions:"خصم تأخير",other:"استقطاع متنوع"};function L(e){let{row:s,type:t,metadata:r,updateRow:c,t:x}=e,[p,m]=(0,l.useState)(""),[b,h]=(0,l.useState)(!1),u=((null==r?void 0:r.employees)||[]).filter(e=>(e.name||"").toLowerCase().includes(p.toLowerCase())||(e.iqama_number||"").includes(p));return s.manualEmployee?(0,a.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse",children:[(0,a.jsx)("input",{type:"text",className:"w-full bg-slate-100 border border-slate-200 rounded-lg px-2 py-1 text-sm",placeholder:x("form.employeeName"),value:s.employee_name,onChange:e=>c(t,s.id,"employee_name",e.target.value)}),(0,a.jsxs)("button",{type:"button",onClick:()=>c(t,s.id,"manualEmployee",!1),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-rose-600 to-pink-600 text-white rounded-xl hover:from-rose-700 hover:to-pink-700 transition-all text-xs font-black shrink-0 shadow-lg shadow-rose-200",children:[(0,a.jsx)(d.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"البحث في قاعدة البيانات"})]})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse",children:[(0,a.jsx)("div",{className:"relative w-full",children:(0,a.jsxs)(D.AM,{open:b,onOpenChange:h,children:[(0,a.jsx)(D.Wv,{asChild:!0,children:(0,a.jsxs)("div",{className:"w-full bg-white/50 border border-slate-200 cursor-pointer text-sm font-medium py-1.5 px-3 flex items-center justify-between min-h-[36px] hover:bg-white hover:border-rose-300 rounded-lg transition-all shadow-sm",children:[(0,a.jsx)("span",{className:s.employee_name?"text-slate-900 font-bold":"text-slate-400",children:s.employee_name||x("form.selectEmployee")}),(0,a.jsx)(n.A,{className:"w-4 h-4 text-slate-400 transition-transform duration-200 ".concat(b?"rotate-180 text-rose-500":"")})]})}),(0,a.jsxs)(D.hl,{className:"p-0 w-[400px] bg-white border border-slate-200 rounded-2xl shadow-[0_20px_70px_-10px_rgba(0,0,0,0.3)] overflow-hidden z-[9999]",align:"start",sideOffset:8,children:[(0,a.jsx)("div",{className:"p-4 border-b border-slate-100 bg-slate-50/50",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(d.A,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),(0,a.jsx)("input",{type:"text",className:"w-full pr-10 pl-4 py-2.5 bg-white border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-rose-500 focus:border-transparent outline-none transition-all",placeholder:x("form.searchPlaceholder"),value:p,onChange:e=>m(e.target.value),autoFocus:!0})]})}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto custom-scrollbar",children:u.length>0?u.map(e=>(0,a.jsxs)("div",{onClick:()=>{c(t,s.id,"employee_id",e.id.toString()),c(t,s.id,"employee_name",e.name),c(t,s.id,"employee_iqama",e.iqama_number),h(!1),m("")},className:"px-5 py-4 hover:bg-rose-50 cursor-pointer border-b border-slate-50 last:border-0 transition-all flex flex-col group/item",children:[(0,a.jsx)("div",{className:"font-bold text-slate-900 text-[15px] group-hover/item:text-rose-700",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center gap-3 mt-1.5",children:[(0,a.jsx)("span",{className:"bg-slate-100 text-slate-700 px-2.5 py-1 rounded-md text-[11px] font-mono border border-slate-200",children:e.iqama_number||"بدون إقامة"}),e.phone&&(0,a.jsxs)("span",{className:"text-xs text-slate-400 flex items-center gap-1",children:[(0,a.jsx)(o.A,{className:"w-3 h-3"}),e.phone]})]})]},e.id)):(0,a.jsxs)("div",{className:"p-10 text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4 border border-slate-100",children:(0,a.jsx)(d.A,{className:"w-8 h-8 text-slate-300"})}),(0,a.jsx)("p",{className:"text-base text-slate-400 font-medium",children:x("form.noResults")})]})})]})]})}),(0,a.jsxs)("button",{type:"button",onClick:()=>c(t,s.id,"manualEmployee",!0),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-rose-600 to-pink-600 text-white rounded-xl hover:from-rose-700 hover:to-pink-700 transition-all text-xs font-black shrink-0 shadow-lg shadow-rose-200",children:[(0,a.jsx)(i.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"إدخال البيانات يدوياً"})]})]})}function I(e){let{user:s}=e,t=(0,C.useRouter)(),r=(0,E.c)("expenses"),[d,n]=(0,l.useState)(!0),[o,A]=(0,l.useState)(!1),[S,M]=(0,l.useState)(null),[O,T]=(0,l.useState)({}),[P,D]=(0,l.useState)(""),[I,R]=(0,l.useState)(!1),[B,J]=(0,l.useState)(0),[W,Q]=(0,l.useState)(!1),[U,V]=(0,l.useState)(new Date().toISOString().substring(0,7)),Z=async()=>{try{let e=await fetch("/api/expenses/deductions/metadata?company_id=".concat(s.company_id,"&user_id=").concat(s.id)),t=await e.json();M(t)}catch(e){console.error("Failed to fetch metadata",e)}finally{n(!1)}};(0,l.useEffect)(()=>{Z()},[s.company_id,s.id]);let $=(e,s,t,a)=>{T(r=>{let c=r[e].map(e=>{if(e.id===s){let s={...e,[t]:a};if("deduction_type"===t||"employee_name"===t){let r="deduction_type"===t?a:e.deduction_type,c="employee_name"===t?a:e.employee_name;r&&c&&(s.description="".concat(r," للموظف: ").concat(c))}return s}return e});return{...r,[e]:c}})},G=async e=>{if(e.preventDefault(),0===Object.keys(O).length)return;A(!0);let t=Object.values(O).flat();try{var a;let e=new FormData;e.append("company_id",s.company_id.toString()),e.append("user_id",s.id.toString()),e.append("month_reference",U),e.append("voucher_number",(null==S||null==(a=S.voucherNumber)?void 0:a.toString())||"");let r=t.map(e=>{let{attachment:s,...t}=e;return t});e.append("deductions_json",JSON.stringify(r)),t.forEach(s=>{s.attachment&&e.append("file_".concat(s.id),s.attachment)});let c=await fetch("/api/expenses/deductions/save",{method:"POST",body:e}),l=await c.json();l.success&&(J(l.saved_count),R(!0))}catch(e){console.error("Save failed",e)}finally{A(!1)}};return d?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-rose-600"})}):(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 max-w-[96%] w-[96%] mx-auto px-4 py-8 space-y-8",children:[(0,a.jsxs)(_.P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-rose-900 to-rose-800 p-8 text-white shadow-xl border border-white/10",children:[(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 relative z-10 flex flex-col items-center justify-center text-center space-y-4",children:[(0,a.jsx)("div",{className:"jsx-efde9dac144ebc6 p-3 bg-white/10 rounded-full backdrop-blur-sm",children:(0,a.jsx)(x.A,{className:"w-8 h-8 text-rose-400"})}),(0,a.jsx)("h1",{className:"jsx-efde9dac144ebc6 text-2xl font-bold tracking-tight",children:r("deductions.title")}),(0,a.jsx)("p",{className:"jsx-efde9dac144ebc6 text-rose-300 max-w-2xl",children:r("deductions.subtitle")})]}),(0,a.jsx)("div",{className:"jsx-efde9dac144ebc6 absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-rose-500 via-pink-500 to-red-500"})]}),(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 bg-white rounded-[2.5rem] shadow-2xl border border-slate-100 p-6 md:p-10 space-y-10",children:[(0,a.jsxs)(_.P.div,{className:"bg-slate-50 p-5 rounded-2xl border border-slate-200 flex flex-col md:flex-row items-center justify-between gap-4",initial:{opacity:0},animate:{opacity:1},children:[(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 flex items-center space-x-4 space-x-reverse",children:[(0,a.jsx)("div",{className:"jsx-efde9dac144ebc6 p-2.5 bg-rose-100 rounded-xl text-rose-600",children:(0,a.jsx)(p.A,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6",children:[(0,a.jsx)("h3",{className:"jsx-efde9dac144ebc6 text-base font-bold text-slate-900",children:r("form.manageCustomTypes")}),(0,a.jsx)("p",{className:"jsx-efde9dac144ebc6 text-xs text-slate-500",children:r("form.manageCustomTypesDesc")})]})]}),(0,a.jsxs)("button",{onClick:()=>Q(!0),className:"jsx-efde9dac144ebc6 bg-white hover:bg-rose-50 text-rose-700 px-6 py-2.5 rounded-xl font-bold transition-all flex items-center space-x-2 space-x-reverse border border-rose-200 shadow-sm text-sm",children:[(0,a.jsx)(m.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"jsx-efde9dac144ebc6",children:r("form.manageBtn")})]})]}),(0,a.jsxs)(_.P.div,{initial:{opacity:0},animate:{opacity:1},className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 bg-rose-50/50 p-5 rounded-2xl border border-rose-100 flex items-center space-x-4 space-x-reverse",children:[(0,a.jsx)("div",{className:"jsx-efde9dac144ebc6 p-3 bg-white rounded-xl text-rose-600 shadow-sm",children:(0,a.jsx)(b.A,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 flex-1",children:[(0,a.jsx)("p",{className:"jsx-efde9dac144ebc6 text-[10px] uppercase tracking-wider font-bold text-rose-400 mb-1",children:r("form.currentMonth")}),(0,a.jsx)("input",{type:"month",value:U,onChange:e=>V(e.target.value),className:"jsx-efde9dac144ebc6 bg-transparent border-none p-0 focus:ring-0 font-black text-slate-900 text-lg w-full cursor-pointer"})]})]}),(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 bg-emerald-50/50 p-5 rounded-2xl border border-emerald-100 flex items-center space-x-4 space-x-reverse",children:[(0,a.jsx)("div",{className:"jsx-efde9dac144ebc6 p-3 bg-white rounded-xl text-emerald-600 shadow-sm",children:(0,a.jsx)(h.A,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6",children:[(0,a.jsx)("p",{className:"jsx-efde9dac144ebc6 text-[10px] uppercase tracking-wider font-bold text-emerald-400 mb-1",children:r("form.nextVoucher")}),(0,a.jsx)("p",{className:"jsx-efde9dac144ebc6 text-xl font-black text-slate-900",children:null==S?void 0:S.voucherNumber})]})]}),(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 bg-purple-50/50 p-5 rounded-2xl border border-purple-100 flex items-center space-x-4 space-x-reverse",children:[(0,a.jsx)("div",{className:"jsx-efde9dac144ebc6 p-3 bg-white rounded-xl text-purple-600 shadow-sm",children:(0,a.jsx)(u.A,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6",children:[(0,a.jsx)("p",{className:"jsx-efde9dac144ebc6 text-[10px] uppercase tracking-wider font-bold text-purple-400 mb-1",children:r("form.voucherStatus")}),(0,a.jsx)("p",{className:"jsx-efde9dac144ebc6 text-xl font-black text-slate-900",children:r("form.new")})]})]})]}),(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 relative",children:[(0,a.jsx)("div",{"aria-hidden":"true",className:"jsx-efde9dac144ebc6 absolute inset-0 flex items-center",children:(0,a.jsx)("div",{className:"jsx-efde9dac144ebc6 w-full border-t border-slate-100"})}),(0,a.jsx)("div",{className:"jsx-efde9dac144ebc6 relative flex justify-center",children:(0,a.jsx)("span",{className:"jsx-efde9dac144ebc6 bg-white px-4 text-sm font-bold text-slate-400 uppercase tracking-[0.2em]",children:r("form.chooseType")})})]}),(0,a.jsx)(_.P.div,{className:"bg-slate-50 p-8 rounded-3xl border-2 border-dashed border-slate-200",children:(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 flex flex-col md:flex-row gap-6 items-end",children:[(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 flex-1 space-y-2",children:[(0,a.jsx)("label",{className:"jsx-efde9dac144ebc6 text-xs font-bold text-slate-500 mr-2",children:r("form.selectType")}),(0,a.jsxs)("select",{value:P,onChange:e=>D(e.target.value),className:"jsx-efde9dac144ebc6 w-full bg-white border border-slate-200 rounded-2xl px-5 py-4 focus:ring-4 focus:ring-rose-500/10 focus:border-rose-500 outline-none transition-all text-base font-bold shadow-sm",children:[(0,a.jsx)("option",{value:"",className:"jsx-efde9dac144ebc6",children:r("form.selectType")}),Object.entries(z).map(e=>{let[s]=e;return(0,a.jsx)("option",{value:s,className:"jsx-efde9dac144ebc6",children:r("types.".concat(s))},s)})]})]}),(0,a.jsxs)("button",{onClick:()=>(e=>{if(!e||O[e])return;let s={id:Math.random().toString(36).substr(2,9),expense_date:new Date().toISOString().split("T")[0],deduction_type:F[e]||"",amount:"",employee_id:"",employee_name:"",employee_iqama:"",account_id:"",cost_center_id:"",description:"",status:"pending",manualEmployee:!1,attachment:null};T(t=>({...t,[e]:[s]})),D("")})(P),className:"jsx-efde9dac144ebc6 bg-rose-600 hover:bg-rose-700 text-white px-10 py-4 rounded-2xl font-black transition-all flex items-center justify-center space-x-3 space-x-reverse shadow-xl shadow-rose-200 hover:shadow-rose-300 hover:-translate-y-1 active:translate-y-0",children:[(0,a.jsx)(i.A,{className:"w-6 h-6"}),(0,a.jsx)("span",{className:"jsx-efde9dac144ebc6",children:r("form.addTypeBtn")})]})]})}),(0,a.jsxs)("form",{onSubmit:G,className:"jsx-efde9dac144ebc6 space-y-12",children:[(0,a.jsx)(k.N,{children:Object.entries(O).map(e=>{let[s,t]=e;return(0,a.jsxs)(_.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},className:"bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 bg-slate-900 p-5 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 flex items-center space-x-4 space-x-reverse",children:[(0,a.jsx)("div",{className:"jsx-efde9dac144ebc6 p-2.5 bg-white/10 rounded-xl text-rose-400 backdrop-blur-md",children:(0,a.jsx)(f.A,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6",children:[(0,a.jsx)("h3",{className:"jsx-efde9dac144ebc6 text-lg font-black text-white",children:r("types.".concat(s))}),(0,a.jsxs)("p",{className:"jsx-efde9dac144ebc6 text-xs text-white/50",children:[t.length," ",r("common.records")]})]})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{T(e=>{let{[s]:t,...a}=e;return a})},className:"jsx-efde9dac144ebc6 text-white/30 hover:text-rose-400 hover:bg-white/10 p-2 rounded-xl transition-all",children:(0,a.jsx)(j.A,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"jsx-efde9dac144ebc6 overflow-x-auto",children:(0,a.jsxs)("table",{className:"jsx-efde9dac144ebc6 w-full text-start border-collapse",children:[(0,a.jsx)("thead",{className:"jsx-efde9dac144ebc6",children:(0,a.jsxs)("tr",{className:"jsx-efde9dac144ebc6 bg-slate-50 border-b border-slate-100",children:[(0,a.jsx)("th",{className:"jsx-efde9dac144ebc6 px-4 py-4 text-[10px] font-black text-slate-500 uppercase tracking-widest text-start w-[140px]",children:r("form.date")}),(0,a.jsx)("th",{className:"jsx-efde9dac144ebc6 px-4 py-4 text-[10px] font-black text-slate-500 uppercase tracking-widest text-start w-[160px]",children:r("form.type")}),(0,a.jsx)("th",{className:"jsx-efde9dac144ebc6 px-4 py-4 text-[10px] font-black text-slate-500 uppercase tracking-widest text-start w-[110px]",children:r("form.amount")}),(0,a.jsx)("th",{className:"jsx-efde9dac144ebc6 px-4 py-4 text-[10px] font-black text-slate-500 uppercase tracking-widest text-start min-w-[320px]",children:r("form.employee")}),(0,a.jsx)("th",{className:"jsx-efde9dac144ebc6 px-4 py-4 text-[10px] font-black text-slate-500 uppercase tracking-widest text-start w-[120px]",children:r("form.iqamaNumber")}),(0,a.jsx)("th",{className:"jsx-efde9dac144ebc6 px-4 py-4 text-[10px] font-black text-slate-500 uppercase tracking-widest text-start w-[150px]",children:r("form.account")}),(0,a.jsx)("th",{className:"jsx-efde9dac144ebc6 px-4 py-4 text-[10px] font-black text-slate-500 uppercase tracking-widest text-start w-[150px]",children:r("form.costCenter")}),(0,a.jsx)("th",{className:"jsx-efde9dac144ebc6 px-4 py-4 text-[10px] font-black text-slate-500 uppercase tracking-widest text-start",children:r("form.description")}),(0,a.jsx)("th",{className:"jsx-efde9dac144ebc6 px-4 py-4 text-[10px] font-black text-slate-500 uppercase tracking-widest text-center w-[120px]",children:r("form.document")}),(0,a.jsx)("th",{className:"jsx-efde9dac144ebc6 px-4 py-4 text-[10px] font-black text-slate-500 uppercase tracking-widest text-center w-[120px]",children:r("common.status")}),(0,a.jsx)("th",{className:"jsx-efde9dac144ebc6 px-4 py-4 text-[10px] font-black text-slate-500 uppercase tracking-widest text-center w-[60px]"})]})}),(0,a.jsx)("tbody",{className:"jsx-efde9dac144ebc6 divide-y divide-slate-50",children:t.map(e=>(0,a.jsxs)("tr",{className:"jsx-efde9dac144ebc6 hover:bg-slate-50/50 transition-colors group",children:[(0,a.jsx)("td",{className:"jsx-efde9dac144ebc6 px-4 py-4",children:(0,a.jsx)("input",{type:"date",value:e.expense_date,onChange:t=>$(s,e.id,"expense_date",t.target.value),required:!0,className:"jsx-efde9dac144ebc6 w-full bg-transparent border-none focus:ring-0 text-xs font-bold text-slate-700"})}),(0,a.jsx)("td",{className:"jsx-efde9dac144ebc6 px-4 py-4",children:(0,a.jsxs)("select",{value:e.deduction_type,onChange:t=>$(s,e.id,"deduction_type",t.target.value),className:"jsx-efde9dac144ebc6 w-full bg-transparent border-none focus:ring-0 text-xs font-bold text-slate-700 appearance-none",children:[(0,a.jsx)("option",{value:"",className:"jsx-efde9dac144ebc6",children:r("form.selectType")}),((null==S?void 0:S.subtypes)||[]).filter(e=>e.main_type===s).map(e=>(0,a.jsxs)("option",{value:e.subtype_name,className:"jsx-efde9dac144ebc6",children:[e.subtype_name," ",e.is_custom?"✏️":"\uD83C\uDF1F"]},e.subtype_name)),(0,a.jsx)("option",{value:"other",className:"jsx-efde9dac144ebc6",children:"أخرى"})]})}),(0,a.jsx)("td",{className:"jsx-efde9dac144ebc6 px-4 py-4",children:(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 flex items-center",children:[(0,a.jsx)("span",{className:"jsx-efde9dac144ebc6 text-[10px] font-bold text-rose-300 ml-1",children:"ر.س"}),(0,a.jsx)("input",{type:"number",placeholder:"0.00",value:e.amount,onChange:t=>$(s,e.id,"amount",t.target.value),required:!0,className:"jsx-efde9dac144ebc6 w-full bg-transparent border-none focus:ring-0 text-sm font-black text-rose-600 p-0"})]})}),(0,a.jsx)("td",{className:"jsx-efde9dac144ebc6 px-4 py-4",children:(0,a.jsx)(L,{row:e,type:s,metadata:S,updateRow:$,t:r})}),(0,a.jsx)("td",{className:"jsx-efde9dac144ebc6 px-4 py-4",children:(0,a.jsx)("input",{type:"text",value:e.employee_iqama,readOnly:!e.manualEmployee,onChange:t=>$(s,e.id,"employee_iqama",t.target.value),placeholder:"رقم الإقامة",className:"jsx-efde9dac144ebc6 w-full bg-transparent border-none focus:ring-0 text-xs font-bold text-slate-500"})}),(0,a.jsx)("td",{className:"jsx-efde9dac144ebc6 px-4 py-4",children:(0,a.jsxs)("select",{value:e.account_id,onChange:t=>$(s,e.id,"account_id",t.target.value),className:"jsx-efde9dac144ebc6 w-full bg-transparent border-none focus:ring-0 text-[11px] font-bold text-slate-600 truncate appearance-none",children:[(0,a.jsx)("option",{value:"",className:"jsx-efde9dac144ebc6",children:"الحساب"}),((null==S?void 0:S.accounts)||[]).map(e=>(0,a.jsxs)("option",{value:e.id,className:"jsx-efde9dac144ebc6",children:[e.account_code," - ",e.account_name]},e.id))]})}),(0,a.jsx)("td",{className:"jsx-efde9dac144ebc6 px-4 py-4",children:(0,a.jsxs)("select",{value:e.cost_center_id,onChange:t=>$(s,e.id,"cost_center_id",t.target.value),className:"jsx-efde9dac144ebc6 w-full bg-transparent border-none focus:ring-0 text-[11px] font-bold text-slate-600 truncate appearance-none",children:[(0,a.jsx)("option",{value:"",className:"jsx-efde9dac144ebc6",children:"مركز التكلفة"}),((null==S?void 0:S.costCenters)||[]).map(e=>(0,a.jsxs)("option",{value:e.id,className:"jsx-efde9dac144ebc6",children:[e.center_code," - ",e.center_name]},e.id))]})}),(0,a.jsx)("td",{className:"jsx-efde9dac144ebc6 px-4 py-4",children:(0,a.jsx)("input",{type:"text",placeholder:r("form.description"),value:e.description,onChange:t=>$(s,e.id,"description",t.target.value),className:"jsx-efde9dac144ebc6 w-full bg-transparent border-none focus:ring-0 text-xs font-medium text-slate-600 placeholder:text-slate-300"})}),(0,a.jsx)("td",{className:"jsx-efde9dac144ebc6 px-4 py-4",children:(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 flex flex-col items-center gap-1",children:[(0,a.jsxs)("label",{className:"jsx-efde9dac144ebc6 "+"cursor-pointer p-2 rounded-xl border-2 border-dashed transition-all ".concat(e.attachment?"bg-rose-50 border-rose-300 text-rose-600":"bg-slate-50 border-slate-200 text-slate-400 hover:border-rose-200 hover:text-rose-400"),children:[(0,a.jsx)(y.A,{className:"w-4 h-4"}),(0,a.jsx)("input",{type:"file",onChange:t=>{var a;return $(s,e.id,"attachment",(null==(a=t.target.files)?void 0:a[0])||null)},className:"jsx-efde9dac144ebc6 hidden"})]}),e.attachment&&(0,a.jsx)("span",{className:"jsx-efde9dac144ebc6 text-[9px] font-bold text-emerald-600 truncate max-w-[80px]",children:"تم الإرفاق"})]})}),(0,a.jsx)("td",{className:"jsx-efde9dac144ebc6 px-4 py-4",children:(0,a.jsx)("div",{className:"jsx-efde9dac144ebc6 flex justify-center",children:(0,a.jsxs)("div",{onClick:()=>$(s,e.id,"status","collected"===e.status?"pending":"collected"),className:"jsx-efde9dac144ebc6 "+"inline-flex items-center gap-2 px-3 py-1.5 rounded-full cursor-pointer transition-all border text-[10px] ".concat("collected"===e.status?"bg-emerald-50 text-emerald-700 border-emerald-200 font-bold":"bg-slate-50 text-slate-400 border-slate-200"),children:[(0,a.jsx)("span",{className:"jsx-efde9dac144ebc6",children:"collected"===e.status?"تم الخصم":"لم يخصم"}),(0,a.jsx)("div",{className:"jsx-efde9dac144ebc6 "+"w-6 h-3 rounded-full relative transition-colors ".concat("collected"===e.status?"bg-emerald-400":"bg-slate-300"),children:(0,a.jsx)("div",{className:"jsx-efde9dac144ebc6 "+"absolute top-0.5 w-2 h-2 bg-white rounded-full transition-all ".concat("collected"===e.status?"left-3.5":"left-0.5")})})]})})}),(0,a.jsx)("td",{className:"jsx-efde9dac144ebc6 px-4 py-4",children:(0,a.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void T(e=>{let a=e[s].filter(e=>e.id!==t);if(0===a.length){let{[s]:t,...a}=e;return a}return{...e,[s]:a}})},className:"jsx-efde9dac144ebc6 text-slate-300 hover:text-red-500 transition-colors p-1",children:(0,a.jsx)(g.A,{className:"w-4 h-4"})})})]},e.id))})]})}),(0,a.jsxs)("div",{className:"jsx-efde9dac144ebc6 p-5 bg-slate-50/30 border-t border-slate-100 flex justify-between items-center",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>(e=>{let s={id:Math.random().toString(36).substr(2,9),expense_date:new Date().toISOString().split("T")[0],deduction_type:F[e]||"",amount:"",employee_id:"",employee_name:"",employee_iqama:"",account_id:"",cost_center_id:"",description:"",status:"pending",manualEmployee:!1,attachment:null};T(t=>({...t,[e]:[...t[e],s]}))})(s),className:"jsx-efde9dac144ebc6 flex items-center space-x-2 space-x-reverse text-rose-600 hover:text-rose-700 font-black text-sm transition-all hover:translate-x-1",children:[(0,a.jsx)(i.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"jsx-efde9dac144ebc6",children:r("form.addRow")})]}),(0,a.jsxs)("p",{className:"jsx-efde9dac144ebc6 text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:[t.length," ",r("common.records")," ",r("types.".concat(s))]})]})]},s)})}),Object.keys(O).length>0&&(0,a.jsx)(_.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex justify-center pt-10",children:(0,a.jsxs)("button",{type:"submit",disabled:o,className:"jsx-efde9dac144ebc6 "+"group bg-green-600 hover:bg-green-700 text-white px-12 py-5 rounded-2xl font-black transition-all flex items-center space-x-4 space-x-reverse shadow-2xl shadow-green-200 transform hover:-translate-y-1 active:scale-95 ".concat(o?"opacity-50 cursor-not-allowed":""),children:[o?(0,a.jsx)("div",{className:"jsx-efde9dac144ebc6 animate-spin rounded-full h-6 w-6 border-b-2 border-white"}):(0,a.jsx)(N.A,{className:"w-6 h-6 group-hover:scale-110 transition-transform"}),(0,a.jsx)("span",{className:"jsx-efde9dac144ebc6 text-xl",children:r("deductions.saveAll")})]})})]})]}),(0,a.jsx)(k.N,{children:I&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[100]",onClick:()=>t.push("/expenses")}),(0,a.jsxs)(_.P.div,{initial:{opacity:0,scale:.8,y:100},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:100},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[101] bg-gradient-to-br from-rose-600 to-pink-700 text-white p-8 rounded-3xl shadow-2xl text-center min-w-[350px]",children:[(0,a.jsx)("div",{className:"jsx-efde9dac144ebc6 w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-6 animate-bounce",children:(0,a.jsx)(v.A,{className:"w-10 h-10 text-white"})}),(0,a.jsx)("h2",{className:"jsx-efde9dac144ebc6 text-2xl font-bold mb-3",children:r("form.success")}),(0,a.jsx)("p",{className:"jsx-efde9dac144ebc6 text-base opacity-90 mb-6",children:r("deductions.successDesc",{count:B})}),(0,a.jsxs)("button",{onClick:()=>t.push("/expenses"),className:"jsx-efde9dac144ebc6 bg-white text-rose-700 px-8 py-2.5 rounded-xl font-bold text-base hover:bg-rose-50 transition-colors flex items-center mx-auto space-x-2 space-x-reverse",children:[(0,a.jsx)("span",{className:"jsx-efde9dac144ebc6",children:r("form.backToCenter")}),(0,a.jsx)(w.A,{className:"w-4 h-4"})]})]})]})}),(0,a.jsx)(k.N,{children:W&&(0,a.jsx)(q,{companyId:s.company_id,userId:s.id,onClose:()=>Q(!1),onRefresh:Z})}),(0,a.jsx)(c(),{id:"efde9dac144ebc6",children:'input[type="date"]::-webkit-calendar-picker-indicator{cursor:pointer;filter:invert(.5)}.left-3\\\\.5 {left:.875rem}'})]})}},94461:(e,s,t)=>{Promise.resolve().then(t.bind(t,93471))}},e=>{e.O(0,[2418,4909,315,477,7258,2414,3884,8441,1255,7358],()=>e(e.s=94461)),_N_E=e.O()}]);