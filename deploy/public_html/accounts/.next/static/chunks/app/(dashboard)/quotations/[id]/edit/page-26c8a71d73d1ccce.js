(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4763],{7486:(e,t,s)=>{Promise.resolve().then(s.bind(s,33256))},33256:(e,t,s)=>{"use strict";s.d(t,{EditQuotationClient:()=>S});var a=s(95155),r=s(12115),i=s(26497),l=s(34544),n=s(42529),o=s(6132),d=s(35299),c=s(11010),x=s(52987),m=s(57828),u=s(89715),p=s(37107),b=s(16485),h=s(26983),g=s(20508),f=s(26617),y=s(6191),j=s(71360),N=s(91761),v=s(19204),w=s(46046),_=s(42516),z=s(52619),q=s.n(z),A=s(20063),k=s(64269),C=s(83884);function S(e){var t;let{quotation:s,customers:z,companyId:S}=e,T=(0,A.useRouter)(),P=(0,C.c)("financialVouchersPage.quotationsPage"),D=(0,C.c)("common"),{locale:F}=(0,C.Y)(),E="ar"===F,O=D("sar"),[U,L]=(0,r.useState)(!1),[M,I]=(0,r.useState)({show:!1,type:"success",title:"",message:""}),Q=e=>{if(!e)return"";try{if("string"==typeof e)return e.split("T")[0];let t=new Date(e);if(isNaN(t.getTime()))return"";return t.toISOString().split("T")[0]}catch(e){return""}},[J,R]=(0,r.useState)({quotation_number:s.quotation_number,client_id:String(s.client_id),issue_date:Q(s.issue_date),due_date:Q(s.due_date)}),[V,Y]=(0,r.useState)((null==(t=s.items)?void 0:t.length)>0?s.items.map(e=>({id:String(e.id),product_name:e.product_name,description:e.description||"",quantity:e.quantity,price:e.price})):[{id:"1",product_name:"",description:"",quantity:1,price:0}]),{subtotal:$,vatAmount:B,total:G}=(()=>{let e=0;V.forEach(t=>{e+=t.quantity*t.price});let t=15*e/100,s=e+t;return{subtotal:e,vatAmount:t,total:s}})(),H=(e,t,s)=>{I({show:!0,type:e,title:t,message:s})},K=()=>{I(e=>({...e,show:!1}))},W=e=>{let{name:t,value:s}=e.target;R(e=>({...e,[t]:s}))},X=(e,t,s)=>{Y(a=>a.map(a=>a.id===e?{...a,[t]:s}:a))},Z=async e=>{if(!J.client_id)return void H("error",P("notifications.errorTitle"),P("notifications.selectCustomer"));if(!J.due_date)return void H("error",P("notifications.errorTitle"),P("notifications.selectExpiry"));let t=V.filter(e=>e.product_name&&e.quantity>0&&e.price>0);if(0===t.length)return void H("error",P("notifications.errorTitle"),P("notifications.addProductError"));L(!0),H("loading",P("form.saving"),P("notifications.updateSuccessMsg"));try{let a=await fetch("/api/quotations/".concat(s.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...J,company_id:S,status:e,items:t})});if(a.ok)H("success",P("notifications.updateSuccess"),P("notifications.updateSuccessMsg")),setTimeout(()=>{T.push("/quotations/".concat(s.id)),T.refresh()},1500);else{let e=await a.json();H("error",P("notifications.updateFailed"),e.error||P("notifications.updateFailedMsg"))}}catch(e){H("error",P("notifications.error"),P("notifications.errorMsg"))}finally{L(!1)}};return(0,a.jsxs)("div",{className:"h-full flex flex-col",dir:E?"rtl":"ltr",children:[(0,a.jsx)(i.N,{children:M.show&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:()=>"loading"!==M.type&&K()}),(0,a.jsx)(l.P.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 w-full max-w-md p-4",children:(0,a.jsx)("div",{className:(0,k.cn)("bg-white rounded-3xl p-8 shadow-2xl border-t-4","success"===M.type?"border-emerald-500":"error"===M.type?"border-red-500":"border-blue-500"),children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:(0,k.cn)("h-20 w-20 rounded-full mx-auto mb-6 flex items-center justify-center","success"===M.type?"bg-emerald-100 text-emerald-500":"error"===M.type?"bg-red-100 text-red-500":"bg-blue-100 text-blue-500"),children:["success"===M.type&&(0,a.jsx)(n.A,{size:40}),"error"===M.type&&(0,a.jsx)(o.A,{size:40}),"loading"===M.type&&(0,a.jsx)(d.A,{size:40,className:"animate-spin"})]}),(0,a.jsx)("h3",{className:"text-2xl font-black text-gray-900 mb-2",children:M.title}),(0,a.jsx)("p",{className:"text-gray-500 mb-6 font-medium",children:M.message}),"loading"!==M.type&&(0,a.jsx)("button",{onClick:K,className:(0,k.cn)("w-full py-3 rounded-xl font-bold text-white transition-all shadow-lg active:scale-95","success"===M.type?"bg-emerald-500 hover:bg-emerald-600":"bg-red-500 hover:bg-red-600"),children:P("notifications.ok")})]})})})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-auto p-6",children:(0,a.jsxs)("div",{className:"max-w-[1200px] mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"relative overflow-hidden bg-gradient-to-br from-[#1a237e] to-[#283593] rounded-2xl p-6 text-white shadow-xl",children:[(0,a.jsx)("div",{className:"relative z-10",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"h-14 w-14 rounded-xl bg-amber-500 flex items-center justify-center shadow-lg",children:(0,a.jsx)(c.A,{size:28})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-black",children:P("form.editTitle")}),(0,a.jsx)("p",{className:"text-white/60 text-sm",children:s.quotation_number})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)(q(),{href:"/quotations",children:(0,a.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/10 text-white font-bold text-sm hover:bg-white/20 transition-all border border-white/10",children:[(0,a.jsx)(x.A,{size:16,className:(0,k.cn)(E?"rotate-0":"rotate-180")}),(0,a.jsx)("span",{children:P("table.back")})]})}),(0,a.jsx)(q(),{href:"/quotations/".concat(s.id),children:(0,a.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-blue-500 text-white font-bold text-sm hover:bg-blue-600 transition-all",children:[(0,a.jsx)(m.A,{size:16}),(0,a.jsx)("span",{children:P("table.view")})]})})]})]})}),(0,a.jsx)("div",{className:"absolute top-0 right-0 w-40 h-40 bg-white/5 rounded-full -mr-20 -mt-20 blur-2xl"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-blue-500 px-4 py-3 flex items-center gap-2 text-white",children:[(0,a.jsx)(u.A,{size:18}),(0,a.jsx)("h3",{className:"font-bold text-sm",children:P("customers.viewPage.facilityInfo")})]}),(0,a.jsxs)("div",{className:"p-5 grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center gap-1.5 text-xs font-bold text-gray-700 mb-1.5",children:[(0,a.jsx)(p.A,{size:14,className:"text-gray-400"}),P("form.number")]}),(0,a.jsx)("input",{type:"text",name:"quotation_number",value:J.quotation_number,readOnly:!0,className:"w-full px-3 py-2 rounded-lg border border-gray-200 bg-gray-50 text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center gap-1.5 text-xs font-bold text-gray-700 mb-1.5",children:[(0,a.jsx)(b.A,{size:14,className:"text-gray-400"}),P("form.issueDate")]}),(0,a.jsx)("input",{type:"date",name:"issue_date",value:J.issue_date,onChange:W,className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-1 focus:ring-blue-500/20 outline-none text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center gap-1.5 text-xs font-bold text-gray-700 mb-1.5",children:[(0,a.jsx)(h.A,{size:14,className:"text-gray-400"}),P("form.expiryDate"),(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"date",name:"due_date",value:J.due_date,onChange:W,required:!0,className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-1 focus:ring-blue-500/20 outline-none text-sm"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-purple-500 px-4 py-3 flex items-center gap-2 text-white",children:[(0,a.jsx)(g.A,{size:18}),(0,a.jsx)("h3",{className:"font-bold text-sm",children:P("table.customer")})]}),(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsxs)("label",{className:"flex items-center gap-1.5 text-xs font-bold text-gray-700 mb-1.5",children:[(0,a.jsx)(g.A,{size:14,className:"text-gray-400"}),P("form.selectCustomer"),(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("select",{name:"client_id",value:J.client_id,onChange:W,required:!0,className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-1 focus:ring-blue-500/20 outline-none text-sm",children:[(0,a.jsx)("option",{value:"",children:P("form.selectCustomer")}),z.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.customer_name||e.company_name," - ",e.vat_number]},e.id))]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-emerald-500 px-4 py-3 flex items-center justify-between text-white",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f.A,{size:18}),(0,a.jsx)("h3",{className:"font-bold text-sm",children:P("form.products")})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>{Y(e=>[...e,{id:Date.now().toString(),product_name:"",description:"",quantity:1,price:0}])},className:"flex items-center gap-1 px-3 py-1.5 rounded-lg bg-white/20 text-white text-xs font-bold hover:bg-white/30 transition-all",children:[(0,a.jsx)(y.A,{size:14}),P("form.addProduct")]})]}),(0,a.jsx)("div",{className:"p-5 space-y-4",children:V.map(e=>(0,a.jsxs)("div",{className:(0,k.cn)("bg-gray-50 rounded-xl p-4 border-blue-500",E?"border-r-4":"border-l-4"),children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-3",children:[(0,a.jsxs)("div",{className:"md:col-span-4",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-gray-500 mb-1 block",children:P("form.table.productName")}),(0,a.jsx)("input",{type:"text",placeholder:P("form.table.placeholder"),value:e.product_name,onChange:t=>X(e.id,"product_name",t.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none text-sm"})]}),(0,a.jsxs)("div",{className:"md:col-span-3",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-gray-500 mb-1 block",children:P("common.description")}),(0,a.jsx)("input",{type:"text",placeholder:P("form.table.placeholder"),value:e.description,onChange:t=>X(e.id,"description",t.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none text-sm"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-gray-500 mb-1 block",children:P("form.table.quantity")}),(0,a.jsx)("input",{type:"number",min:"1",value:e.quantity,onChange:t=>X(e.id,"quantity",parseFloat(t.target.value)||0),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none text-sm"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-gray-500 mb-1 block",children:P("form.table.price")}),(0,a.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.price,onChange:t=>X(e.id,"price",parseFloat(t.target.value)||0),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none text-sm"})]}),(0,a.jsx)("div",{className:"md:col-span-1 flex items-end",children:(0,a.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void(V.length>1&&Y(e=>e.filter(e=>e.id!==t)))},disabled:1===V.length,className:"w-full h-9 rounded-lg bg-red-50 text-red-500 flex items-center justify-center hover:bg-red-500 hover:text-white transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:(0,a.jsx)(j.A,{size:16})})})]}),(0,a.jsx)("div",{className:(0,k.cn)("mt-2",E?"text-left":"text-right"),children:(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:[P("common.total"),": ",(0,a.jsxs)("span",{className:"font-bold text-emerald-600",children:[(e.quantity*e.price).toLocaleString("en-US",{minimumFractionDigits:2})," ",O]})]})})]},e.id))})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-amber-500 px-4 py-3 flex items-center gap-2 text-white",children:[(0,a.jsx)(N.A,{size:18}),(0,a.jsx)("h3",{className:"font-bold text-sm",children:P("view.summary")})]}),(0,a.jsx)("div",{className:"p-5",children:(0,a.jsxs)("div",{className:(0,k.cn)("max-w-md space-y-3",E?"mr-auto":"ml-auto"),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[(0,a.jsxs)("span",{className:"text-gray-600 text-sm",children:[P("form.subtotal"),":"]}),(0,a.jsxs)("span",{className:"font-bold text-gray-900",children:[$.toLocaleString("en-US",{minimumFractionDigits:2})," ",O]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[(0,a.jsxs)("span",{className:"text-gray-600 text-sm flex items-center gap-1",children:[(0,a.jsx)(v.A,{size:12}),P("form.totalTax",{rate:15}),":"]}),(0,a.jsxs)("span",{className:"font-bold text-amber-600",children:[B.toLocaleString("en-US",{minimumFractionDigits:2})," ",O]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-3 bg-emerald-50 rounded-lg px-4",children:[(0,a.jsx)("span",{className:"text-emerald-800 font-bold",children:P("view.inclTax")}),(0,a.jsxs)("span",{className:"font-black text-2xl text-emerald-600",children:[G.toLocaleString("en-US",{minimumFractionDigits:2})," ",O]})]})]})})]}),(0,a.jsxs)("div",{className:"flex justify-center gap-4 pt-2 pb-6",children:[(0,a.jsx)(q(),{href:"/quotations/".concat(s.id),children:(0,a.jsxs)("button",{type:"button",className:"flex items-center gap-2 px-6 py-3 rounded-xl bg-gray-100 text-gray-700 font-bold text-sm hover:bg-gray-200 transition-all",children:[(0,a.jsx)(x.A,{size:16,className:(0,k.cn)(E?"rotate-0":"rotate-180")}),(0,a.jsx)("span",{children:P("form.cancel")})]})}),(0,a.jsxs)("button",{type:"button",onClick:()=>Z("draft"),disabled:U,className:"flex items-center gap-2 px-6 py-3 rounded-xl bg-gray-500 text-white font-bold text-sm hover:bg-gray-600 transition-all disabled:opacity-50",children:[U?(0,a.jsx)(d.A,{size:16,className:"animate-spin"}):(0,a.jsx)(w.A,{size:16}),(0,a.jsx)("span",{children:P("form.saveDraft")})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>Z("confirmed"),disabled:U,className:"flex items-center gap-2 px-6 py-3 rounded-xl bg-amber-500 text-white font-bold text-sm hover:bg-amber-600 transition-all disabled:opacity-50",children:[U?(0,a.jsx)(d.A,{size:16,className:"animate-spin"}):(0,a.jsx)(_.A,{size:16}),(0,a.jsx)("span",{children:P("form.saveConfirm")})]})]})]})]})})]})}},64269:(e,t,s)=>{"use strict";s.d(t,{cn:()=>i});var a=s(2821),r=s(75889);function i(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,a.$)(t))}}},e=>{e.O(0,[2418,4909,2619,6351,3884,8441,1255,7358],()=>e(e.s=7486)),_N_E=e.O()}]);