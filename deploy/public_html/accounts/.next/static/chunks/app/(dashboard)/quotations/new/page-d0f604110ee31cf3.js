(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4725],{23890:(e,s,t)=>{Promise.resolve().then(t.bind(t,72086))},72086:(e,s,t)=>{"use strict";t.d(s,{NewQuotationClient:()=>A});var a=t(95155),l=t(12115),r=t(26497),i=t(34544),n=t(42529),d=t(6132),o=t(35299),c=t(89715),x=t(52987),m=t(37107),b=t(16485),u=t(26983),p=t(20508),h=t(26617),g=t(6191),j=t(71360),y=t(91761),f=t(19204),N=t(46046),v=t(42516),w=t(52619),_=t.n(w),z=t(20063);function A(e){let{customers:s,companyId:t,nextQuotationNumber:w}=e,A=(0,z.useRouter)(),[k,C]=(0,l.useState)(!1),[S,q]=(0,l.useState)({show:!1,type:"success",title:"",message:""}),[F,D]=(0,l.useState)({quotation_number:w,client_id:"",issue_date:new Date().toISOString().split("T")[0],due_date:""}),[O,E]=(0,l.useState)([{id:"1",product_name:"",description:"",quantity:1,price:0}]),{subtotal:L,vatAmount:P,total:T}=(()=>{let e=0;O.forEach(s=>{e+=s.quantity*s.price});let s=15*e/100,t=e+s;return{subtotal:e,vatAmount:s,total:t}})(),U=(e,s,t)=>{q({show:!0,type:e,title:s,message:t})},I=()=>{q(e=>({...e,show:!1}))},J=e=>{let{name:s,value:t}=e.target;D(e=>({...e,[s]:t}))},Q=(e,s,t)=>{E(a=>a.map(a=>a.id===e?{...a,[s]:t}:a))},R=async e=>{if(!F.client_id)return void U("error","خطأ في البيانات","يرجى اختيار العميل");if(!F.due_date)return void U("error","خطأ في البيانات","يرجى تحديد تاريخ الانتهاء");let s=O.filter(e=>e.product_name&&e.quantity>0&&e.price>0);if(0===s.length)return void U("error","خطأ في البيانات","يرجى إضافة منتج واحد على الأقل");C(!0),U("loading","جاري الحفظ","جاري حفظ عرض السعر...");try{let a=await fetch("/api/quotations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...F,company_id:t,status:e,items:s})});if(a.ok)U("success","تم الحفظ بنجاح","confirmed"===e?"تم حفظ وتأكيد عرض السعر":"تم حفظ عرض السعر كمسودة"),setTimeout(()=>{A.push("/quotations"),A.refresh()},1500);else{let e=await a.json();U("error","فشل الحفظ",e.error||"فشل حفظ عرض السعر")}}catch(e){U("error","خطأ","حدث خطأ أثناء الحفظ")}finally{C(!1)}};return(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsx)(r.N,{children:S.show&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:()=>"loading"!==S.type&&I()}),(0,a.jsx)(i.P.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 w-full max-w-md",children:(0,a.jsx)("div",{className:"bg-white rounded-3xl p-8 shadow-2xl border-t-4 ".concat("success"===S.type?"border-emerald-500":"error"===S.type?"border-red-500":"border-blue-500"),children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"h-20 w-20 rounded-full mx-auto mb-6 flex items-center justify-center ".concat("success"===S.type?"bg-emerald-100 text-emerald-500":"error"===S.type?"bg-red-100 text-red-500":"bg-blue-100 text-blue-500"),children:["success"===S.type&&(0,a.jsx)(n.A,{size:40}),"error"===S.type&&(0,a.jsx)(d.A,{size:40}),"loading"===S.type&&(0,a.jsx)(o.A,{size:40,className:"animate-spin"})]}),(0,a.jsx)("h3",{className:"text-2xl font-black text-gray-900 mb-2",children:S.title}),(0,a.jsx)("p",{className:"text-gray-500 mb-6",children:S.message}),"loading"!==S.type&&(0,a.jsx)("button",{onClick:I,className:"px-8 py-3 rounded-xl font-bold text-white transition-all ".concat("success"===S.type?"bg-emerald-500 hover:bg-emerald-600":"bg-red-500 hover:bg-red-600"),children:"حسناً"})]})})})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-auto p-6",children:(0,a.jsxs)("div",{className:"max-w-[1200px] mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"relative overflow-hidden bg-gradient-to-br from-[#1a237e] to-[#283593] rounded-2xl p-6 text-white shadow-xl",children:[(0,a.jsx)("div",{className:"relative z-10",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"h-14 w-14 rounded-xl bg-emerald-500 flex items-center justify-center shadow-lg",children:(0,a.jsx)(c.A,{size:28})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-black",children:"إنشاء عرض سعر جديد"}),(0,a.jsx)("p",{className:"text-white/60 text-sm",children:"أضف عرض سعر جديد للعملاء"})]})]}),(0,a.jsx)(_(),{href:"/quotations",children:(0,a.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/10 text-white font-bold text-sm hover:bg-white/20 transition-all border border-white/10",children:[(0,a.jsx)(x.A,{size:16}),(0,a.jsx)("span",{children:"العودة للقائمة"})]})})]})}),(0,a.jsx)("div",{className:"absolute top-0 right-0 w-40 h-40 bg-white/5 rounded-full -mr-20 -mt-20 blur-2xl"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-blue-500 px-4 py-3 flex items-center gap-2 text-white",children:[(0,a.jsx)(c.A,{size:18}),(0,a.jsx)("h3",{className:"font-bold text-sm",children:"المعلومات الأساسية"})]}),(0,a.jsxs)("div",{className:"p-5 grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center gap-1.5 text-xs font-bold text-gray-700 mb-1.5",children:[(0,a.jsx)(m.A,{size:14,className:"text-gray-400"}),"رقم العرض"]}),(0,a.jsx)("input",{type:"text",name:"quotation_number",value:F.quotation_number,readOnly:!0,className:"w-full px-3 py-2 rounded-lg border border-gray-200 bg-gray-50 text-sm"}),(0,a.jsx)("p",{className:"text-[10px] text-gray-400 mt-1",children:"يتم إنشاء الرقم تلقائياً"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center gap-1.5 text-xs font-bold text-gray-700 mb-1.5",children:[(0,a.jsx)(b.A,{size:14,className:"text-gray-400"}),"تاريخ الإصدار"]}),(0,a.jsx)("input",{type:"date",name:"issue_date",value:F.issue_date,onChange:J,className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-1 focus:ring-blue-500/20 outline-none text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center gap-1.5 text-xs font-bold text-gray-700 mb-1.5",children:[(0,a.jsx)(u.A,{size:14,className:"text-gray-400"}),"تاريخ الانتهاء",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"date",name:"due_date",value:F.due_date,onChange:J,required:!0,className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-1 focus:ring-blue-500/20 outline-none text-sm"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-purple-500 px-4 py-3 flex items-center gap-2 text-white",children:[(0,a.jsx)(p.A,{size:18}),(0,a.jsx)("h3",{className:"font-bold text-sm",children:"العميل"})]}),(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsxs)("label",{className:"flex items-center gap-1.5 text-xs font-bold text-gray-700 mb-1.5",children:[(0,a.jsx)(p.A,{size:14,className:"text-gray-400"}),"اختر العميل",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("select",{name:"client_id",value:F.client_id,onChange:J,required:!0,className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-blue-500 focus:ring-1 focus:ring-blue-500/20 outline-none text-sm",children:[(0,a.jsx)("option",{value:"",children:"اختر العميل..."}),s.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.customer_name||e.company_name," - ",e.vat_number]},e.id))]}),0===s.length&&(0,a.jsx)("div",{className:"mt-3 p-3 bg-amber-50 rounded-lg border border-amber-200",children:(0,a.jsxs)("p",{className:"text-amber-700 text-xs",children:["لا يوجد عملاء مسجلين.",(0,a.jsx)(_(),{href:"/customers/new",className:"text-blue-600 hover:underline mr-1",children:"إضافة عميل جديد"})]})})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-emerald-500 px-4 py-3 flex items-center justify-between text-white",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.A,{size:18}),(0,a.jsx)("h3",{className:"font-bold text-sm",children:"المنتجات / الخدمات"})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>{E(e=>[...e,{id:Date.now().toString(),product_name:"",description:"",quantity:1,price:0}])},className:"flex items-center gap-1 px-3 py-1.5 rounded-lg bg-white/20 text-white text-xs font-bold hover:bg-white/30 transition-all",children:[(0,a.jsx)(g.A,{size:14}),"إضافة منتج"]})]}),(0,a.jsx)("div",{className:"p-5 space-y-4",children:O.map((e,s)=>(0,a.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4 border-r-4 border-blue-500",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-3",children:[(0,a.jsxs)("div",{className:"md:col-span-4",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-gray-500 mb-1 block",children:"اسم المنتج"}),(0,a.jsx)("input",{type:"text",placeholder:"اسم المنتج أو الخدمة",value:e.product_name,onChange:s=>Q(e.id,"product_name",s.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none text-sm"})]}),(0,a.jsxs)("div",{className:"md:col-span-3",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-gray-500 mb-1 block",children:"الوصف"}),(0,a.jsx)("input",{type:"text",placeholder:"وصف اختياري",value:e.description,onChange:s=>Q(e.id,"description",s.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none text-sm"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-gray-500 mb-1 block",children:"الكمية"}),(0,a.jsx)("input",{type:"number",min:"1",value:e.quantity,onChange:s=>Q(e.id,"quantity",parseFloat(s.target.value)||0),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none text-sm"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"text-[10px] font-bold text-gray-500 mb-1 block",children:"السعر"}),(0,a.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.price,onChange:s=>Q(e.id,"price",parseFloat(s.target.value)||0),className:"w-full px-3 py-2 rounded-lg border border-gray-200 focus:border-blue-500 outline-none text-sm"})]}),(0,a.jsx)("div",{className:"md:col-span-1 flex items-end",children:(0,a.jsx)("button",{type:"button",onClick:()=>{var s;return s=e.id,void(O.length>1&&E(e=>e.filter(e=>e.id!==s)))},disabled:1===O.length,className:"w-full h-9 rounded-lg bg-red-50 text-red-500 flex items-center justify-center hover:bg-red-500 hover:text-white transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:(0,a.jsx)(j.A,{size:16})})})]}),(0,a.jsx)("div",{className:"mt-2 text-left",children:(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["الإجمالي: ",(0,a.jsxs)("span",{className:"font-bold text-emerald-600",children:[(e.quantity*e.price).toLocaleString("en-US",{minimumFractionDigits:2})," ر.س"]})]})})]},e.id))})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-amber-500 px-4 py-3 flex items-center gap-2 text-white",children:[(0,a.jsx)(y.A,{size:18}),(0,a.jsx)("h3",{className:"font-bold text-sm",children:"ملخص المبالغ"})]}),(0,a.jsx)("div",{className:"p-5",children:(0,a.jsxs)("div",{className:"max-w-md mr-auto space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[(0,a.jsx)("span",{className:"text-gray-600 text-sm",children:"المجموع الفرعي:"}),(0,a.jsxs)("span",{className:"font-bold text-gray-900",children:[L.toLocaleString("en-US",{minimumFractionDigits:2})," ر.س"]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[(0,a.jsxs)("span",{className:"text-gray-600 text-sm flex items-center gap-1",children:[(0,a.jsx)(f.A,{size:12}),"ضريبة القيمة المضافة (",15,"%):"]}),(0,a.jsxs)("span",{className:"font-bold text-amber-600",children:[P.toLocaleString("en-US",{minimumFractionDigits:2})," ر.س"]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-3 bg-emerald-50 rounded-lg px-4",children:[(0,a.jsx)("span",{className:"text-emerald-800 font-bold",children:"الإجمالي شامل الضريبة:"}),(0,a.jsxs)("span",{className:"font-black text-2xl text-emerald-600",children:[T.toLocaleString("en-US",{minimumFractionDigits:2})," ر.س"]})]})]})})]}),(0,a.jsxs)("div",{className:"flex justify-center gap-4 pt-2 pb-6",children:[(0,a.jsx)(_(),{href:"/quotations",children:(0,a.jsxs)("button",{type:"button",className:"flex items-center gap-2 px-6 py-3 rounded-xl bg-gray-100 text-gray-700 font-bold text-sm hover:bg-gray-200 transition-all",children:[(0,a.jsx)(x.A,{size:16}),(0,a.jsx)("span",{children:"إلغاء"})]})}),(0,a.jsxs)("button",{type:"button",onClick:()=>R("draft"),disabled:k,className:"flex items-center gap-2 px-6 py-3 rounded-xl bg-gray-500 text-white font-bold text-sm hover:bg-gray-600 transition-all disabled:opacity-50",children:[k?(0,a.jsx)(o.A,{size:16,className:"animate-spin"}):(0,a.jsx)(N.A,{size:16}),(0,a.jsx)("span",{children:"حفظ كمسودة"})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>R("confirmed"),disabled:k,className:"flex items-center gap-2 px-6 py-3 rounded-xl bg-amber-500 text-white font-bold text-sm hover:bg-amber-600 transition-all disabled:opacity-50",children:[k?(0,a.jsx)(o.A,{size:16,className:"animate-spin"}):(0,a.jsx)(v.A,{size:16}),(0,a.jsx)("span",{children:"حفظ وتأكيد"})]})]})]})]})})]})}}},e=>{e.O(0,[2418,2619,9435,8441,1255,7358],()=>e(e.s=23890)),_N_E=e.O()}]);