exports.id=1236,exports.ids=[1236],exports.modules={9625:(a,b,c)=>{"use strict";c.r(b),c.d(b,{"403c9dc84024fe3ea91ace706537d03c1f83c4504a":()=>x,"405e0141f64eee1e490a1ca8fcd39641a50a7a9835":()=>z,"406869d6d4e0e4f9234f38a41026c82a1b52b15883":()=>A,"4069b62ea9546728c83636a1381a3d882e5dc66288":()=>i,"407c56610ce78d26989e3e750ace494f851fb068b5":()=>B,"409da08056ed53831d4f060b45b8a14670f3220a0a":()=>h,"409dcbbe8a3f1247c567148160bbfb5dbde9d2d2ae":()=>r,"40d5c9377c139f4907c86716c5f397ea341687ed81":()=>o,"40d731db50ba4ba2bf1552737e3d635ee749b6cd71":()=>u,"40e412d6bd82ba1280a9289a006ed41a7208d51bab":()=>g,"600fc3396fcc8551341cfa59a4a1ef52c80cadf87a":()=>j,"60206cc857a1a75bc9446a28b2c84d0b55777a1486":()=>q,"6037b9d8a10fec2d3b6d20fe22b61b5899a071b31a":()=>k,"605299543100bcdffb0a848908a7b372bca1f4afcb":()=>D,"605501f1ddb09c1566db7235706401ebf20f435138":()=>y,"6055c0ccbb9a0f63f316658817e652b60f2fbc609d":()=>m,"6058c5efd3b5069e72eb05e699d600f32bcb7babdd":()=>w,"607e28640d1f2ceb328a7afe8b2f10d791bec4dcc6":()=>l,"6085fdcacc07001613e988c57d576d6d71053a5999":()=>t,"60b2fb3e360944377dcaf928a00f2e40bbf9810b73":()=>n,"60e3c5fa73e5a0e097cb2f6df9547c40daa35c708b":()=>E,"7061fb6a4d7aa31d33bb8b7aa72625328f2fedae39":()=>v,"7080493e10eae60995e222ed1f02446aa89fe449c6":()=>p,"708e7e89f7cf02d0c9214e88af6fa789eee0583e64":()=>s,"70be7a59e3d8329fb33710e17f399463b9c1c56b54":()=>C});var d=c(91488);c(27806);var e=c(67697),f=c(91837);async function g(a){try{await (0,e.P)("INSERT INTO employee_packages (group_name, work_type, monthly_target, bonus_after_target, company_id) VALUES (?, ?, ?, ?, ?)",[a.group_name,a.work_type,a.monthly_target,a.bonus_after_target,a.company_id]);let b=(await (0,e.P)("SELECT LAST_INSERT_ID() as id"))[0].id;if(a.employees&&a.employees.length>0)for(let c of a.employees)c.name&&await (0,e.P)(`INSERT INTO employees (
            name, iqama_number, identity_number, nationality, user_code, 
            phone, email, job_title, basic_salary, housing_allowance, 
            vehicle_plate, iban, package_id, company_id, is_active
          ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 1)`,[c.name,c.iqama_number||null,c.identity_number||null,c.nationality||null,c.user_code||null,c.phone||null,c.email||null,c.job_title||null,c.basic_salary||0,c.housing_allowance||0,c.vehicle_plate||null,c.iban||null,b,a.company_id]);return(0,f.revalidatePath)("/hr"),(0,f.revalidatePath)("/hr/packages"),{success:!0}}catch(a){return console.error("Error creating package with employees:",a),{success:!1,error:a.message}}}async function h(a){try{return await (0,e.P)("INSERT INTO employee_packages (group_name, work_type, monthly_target, bonus_after_target, company_id) VALUES (?, ?, ?, ?, ?)",[a.group_name,a.work_type,a.monthly_target,a.bonus_after_target,a.company_id]),(0,f.revalidatePath)("/hr"),(0,f.revalidatePath)("/hr/packages"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function i(a){try{let b=await (0,e.P)("SELECT COUNT(*) as count FROM employees WHERE package_id = ?",[a]);if(Number(b[0].count)>0)return{success:!1,error:"لا يمكن حذف هذه الباقة لأنها مرتبطة بموظفين."};return await (0,e.P)("DELETE FROM employee_packages WHERE id = ?",[a]),(0,f.revalidatePath)("/hr"),(0,f.revalidatePath)("/hr/packages"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function j(a,b){try{for(let c of b)await (0,e.P)(`INSERT INTO employees (
          name, iqama_number, identity_number, nationality, user_code, 
          phone, email, job_title, basic_salary, housing_allowance, 
          vehicle_plate, iban, package_id, company_id, is_active
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 1)`,[c.name,c.iqama_number||null,c.identity_number||null,c.nationality,c.user_code||null,c.phone||null,c.email||null,c.job_title||null,c.basic_salary,c.housing_allowance||0,c.vehicle_plate||null,c.iban||null,a,c.company_id]);return(0,f.revalidatePath)(`/hr/packages/${a}`),(0,f.revalidatePath)("/hr"),{success:!0,message:"تم حفظ الموظفين بنجاح"}}catch(a){return{success:!1,error:a.message}}}async function k(a,b){try{return await (0,e.P)(`UPDATE employees SET 
        iqama_number = ?, identity_number = ?, job_title = ?, user_code = ?, nationality = ?, 
        phone = ?, email = ?, vehicle_plate = ?, 
        birth_date = ?, passport_number = ?, operation_card_number = ?,
        basic_salary = ?, housing_allowance = ?
      WHERE id = ?`,[b.iqama_number,b.identity_number,b.job_title,b.user_code,b.nationality,b.phone,b.email,b.vehicle_plate,b.birth_date||null,b.passport_number,b.operation_card_number,b.basic_salary,b.housing_allowance,a]),(0,f.revalidatePath)(`/hr/employees/${a}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function l(a,b){try{return await (0,e.P)("UPDATE employees SET bank_account = ?, iban = ?, bank_name = ? WHERE id = ?",[b.bank_account,b.iban,b.bank_name,a]),(0,f.revalidatePath)(`/hr/employees/${a}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function m(a,b){try{return await (0,e.P)("UPDATE employees SET is_active = ? WHERE id = ?",[+(1!==b),a]),(0,f.revalidatePath)("/hr"),(0,f.revalidatePath)("/hr/packages"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function n(a,b){try{return await (0,e.P)("UPDATE employees SET is_frozen = ? WHERE id = ?",[+(1!==b),a]),(0,f.revalidatePath)("/hr/packages"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function o(a){try{return await (0,e.P)("DELETE FROM employees WHERE id = ?",[a]),(0,f.revalidatePath)("/hr"),(0,f.revalidatePath)("/hr/packages"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function p(a,b,c){try{if(!["personal_photo","iqama_file","license_file","vehicle_file","agir_permit_file","work_contract_file","vehicle_operation_card"].includes(b))throw Error("Field not allowed");return await (0,e.P)(`UPDATE employees SET ${b} = ? WHERE id = ?`,[c,a]),(0,f.revalidatePath)(`/hr/employees/${a}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function q(a,b){try{return await (0,e.P)("UPDATE employees SET iqama_expiry = ? WHERE id = ?",[b,a]),(0,f.revalidatePath)("/hr"),(0,f.revalidatePath)("/hr/packages"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function r(a){try{let b=a.violation_amount-a.deducted_amount;return await (0,e.P)(`INSERT INTO employee_violations 
      (employee_id, violation_type, violation_date, violation_amount, deducted_amount, remaining_amount, status, violation_description) 
      VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,[a.employee_id,a.violation_type,a.violation_date,a.violation_amount,a.deducted_amount,b,a.status,a.violation_description]),(0,f.revalidatePath)(`/hr/employees/${a.employee_id}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function s(a,b,c){try{let d=c.violation_amount-c.deducted_amount;return await (0,e.P)(`UPDATE employee_violations SET 
        violation_type = ?, violation_date = ?, violation_amount = ?, 
        deducted_amount = ?, remaining_amount = ?, status = ?, violation_description = ? 
      WHERE id = ?`,[c.violation_type,c.violation_date,c.violation_amount,c.deducted_amount,d,c.status,c.violation_description,a]),(0,f.revalidatePath)(`/hr/employees/${b}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function t(a,b){try{return await (0,e.P)("DELETE FROM employee_violations WHERE id = ?",[a]),(0,f.revalidatePath)(`/hr/employees/${b}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function u(a){try{return await (0,e.P)(`INSERT INTO employee_letters 
      (employee_id, letter_type, start_date, end_date, duration_days, violation_amount, letter_details, document_path) 
      VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,[a.employee_id,a.letter_type,a.start_date,a.end_date,a.duration_days,a.violation_amount,a.letter_details,a.document_path||null]),(0,f.revalidatePath)(`/hr/employees/${a.employee_id}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function v(a,b,c){try{return await (0,e.P)(`UPDATE employee_letters SET 
        letter_type = ?, start_date = ?, end_date = ?, 
        duration_days = ?, violation_amount = ?, letter_details = ? 
      WHERE id = ?`,[c.letter_type,c.start_date,c.end_date,c.duration_days,c.violation_amount,c.letter_details,a]),(0,f.revalidatePath)(`/hr/employees/${b}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function w(a,b){try{return await (0,e.P)("DELETE FROM employee_letters WHERE id = ?",[a]),(0,f.revalidatePath)(`/hr/employees/${b}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function x(a){try{return await (0,e.P)(`INSERT INTO employee_tasks (title, description, assigned_to, company_id, due_date, priority, status, created_by) 
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,[a.title,a.description,a.assigned_to||null,a.company_id,a.due_date,a.priority,a.status,a.created_by]),(0,f.revalidatePath)("/hr/tasks"),(0,f.revalidatePath)("/hr"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function y(a,b){try{return await (0,e.P)("UPDATE employee_tasks SET status = ? WHERE id = ?",[b,a]),(0,f.revalidatePath)("/hr/tasks"),(0,f.revalidatePath)("/hr"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function z(a){try{return await (0,e.P)("DELETE FROM employee_tasks WHERE id = ?",[a]),(0,f.revalidatePath)("/hr/tasks"),(0,f.revalidatePath)("/hr"),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function A(a){try{let b=await (0,e.P)("SELECT * FROM employee_bank_accounts WHERE employee_id = ? ORDER BY is_primary DESC, created_at DESC",[a]);return{success:!0,data:b}}catch(a){return{success:!1,error:a.message,data:[]}}}async function B(a){try{return a.is_primary&&await (0,e.P)("UPDATE employee_bank_accounts SET is_primary = false WHERE employee_id = ?",[a.employee_id]),await (0,e.P)(`INSERT INTO employee_bank_accounts (employee_id, bank_name, account_number, iban, is_primary) 
       VALUES (?, ?, ?, ?, ?)`,[a.employee_id,a.bank_name,a.account_number,a.iban,a.is_primary||!1]),(0,f.revalidatePath)(`/hr/employees/${a.employee_id}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function C(a,b,c){try{return c.is_primary&&await (0,e.P)("UPDATE employee_bank_accounts SET is_primary = false WHERE employee_id = ?",[b]),await (0,e.P)("UPDATE employee_bank_accounts SET bank_name = ?, account_number = ?, iban = ?, is_primary = ? WHERE id = ?",[c.bank_name,c.account_number,c.iban,c.is_primary||!1,a]),(0,f.revalidatePath)(`/hr/employees/${b}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function D(a,b){try{return await (0,e.P)("DELETE FROM employee_bank_accounts WHERE id = ?",[a]),(0,f.revalidatePath)(`/hr/employees/${b}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}async function E(a,b){try{return await (0,e.P)("UPDATE employee_bank_accounts SET is_primary = false WHERE employee_id = ?",[b]),await (0,e.P)("UPDATE employee_bank_accounts SET is_primary = true WHERE id = ?",[a]),(0,f.revalidatePath)(`/hr/employees/${b}`),{success:!0}}catch(a){return{success:!1,error:a.message}}}(0,c(40410).D)([g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E]),(0,d.A)(g,"40e412d6bd82ba1280a9289a006ed41a7208d51bab",null),(0,d.A)(h,"409da08056ed53831d4f060b45b8a14670f3220a0a",null),(0,d.A)(i,"4069b62ea9546728c83636a1381a3d882e5dc66288",null),(0,d.A)(j,"600fc3396fcc8551341cfa59a4a1ef52c80cadf87a",null),(0,d.A)(k,"6037b9d8a10fec2d3b6d20fe22b61b5899a071b31a",null),(0,d.A)(l,"607e28640d1f2ceb328a7afe8b2f10d791bec4dcc6",null),(0,d.A)(m,"6055c0ccbb9a0f63f316658817e652b60f2fbc609d",null),(0,d.A)(n,"60b2fb3e360944377dcaf928a00f2e40bbf9810b73",null),(0,d.A)(o,"40d5c9377c139f4907c86716c5f397ea341687ed81",null),(0,d.A)(p,"7080493e10eae60995e222ed1f02446aa89fe449c6",null),(0,d.A)(q,"60206cc857a1a75bc9446a28b2c84d0b55777a1486",null),(0,d.A)(r,"409dcbbe8a3f1247c567148160bbfb5dbde9d2d2ae",null),(0,d.A)(s,"708e7e89f7cf02d0c9214e88af6fa789eee0583e64",null),(0,d.A)(t,"6085fdcacc07001613e988c57d576d6d71053a5999",null),(0,d.A)(u,"40d731db50ba4ba2bf1552737e3d635ee749b6cd71",null),(0,d.A)(v,"7061fb6a4d7aa31d33bb8b7aa72625328f2fedae39",null),(0,d.A)(w,"6058c5efd3b5069e72eb05e699d600f32bcb7babdd",null),(0,d.A)(x,"403c9dc84024fe3ea91ace706537d03c1f83c4504a",null),(0,d.A)(y,"605501f1ddb09c1566db7235706401ebf20f435138",null),(0,d.A)(z,"405e0141f64eee1e490a1ca8fcd39641a50a7a9835",null),(0,d.A)(A,"406869d6d4e0e4f9234f38a41026c82a1b52b15883",null),(0,d.A)(B,"407c56610ce78d26989e3e750ace494f851fb068b5",null),(0,d.A)(C,"70be7a59e3d8329fb33710e17f399463b9c1c56b54",null),(0,d.A)(D,"605299543100bcdffb0a848908a7b372bca1f4afcb",null),(0,d.A)(E,"60e3c5fa73e5a0e097cb2f6df9547c40daa35c708b",null)},67697:(a,b,c)=>{"use strict";c.d(b,{P:()=>f,g7:()=>g});let d=c(56275).createPool({host:process.env.DB_HOST,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME,waitForConnections:!0,connectionLimit:10,queueLimit:0,enableKeepAlive:!0,keepAliveInitialDelay:1e4,idleTimeout:6e4,maxIdle:10});async function e(a,b=3){let c;for(let d=0;d<b;d++)try{return await a()}catch(a){if(c=a,("PROTOCOL_CONNECTION_LOST"===a.code||"EPIPE"===a.code||"ECONNRESET"===a.code||!0===a.fatal)&&d<b-1){let a=500*Math.pow(2,d);await new Promise(b=>setTimeout(b,a));continue}throw a}throw c}async function f(a,b=[]){let c=b.map(a=>void 0===a?null:a);return e(async()=>{let[b]=await d.execute(a,c);return b})}async function g(a,b=[]){let c=b.map(a=>void 0===a?null:a);return e(async()=>{let[b]=await d.execute(a,c);return b})}d.on("error",a=>{console.error("Unexpected error on idle database connection",a)})},87080:a=>{function b(a){var b=Error("Cannot find module '"+a+"'");throw b.code="MODULE_NOT_FOUND",b}b.keys=()=>[],b.resolve=b,b.id=87080,a.exports=b}};