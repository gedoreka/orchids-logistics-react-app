(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9672],{61537:(e,t,a)=>{"use strict";a.d(t,{default:()=>O});var l=a(95155),s=a(12115),r=a(8751),n=a(26497),o=a(53409),i=a(87066),c=a(23664),d=a(73364),m=a(89715),p=a(15870),h=a(19408),x=a(6191),u=a(90368),b=a(86651),g=a(16485),f=a(57828),w=a(18085),j=a(21190),y=a(71360),v=a(65229),N=a(21786),_=a(34183),k=a(5917),S=a(309),C=a(39867),A=a(35299),E=a(18756),P=a(18720),T=a(98045),z=a(83884);T.EA.workerSrc="//unpkg.com/pdfjs-dist@".concat(T.rE,"/build/pdf.worker.min.mjs");let R={salary_receipt:o.A,work_receipt:i.A,custody_receipt:o.A,resignation_letter:c.A,final_clearance:d.A},L={salary_receipt:"from-blue-600 to-cyan-600",work_receipt:"from-blue-500 to-indigo-600",custody_receipt:"from-amber-500 to-orange-600",resignation_letter:"from-rose-500 to-pink-600",final_clearance:"from-emerald-500 to-teal-600"};function H(e){let{content:t,maxHeight:a}=e,r=(0,s.useRef)(null),[n,o]=(0,s.useState)(16),[i,c]=(0,s.useState)(1.6);return(0,s.useEffect)(()=>{let e=r.current;if(!e)return;let t=16,l=1.6,s=()=>{e.scrollHeight>a&&t>10?(o(t-=.5),requestAnimationFrame(s)):e.scrollHeight>a&&l>1.2&&(c(l-=.05),requestAnimationFrame(s))};o(16),c(1.6),requestAnimationFrame(s)},[t,a]),(0,l.jsx)("div",{ref:r,className:"letter-content-auto",style:{fontSize:"".concat(n,"px"),lineHeight:i,textAlign:"justify"},dangerouslySetInnerHTML:{__html:t}})}function O(){let e=(0,z.c)("officialLettersPage"),{locale:t,isRTL:o}=(0,z.Y)(),[i,c]=(0,s.useState)([]),[d,O]=(0,s.useState)([]),[F,D]=(0,s.useState)(!0),[q,M]=(0,s.useState)(null),[U,I]=(0,s.useState)(""),[J,W]=(0,s.useState)(!1),[Y,V]=(0,s.useState)(!1),[B,G]=(0,s.useState)({top:100,bottom:100}),[Z,$]=(0,s.useState)(!1),[K,Q]=(0,s.useState)(!1),[X,ee]=(0,s.useState)(null),[et,ea]=(0,s.useState)({}),[el,es]=(0,s.useState)(null),[er,en]=(0,s.useState)(!1),[eo,ei]=(0,s.useState)(null),ec=(0,s.useRef)(null),ed=(0,s.useRef)(null),[em,ep]=(0,s.useState)(!1),[eh,ex]=(0,s.useState)(!1),[eu,eb]=(0,s.useState)(null),[eg,ef]=(0,s.useState)(""),[ew,ej]=(0,s.useState)(!1),ey=(0,s.useMemo)(()=>({employee_name:e("placeholders.employee_name"),id_number:e("placeholders.id_number"),company_name:e("placeholders.company_name"),commercial_number:e("placeholders.commercial_number"),start_date:e("placeholders.start_date"),job_title:e("placeholders.job_title"),profession:e("placeholders.profession"),nationality:e("placeholders.nationality"),resignation_day:e("placeholders.resignation_day"),resignation_date:e("placeholders.resignation_date"),resignation_reason:e("placeholders.resignation_reason"),receipt_date:e("placeholders.receipt_date"),item_1:e("placeholders.item",{n:1}),qty_1:e("placeholders.qty",{n:1}),value_1:e("placeholders.value",{n:1}),status_1:e("placeholders.status",{n:1}),notes_1:e("placeholders.notes",{n:1}),item_2:e("placeholders.item",{n:2}),qty_2:e("placeholders.qty",{n:2}),value_2:e("placeholders.value",{n:2}),status_2:e("placeholders.status",{n:2}),notes_2:e("placeholders.notes",{n:2}),item_3:e("placeholders.item",{n:3}),qty_3:e("placeholders.qty",{n:3}),value_3:e("placeholders.value",{n:3}),status_3:e("placeholders.status",{n:3}),notes_3:e("placeholders.notes",{n:3}),item_4:e("placeholders.item",{n:4}),qty_4:e("placeholders.qty",{n:4}),value_4:e("placeholders.value",{n:4}),status_4:e("placeholders.status",{n:4}),notes_4:e("placeholders.notes",{n:4}),total_value:e("placeholders.total_value"),service_days:e("placeholders.service_days"),service_months:e("placeholders.service_months"),service_years:e("placeholders.service_years"),end_date:e("placeholders.end_date"),basic_salary:e("placeholders.basic_salary"),housing_allowance:e("placeholders.housing_allowance"),transport_allowance:e("placeholders.transport_allowance"),end_service_bonus:e("placeholders.end_service_bonus"),vacation_balance:e("placeholders.vacation_balance"),total_amount:e("placeholders.total_amount"),payroll_period:e("placeholders.payroll_period"),period_from:e("placeholders.period_from"),period_to:e("placeholders.period_to"),total_amount_text:e("placeholders.total_amount_text"),bank_name:e("placeholders.bank_name"),account_number:e("placeholders.account_number"),transfer_date:e("placeholders.transfer_date"),due_date:e("placeholders.due_date"),actual_receipt_date:e("placeholders.actual_receipt_date")}),[e]),ev=(0,s.useCallback)(async(e,t)=>{if(t&&e)try{let a=T.YE(e),l=await a.promise,s=await l.getPage(1),r=s.getViewport({scale:1}),n=200/r.width,o=s.getViewport({scale:n});t.width=o.width,t.height=o.height;let i=t.getContext("2d");i&&(await s.render({canvasContext:i,viewport:o}).promise,ep(!0))}catch(e){console.error("Error rendering PDF:",e)}},[]);(0,s.useEffect)(()=>{var e;J&&(null==q||null==(e=q.letterhead_path)?void 0:e.toLowerCase().endsWith(".pdf"))&&(ep(!1),setTimeout(()=>{ev(q.letterhead_path,ed.current)},100))},[J,null==q?void 0:q.letterhead_path,ev]),(0,s.useEffect)(()=>{if((null==X?void 0:X.template_key)==="salary_receipt"||(null==X?void 0:X.template_key)==="final_clearance"){let e=parseFloat(et.basic_salary||"0"),t=parseFloat(et.housing_allowance||"0"),a=parseFloat(et.transport_allowance||"0"),l=e+t+a+parseFloat(et.end_service_bonus||"0")+parseFloat(et.vacation_balance||"0");l>0&&l.toString()!==et.total_amount&&ea(e=>({...e,total_amount:l.toString(),total_amount_text:(e=>{if(isNaN(e)||0===e)return"";let t=["","واحد","اثنان","ثلاثة","أربعة","خمسة","ستة","سبعة","ثمانية","تسعة","عشرة"],a=["عشرة","أحد عشر","اثنا عشر","ثلاثة عشر","أربعة عشر","خمسة عشر","ستة عشر","سبعة عشر","ثمانية عشر","تسعة عشر"],l=["","عشرة","عشرون","ثلاثون","أربعون","خمسون","ستون","سبعون","ثمانون","تسعون"],s=["","مائة","مائتان","ثلاثمائة","أربعمائة","خمسمائة","ستمائة","سبعمائة","ثمانمائة","تسمائة"],r=e=>{let r="",n=Math.floor(e/100),o=e%100;if(n>0&&(r+=s[n]),o>0)if(n>0&&(r+=" و "),o<=10)r+=t[o];else if(o<20)r+=a[o-10];else{let e=Math.floor(o/10),a=o%10;a>0&&(r+=t[a]+" و "),r+=l[e]}return r},n=Math.floor(e/1e3),o=Math.floor(e%1e3),i="";return n>0&&(1===n?i+="ألف":2===n?i+="ألفان":n>=3&&n<=10?i+=t[n]+" آلاف":i+=r(n)+" ألف"),o>0&&(n>0&&(i+=" و "),i+=r(o)),i})(Math.floor(l))}))}},[et.basic_salary,et.housing_allowance,et.transport_allowance,et.end_service_bonus,et.vacation_balance,X]);let eN=async()=>{try{let[e,t]=await Promise.all([fetch("/api/letters"),fetch("/api/company-info")]),a=await e.json(),l=await t.json();a.success&&(c(a.templates||[]),O(a.letters||[])),l.company&&(M(l.company),G({top:l.company.letterhead_top_margin||100,bottom:l.company.letterhead_bottom_margin||100}))}catch(t){console.error("Error fetching data:",t),P.oR.error(e("messages.fetchError"))}finally{D(!1)}},e_=async t=>{var a;let l=null==(a=t.target.files)?void 0:a[0];if(!l)return;V(!0);let s=new FormData;s.append("file",l),s.append("bucket","letterheads");try{let t=await fetch("/api/upload",{method:"POST",body:s}),a=await t.json();a.url?await ek({letterhead_path:a.url})?(P.oR.success(e("messages.uploadSuccess")),eN()):P.oR.error(e("messages.dbSaveError")):P.oR.error(a.error||e("messages.uploadError"))}catch(t){console.error("Upload error:",t),P.oR.error(e("messages.uploadError"))}finally{V(!1)}},ek=async t=>{try{let e=await fetch("/api/company-info",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if((await e.json()).success)return M(e=>({...e||{},...t})),!0}catch(t){console.error("Update settings error:",t),P.oR.error(e("messages.updateSettingsError"))}return!1};(0,s.useEffect)(()=>{eN()},[]);let eS=async t=>{if(t.preventDefault(),X)try{let t=el?{id:el.id,letter_data:et,status:"active"}:{template_id:X.id,letter_data:et},a=await fetch("/api/letters",{method:el?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),l=await a.json();l.success?(P.oR.success(el?e("messages.updateSuccess"):e("messages.saveSuccess",{number:l.letter_number})),eN(),eA()):P.oR.error(l.error||e("common.error"))}catch(t){console.error("Error saving letter:",t),P.oR.error(e("common.error"))}},eC=async t=>{if(confirm(e("messages.deleteConfirm")))try{let a=await fetch("/api/letters?id=".concat(t),{method:"DELETE"}),l=await a.json();l.success?(P.oR.success(e("messages.deleteSuccess")),eN()):P.oR.error(l.error||e("common.error"))}catch(t){console.error("Error deleting letter:",t),P.oR.error(e("common.error"))}},eA=()=>{Q(!1),ee(null),es(null),ea({})},eE=e=>{let t=i.find(t=>t.id===e.template_id);if(!t)return"";let a=t.template_content;return Object.entries("string"==typeof e.letter_data?JSON.parse(e.letter_data):e.letter_data).forEach(e=>{let[t,l]=e,s=RegExp("\\{".concat(t,"\\}"),"g");a=a.replace(s,l||"..................")}),a},eP=()=>{if(!eo)return;let e=eE(eo),t=null==q?void 0:q.letterhead_path,a=B.top,l=B.bottom,s=null==t?void 0:t.toLowerCase().endsWith(".pdf"),r=window.open("","_blank");r&&(r.document.write('\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <title>طباعة الخطاب - '.concat(eo.letter_number,"</title>\n        <style>\n          @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');\n          * { margin: 0; padding: 0; box-sizing: border-box; }\n          body { font-family: 'Tajawal', sans-serif; direction: rtl; background: #fff; color: #000; line-height: 1.6; }\n          @page { size: A4; margin: 0; }\n          .page-container { width: 210mm; height: 297mm; position: relative; margin: 0 auto; overflow: hidden; }\n          ").concat(!s?"\n          .page-container {\n            background-image: url('".concat(t,"');\n            background-size: 100% 100%; background-repeat: no-repeat; background-position: center;\n          }"):"","\n          .letterhead-pdf { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; z-index: -1; }\n          .letter-content-wrapper { \n            position: absolute; \n            top: ").concat(a,"px; \n            bottom: ").concat(l,'px; \n            left: 50px; \n            right: 50px; \n            z-index: 1; \n            overflow: hidden;\n            display: flex;\n            flex-direction: column;\n          }\n          .letter-content { \n            font-size: var(--font-size, 16px); \n            text-align: justify; \n            line-height: var(--line-height, 1.6);\n          }\n          .letter-content p { margin-bottom: var(--paragraph-spacing, 12px); }\n          .field { font-weight: bold; color: #000; }\n          h2 { font-size: calc(var(--font-size, 16px) * 1.4); margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 10px 0; }\n          td, th { padding: 8px; border: 1px solid #000; font-size: var(--font-size, 16px); }\n          @media print { \n            .page-container { width: 100%; height: 100%; margin: 0; box-shadow: none; -webkit-print-color-adjust: exact; print-color-adjust: exact; }\n            .letterhead-pdf { display: block; }\n          }\n        </style>\n      </head>\n      <body>\n        <div class="page-container">\n          ').concat(s?'<iframe src="'.concat(t,'#toolbar=0&navpanes=0&scrollbar=0" class="letterhead-pdf"></iframe>'):"",'\n          <div class="letter-content-wrapper">\n            <div class="letter-content" id="letterContent">').concat(e,"</div>\n          </div>\n        </div>\n        <script>\n          window.onload = function() {\n            const wrapper = document.querySelector('.letter-content-wrapper');\n            const content = document.getElementById('letterContent');\n            const availableHeight = wrapper.clientHeight;\n            let fontSize = 16;\n            let lineHeight = 1.6;\n            let paragraphSpacing = 12;\n            \n            function adjustContent() {\n              document.documentElement.style.setProperty('--font-size', fontSize + 'px');\n              document.documentElement.style.setProperty('--line-height', lineHeight);\n              document.documentElement.style.setProperty('--paragraph-spacing', paragraphSpacing + 'px');\n            }\n            \n            adjustContent();\n            \n            while (content.scrollHeight > availableHeight && fontSize > 10) {\n              fontSize -= 0.5;\n              adjustContent();\n            }\n            \n            while (content.scrollHeight > availableHeight && lineHeight > 1.2) {\n              lineHeight -= 0.05;\n              adjustContent();\n            }\n            \n            while (content.scrollHeight > availableHeight && paragraphSpacing > 4) {\n              paragraphSpacing -= 1;\n              adjustContent();\n            }\n            \n            setTimeout(() => { window.print(); }, 500);\n          }\n        <\/script>\n      </body>\n      </html>\n    ")),r.document.close())},eT=async e=>{var t;let l=eE(e),s=null==q?void 0:q.letterhead_path,r=B.top,n=B.bottom,o=null==s?void 0:s.toLowerCase().endsWith(".pdf"),i='\n      <!DOCTYPE html>\n      <html dir="rtl" lang="ar">\n      <head>\n        <meta charset="UTF-8">\n        <style>\n          @import url(\'https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap\');\n          * { margin: 0; padding: 0; box-sizing: border-box; }\n          body { font-family: \'Tajawal\', sans-serif; direction: rtl; background: #fff; color: #000; line-height: 1.6; }\n          @page { size: A4; margin: 0; }\n          .page-container { width: 210mm; height: 297mm; position: relative; margin: 0 auto; overflow: hidden; }\n          '.concat(!o&&s?"\n          .page-container {\n            background-image: url('".concat(s,"');\n            background-size: 100% 100%; background-repeat: no-repeat; background-position: center;\n          }"):"","\n          .letter-content-wrapper { \n            position: absolute; \n            top: ").concat(r,"px; \n            bottom: ").concat(n,'px; \n            left: 50px; \n            right: 50px; \n            z-index: 1; \n            overflow: hidden;\n          }\n          .letter-content { font-size: 14px; text-align: justify; line-height: 1.6; }\n          .letter-content p { margin-bottom: 10px; }\n          .field { font-weight: bold; color: #000; }\n          h2 { font-size: 18px; margin-bottom: 15px; }\n          table { width: 100%; border-collapse: collapse; margin: 10px 0; }\n          td, th { padding: 8px; border: 1px solid #000; font-size: 14px; }\n        </style>\n      </head>\n      <body>\n        <div class="page-container">\n          <div class="letter-content-wrapper">\n            <div class="letter-content">').concat(l,"</div>\n          </div>\n        </div>\n      </body>\n      </html>\n    "),{jsPDF:c}=await Promise.all([a.e(5033),a.e(3930),a.e(6241)]).then(a.bind(a,55172)),d=(await a.e(4316).then(a.t.bind(a,54264,23))).default,m=document.createElement("iframe");m.style.position="absolute",m.style.left="-9999px",m.style.width="794px",m.style.height="1123px",document.body.appendChild(m);let p=m.contentDocument||(null==(t=m.contentWindow)?void 0:t.document);if(!p)throw Error("Could not access iframe document");p.open(),p.write(i),p.close(),await new Promise(e=>setTimeout(e,500));let h=await d(p.body,{scale:2,useCORS:!0,allowTaint:!0,width:794,height:1123});document.body.removeChild(m);let x=new c({orientation:"portrait",unit:"mm",format:"a4"}),u=h.toDataURL("image/png");return x.addImage(u,"PNG",0,0,210,297),x.output("datauristring").split(",")[1]},ez=async t=>{if(!eu)return;let a=t?null==q?void 0:q.email:eg;if(!a)return void P.oR.error(t?e("email.noCompanyEmail"):e("messages.enterEmail"));if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))return void P.oR.error(e("messages.invalidEmail"));ej(!0);try{let t=await eT(eu),l=await fetch("/api/letters/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipientEmail:a,letterNumber:eu.letter_number,letterType:e("templates.".concat(eu.template_key)),pdfBase64:t})}),s=await l.json();s.success?(P.oR.success(e("messages.emailSendSuccess",{email:a})),ex(!1),eb(null),ef("")):P.oR.error(s.error||e("messages.emailSendError"))}catch(t){console.error("Error sending email:",t),P.oR.error(e("messages.emailSendError"))}finally{ej(!1)}},eR=d.filter(t=>t.letter_number.toLowerCase().includes(U.toLowerCase())||e("templates.".concat(t.template_key)).includes(U)),eL=e=>"string"==typeof e.placeholders?JSON.parse(e.placeholders):e.placeholders;return F?(0,l.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-blue-900 p-4 md:p-8",dir:"ar"===t?"rtl":"ltr",children:(0,l.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,l.jsx)(r.P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-3xl p-8 mb-8 shadow-2xl",children:(0,l.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-center gap-6",children:[(0,l.jsxs)("div",{className:"text-center ".concat("ar"===t?"md:text-right":"md:text-left"),children:[(0,l.jsxs)("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-2 flex items-center gap-3",children:[(0,l.jsx)(m.A,{className:"w-10 h-10"}),e("title")]}),(0,l.jsx)("p",{className:"text-blue-100",children:e("subtitle")})]}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsxs)("button",{onClick:()=>W(!0),className:"bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-xl p-3 text-white transition-all flex items-center gap-2 border border-white/20",title:e("paperSettings"),children:[(0,l.jsx)(p.A,{className:"w-5 h-5"}),(0,l.jsx)("span",{className:"hidden sm:inline",children:e("paperSettings")})]}),q&&(0,l.jsxs)("div",{className:"bg-white/20 backdrop-blur-sm rounded-xl px-4 py-2 text-white border border-white/10",children:[(0,l.jsx)(h.A,{className:"w-5 h-5 inline-block ".concat("ar"===t?"ml-2":"mr-2")}),q.name]})]})]})}),(0,l.jsxs)(r.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},className:"mb-8",children:[(0,l.jsxs)("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[(0,l.jsx)(x.A,{className:"w-5 h-5 text-blue-400"}),e("newLetterTitle")]}),(0,l.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:i.map(a=>{let s=R[a.template_key]||m.A,n=L[a.template_key]||"from-gray-500 to-gray-600";return(0,l.jsxs)(r.P.button,{whileHover:{scale:1.02,y:-3},whileTap:{scale:.98},onClick:()=>(e=>{ee(e),es(null);let t={};("string"==typeof e.placeholders?JSON.parse(e.placeholders):e.placeholders).forEach(e=>{"company_name"===e&&q?t[e]=q.name:"commercial_number"===e&&q?t[e]=q.commercial_number:t[e]=""}),ea(t),Q(!0)})(a),className:"bg-gradient-to-br ".concat(n," p-6 rounded-2xl text-white ").concat("ar"===t?"text-right":"text-left"," shadow-xl hover:shadow-2xl transition-all"),children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,l.jsx)("div",{className:"p-3 bg-white/20 rounded-xl",children:(0,l.jsx)(s,{className:"w-6 h-6"})}),"ar"===t?(0,l.jsx)(u.A,{className:"w-5 h-5 opacity-50"}):(0,l.jsx)(u.A,{className:"w-5 h-5 opacity-50 rotate-180"})]}),(0,l.jsx)("h3",{className:"font-bold text-lg mb-1",children:e("templates.".concat(a.template_key))}),(0,l.jsx)("p",{className:"text-sm text-white/70",children:e("fieldsToFill",{count:eL(a).length})})]},a.id)})})]}),(0,l.jsx)(r.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"bg-white/10 backdrop-blur-xl rounded-2xl p-6 mb-6",children:(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(b.A,{className:"absolute ".concat("ar"===t?"right-4":"left-4"," top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5")}),(0,l.jsx)("input",{type:"text",placeholder:e("searchPlaceholder"),value:U,onChange:e=>I(e.target.value),className:"w-full bg-white/10 border border-white/20 rounded-xl py-3 ".concat("ar"===t?"pr-12 pl-4":"pl-12 pr-4"," text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500")})]})}),(0,l.jsxs)(r.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:[(0,l.jsxs)("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[(0,l.jsx)(m.A,{className:"w-5 h-5 text-blue-400"}),e("createdLettersTitle",{count:eR.length})]}),0===eR.length?(0,l.jsxs)("div",{className:"bg-white/10 backdrop-blur-xl rounded-2xl p-12 text-center",children:[(0,l.jsx)(m.A,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),(0,l.jsx)("h3",{className:"text-xl text-white mb-2",children:e("noLetters")}),(0,l.jsx)("p",{className:"text-slate-400",children:e("noLettersDesc")})]}):(0,l.jsx)("div",{className:"grid gap-4",children:eR.map((a,s)=>{let n=R[a.template_key]||m.A,o=L[a.template_key]||"from-gray-500 to-gray-600";return(0,l.jsx)(r.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*s},className:"bg-white/10 backdrop-blur-xl rounded-2xl p-6 border border-white/10 hover:border-blue-500/50 transition-all",children:(0,l.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,l.jsx)("div",{className:"p-3 rounded-xl bg-gradient-to-br ".concat(o),children:(0,l.jsx)(n,{className:"w-6 h-6 text-white"})}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-1",children:[(0,l.jsx)("span",{className:"bg-blue-500/20 text-blue-400 px-3 py-1 rounded-lg text-sm font-bold",children:a.letter_number}),(0,l.jsx)("span",{className:"px-3 py-1 rounded-lg text-sm font-bold ".concat("active"===a.status?"bg-green-500/20 text-green-400":"cancelled"===a.status?"bg-red-500/20 text-red-400":"bg-yellow-500/20 text-yellow-400"),children:e("status.".concat(a.status))})]}),(0,l.jsx)("h3",{className:"text-lg font-bold text-white",children:e("templates.".concat(a.template_key))}),(0,l.jsxs)("p",{className:"text-slate-400 text-sm flex items-center gap-2",children:[(0,l.jsx)(g.A,{className:"w-4 h-4"}),new Date(a.created_at).toLocaleDateString("ar"===t?"ar-SA":"en-US")]})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("button",{onClick:()=>{ei(a),en(!0)},className:"p-2 bg-blue-500/20 text-blue-400 rounded-lg hover:bg-blue-500/30 transition-all",title:e("actions.preview"),children:(0,l.jsx)(f.A,{className:"w-5 h-5"})}),(0,l.jsx)("button",{onClick:()=>{eb(a),ef(""),ex(!0)},className:"p-2 bg-emerald-500/20 text-emerald-400 rounded-lg hover:bg-emerald-500/30 transition-all",title:e("actions.sendEmail"),children:(0,l.jsx)(w.A,{className:"w-5 h-5"})}),(0,l.jsx)("button",{onClick:()=>(e=>{let t=i.find(t=>t.id===e.template_id);t&&(ee(t),es(e),ea("string"==typeof e.letter_data?JSON.parse(e.letter_data):e.letter_data),Q(!0))})(a),className:"p-2 bg-yellow-500/20 text-yellow-400 rounded-lg hover:bg-yellow-500/30 transition-all",title:e("actions.edit"),children:(0,l.jsx)(j.A,{className:"w-5 h-5"})}),(0,l.jsx)("button",{onClick:()=>eC(a.id),className:"p-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-all",title:e("actions.delete"),children:(0,l.jsx)(y.A,{className:"w-5 h-5"})})]})]})},a.id)})})]}),(0,l.jsx)(n.N,{children:J&&(0,l.jsx)(r.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:e=>e.target===e.currentTarget&&W(!1),children:(0,l.jsxs)(r.P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl border border-white/10",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsxs)("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[(0,l.jsx)(p.A,{className:"w-6 h-6 text-blue-500"})," ",e("settings.title")]}),(0,l.jsx)("button",{onClick:()=>W(!1),className:"text-slate-400 hover:text-white",children:(0,l.jsx)(v.A,{className:"w-6 h-6"})})]}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"bg-slate-700/50 p-6 rounded-xl border border-slate-600",children:[(0,l.jsxs)("label",{className:"block text-white font-bold mb-4 flex items-center gap-2",children:[(0,l.jsx)(N.A,{className:"w-5 h-5 text-blue-400"})," ",e("settings.letterheadLabel")]}),(0,l.jsxs)("div",{className:"relative group",children:[(0,l.jsx)("input",{type:"file",accept:"image/*,.pdf",onChange:e_,className:"hidden",id:"letterhead-upload"}),(0,l.jsx)("label",{htmlFor:"letterhead-upload",className:"cursor-pointer block border-2 border-dashed border-slate-500 hover:border-blue-500 rounded-xl p-8 text-center transition-all bg-slate-800/50",children:Y?(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}):(null==q?void 0:q.letterhead_path)?(0,l.jsxs)("div",{className:"relative",children:[q.letterhead_path.toLowerCase().endsWith(".pdf")?(0,l.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,l.jsx)(m.A,{className:"w-20 h-20 text-red-500"}),(0,l.jsx)("span",{className:"text-white text-sm",children:e("settings.pdfSuccess")}),(0,l.jsx)("span",{className:"text-slate-400 text-xs",children:e("settings.pdfNotice")})]}):(0,l.jsx)("img",{src:q.letterhead_path,alt:"Letterhead",className:"max-h-40 mx-auto rounded shadow-lg"}),(0,l.jsx)("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity rounded",children:(0,l.jsx)("span",{className:"text-white text-sm",children:e("settings.changeFile")})})]}):(0,l.jsxs)("div",{className:"text-slate-400",children:[(0,l.jsx)(N.A,{className:"w-12 h-12 mx-auto mb-2 opacity-20"}),(0,l.jsx)("p",{children:e("settings.dragDrop")})]})})]})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"bg-slate-700/50 p-4 rounded-xl border border-slate-600",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsxs)("label",{className:"text-white font-bold flex items-center gap-2",children:[(0,l.jsx)(_.A,{className:"w-5 h-5 text-blue-400"})," ",e("settings.topMargin")]}),(0,l.jsxs)("span",{className:"bg-blue-500 text-white px-2 py-1 rounded text-sm",children:[B.top,"px"]})]}),(0,l.jsx)("input",{type:"range",min:"0",max:"500",step:"5",value:B.top,onChange:e=>{G({...B,top:parseInt(e.target.value)}),$(!0)},className:"w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-blue-500"})]}),(0,l.jsxs)("div",{className:"bg-slate-700/50 p-4 rounded-xl border border-slate-600",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsxs)("label",{className:"text-white font-bold flex items-center gap-2",children:[(0,l.jsx)(_.A,{className:"w-5 h-5 text-blue-400"})," ",e("settings.bottomMargin")]}),(0,l.jsxs)("span",{className:"bg-blue-500 text-white px-2 py-1 rounded text-sm",children:[B.bottom,"px"]})]}),(0,l.jsx)("input",{type:"range",min:"0",max:"500",step:"5",value:B.bottom,onChange:e=>{G({...B,bottom:parseInt(e.target.value)}),$(!0)},className:"w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-blue-500"})]})]}),(0,l.jsxs)("div",{className:"bg-slate-900/50 rounded-xl p-4",children:[(0,l.jsx)("p",{className:"text-center text-slate-400 text-sm mb-3",children:e("settings.previewMargins")}),(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsxs)("div",{className:"relative bg-white border-2 border-slate-500 overflow-hidden shadow-2xl",style:{width:"200px",height:"283px"},children:[(null==q?void 0:q.letterhead_path)?q.letterhead_path.toLowerCase().endsWith(".pdf")?(0,l.jsxs)("div",{className:"absolute inset-0",children:[(0,l.jsx)("canvas",{ref:ed,className:"w-full h-full object-cover"}),!em&&(0,l.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gradient-to-b from-slate-100 to-slate-200",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mb-2"}),(0,l.jsx)("span",{className:"text-[9px] text-slate-500",children:"Loading PDF..."})]})]}):(0,l.jsx)("img",{src:q.letterhead_path,className:"absolute inset-0 w-full h-full object-cover",alt:"Letterhead"}):(0,l.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-slate-100 text-slate-400",children:[(0,l.jsx)(N.A,{className:"w-10 h-10 mb-2 opacity-30"}),(0,l.jsx)("span",{className:"text-[9px]",children:e("settings.noFileUploaded")})]}),(0,l.jsx)("div",{className:"absolute top-0 left-0 right-0 bg-blue-500/50 border-b-2 border-blue-600 flex items-end justify-center transition-all duration-200",style:{height:"".concat(B.top/1122*283,"px")},children:(0,l.jsxs)("div",{className:"bg-blue-600 text-white text-[8px] font-bold px-2 py-0.5 rounded-t-md mb-[-1px] shadow",children:[B.top,"px"]})}),(0,l.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-blue-500/50 border-t-2 border-blue-600 flex items-start justify-center transition-all duration-200",style:{height:"".concat(B.bottom/1122*283,"px")},children:(0,l.jsxs)("div",{className:"bg-blue-600 text-white text-[8px] font-bold px-2 py-0.5 rounded-b-md mt-[-1px] shadow",children:[B.bottom,"px"]})}),(0,l.jsx)("div",{className:"absolute left-2 right-2 border border-dashed border-green-500/60 bg-green-500/10 flex items-center justify-center transition-all duration-200",style:{top:"".concat(B.top/1122*283,"px"),bottom:"".concat(B.bottom/1122*283,"px")},children:(0,l.jsx)("span",{className:"text-[7px] text-green-600 font-bold bg-white/80 px-1 rounded",children:e("settings.safeZone")})})]})})]}),(0,l.jsx)("div",{className:"flex gap-3",children:(0,l.jsxs)("button",{onClick:async()=>{await ek({letterhead_top_margin:B.top,letterhead_bottom_margin:B.bottom})&&($(!1),P.oR.success(e("messages.updateSuccess")))},disabled:!Z,className:"flex-1 py-3 rounded-xl font-bold flex items-center justify-center gap-2 transition-all ".concat(Z?"bg-blue-500 hover:bg-blue-600 text-white":"bg-slate-700 text-slate-500 cursor-not-allowed"),children:[(0,l.jsx)(k.A,{className:"w-5 h-5"}),e("settings.saveSettings")]})})]})]})})}),(0,l.jsx)(n.N,{children:K&&X&&(0,l.jsx)(r.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:e=>e.target===e.currentTarget&&eA(),children:(0,l.jsxs)(r.P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-slate-800 rounded-2xl p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsxs)("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[(0,l.jsx)(m.A,{className:"w-6 h-6 text-blue-500"})," ",el?e("form.editTitle"):e("form.createTitle",{template:e("templates.".concat(X.template_key))})]}),(0,l.jsx)("button",{onClick:eA,className:"text-slate-400 hover:text-white",children:(0,l.jsx)(v.A,{className:"w-6 h-6"})})]}),(0,l.jsxs)("form",{onSubmit:eS,className:"space-y-4",children:[(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:eL(X).map(t=>(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-slate-300 mb-2 text-sm font-medium",children:ey[t]||t}),(0,l.jsx)("input",{type:t.includes("date")?"date":"text",value:et[t]||"",onChange:e=>ea({...et,[t]:e.target.value}),readOnly:"total_amount"===t||"total_amount_text"===t,className:"w-full bg-slate-700 border border-slate-600 rounded-xl py-3 px-4 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat("total_amount"===t||"total_amount_text"===t?"opacity-75 cursor-not-allowed bg-slate-800":""),placeholder:e("form.placeholderPrefix",{label:ey[t]||t})})]},t))}),(0,l.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,l.jsxs)("button",{type:"submit",className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-bold transition-all flex items-center justify-center gap-2",children:[(0,l.jsx)(k.A,{className:"w-5 h-5"}),el?e("form.saveChanges"):e("form.createLetter")]}),(0,l.jsx)("button",{type:"button",onClick:eA,className:"px-6 bg-slate-600 hover:bg-slate-500 text-white py-3 rounded-xl font-bold transition-all",children:e("form.cancel")})]})]})]})})}),(0,l.jsx)(n.N,{children:er&&eo&&(0,l.jsx)(r.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:e=>e.target===e.currentTarget&&en(!1),children:(0,l.jsxs)(r.P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-2xl w-full max-w-4xl max-h-[95vh] overflow-hidden flex flex-col",children:[(0,l.jsxs)("div",{className:"bg-slate-800 p-4 flex items-center justify-between",children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-white",children:e("preview.title",{number:eo.letter_number})}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("button",{onClick:eP,className:"flex items-center gap-2 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-all",children:[(0,l.jsx)(S.A,{className:"w-5 h-5"})," ",e("preview.print")]}),(0,l.jsxs)("button",{onClick:eP,className:"flex items-center gap-2 bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded-lg transition-all",children:[(0,l.jsx)(C.A,{className:"w-5 h-5"})," ",e("preview.downloadPdf")]}),(0,l.jsx)("button",{onClick:()=>en(!1),className:"text-slate-400 hover:text-white p-2",children:(0,l.jsx)(v.A,{className:"w-6 h-6"})})]})]}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto bg-slate-200 p-4 md:p-8 flex justify-center",children:(0,l.jsxs)("div",{className:"bg-white shadow-2xl origin-top relative overflow-hidden",style:{width:"210mm",height:"297mm",transform:"scale(0.8)"},children:[(null==q?void 0:q.letterhead_path)&&(q.letterhead_path.toLowerCase().endsWith(".pdf")?(0,l.jsx)("iframe",{src:"".concat(q.letterhead_path,"#toolbar=0&navpanes=0&scrollbar=0"),className:"absolute inset-0 w-full h-full border-none pointer-events-none",style:{zIndex:0}}):(0,l.jsx)("div",{className:"absolute inset-0",style:{backgroundImage:"url(".concat(q.letterhead_path,")"),backgroundSize:"100% 100%",backgroundRepeat:"no-repeat",zIndex:0}})),(0,l.jsx)("div",{ref:ec,className:"absolute ".concat("ar"===t?"right-[50px] left-[50px]":"left-[50px] right-[50px]"," z-10 overflow-hidden"),style:{top:"".concat(B.top,"px"),bottom:"".concat(B.bottom,"px")},children:(0,l.jsx)(H,{content:eE(eo),maxHeight:1122-B.top-B.bottom})})]})})]})})}),(0,l.jsx)(n.N,{children:eh&&eu&&(0,l.jsx)(r.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:e=>e.target===e.currentTarget&&!ew&&ex(!1),children:(0,l.jsxs)(r.P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-slate-800 rounded-3xl p-8 w-full max-w-lg shadow-2xl border border-white/10",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsxs)("h2",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[(0,l.jsx)("div",{className:"p-3 bg-emerald-500/20 rounded-xl",children:(0,l.jsx)(w.A,{className:"w-6 h-6 text-emerald-400"})}),e("email.title")]}),(0,l.jsx)("button",{onClick:()=>!ew&&ex(!1),className:"text-slate-400 hover:text-white p-2 rounded-lg hover:bg-white/10 transition-all",disabled:ew,children:(0,l.jsx)(v.A,{className:"w-6 h-6"})})]}),(0,l.jsx)("div",{className:"bg-slate-700/30 rounded-2xl p-4 mb-6 border border-slate-600/50",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:(0,l.jsx)(m.A,{className:"w-5 h-5 text-blue-400"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-white font-bold",children:e("templates.".concat(eu.template_key))}),(0,l.jsx)("p",{className:"text-slate-400 text-sm",children:eu.letter_number})]})]})}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("button",{onClick:()=>ez(!0),disabled:ew||!(null==q?void 0:q.email),className:"w-full p-5 rounded-2xl border-2 transition-all flex items-center gap-4 ".concat((null==q?void 0:q.email)?"bg-gradient-to-r from-emerald-500/10 to-teal-500/10 border-emerald-500/30 hover:border-emerald-500/60 hover:bg-emerald-500/20":"bg-slate-700/30 border-slate-600/30 opacity-50 cursor-not-allowed"),children:[(0,l.jsx)("div",{className:"p-3 bg-emerald-500/20 rounded-xl",children:ew?(0,l.jsx)(A.A,{className:"w-6 h-6 text-emerald-400 animate-spin"}):(0,l.jsx)(h.A,{className:"w-6 h-6 text-emerald-400"})}),(0,l.jsxs)("div",{className:"".concat("ar"===t?"text-right":"text-left"," flex-1"),children:[(0,l.jsx)("p",{className:"text-white font-bold text-lg",children:e("email.sendToCompany")}),(0,l.jsx)("p",{className:"text-slate-400 text-sm",children:(null==q?void 0:q.email)||e("email.noCompanyEmail")})]}),(0,l.jsx)(w.A,{className:"w-5 h-5 text-emerald-400 ".concat("ar"===t?"":"rotate-180")})]}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,l.jsx)("div",{className:"w-full border-t border-slate-600"})}),(0,l.jsx)("div",{className:"relative flex justify-center",children:(0,l.jsx)("span",{className:"bg-slate-800 px-4 text-slate-400 text-sm",children:e("email.or")})})]}),(0,l.jsxs)("div",{className:"bg-slate-700/30 rounded-2xl p-5 border border-slate-600/50",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,l.jsx)("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:(0,l.jsx)(E.A,{className:"w-5 h-5 text-blue-400"})}),(0,l.jsx)("p",{className:"text-white font-bold",children:e("email.sendToOther")})]}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)("input",{type:"email",placeholder:e("email.emailPlaceholder"),value:eg,onChange:e=>ef(e.target.value),disabled:ew,className:"flex-1 bg-slate-800 border border-slate-600 rounded-xl py-3 px-4 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",dir:"ltr"}),(0,l.jsx)("button",{onClick:()=>ez(!1),disabled:ew||!eg,className:"px-6 rounded-xl font-bold flex items-center gap-2 transition-all ".concat(eg&&!ew?"bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white":"bg-slate-700 text-slate-500 cursor-not-allowed"),children:ew?(0,l.jsx)(A.A,{className:"w-5 h-5 animate-spin"}):(0,l.jsx)(w.A,{className:"w-5 h-5 ".concat("ar"===t?"":"rotate-180")})})]})]})]}),ew&&(0,l.jsxs)("div",{className:"mt-6 bg-blue-500/10 border border-blue-500/30 rounded-xl p-4 flex items-center gap-3",children:[(0,l.jsx)(A.A,{className:"w-5 h-5 text-blue-400 animate-spin"}),(0,l.jsx)("p",{className:"text-blue-400 text-sm",children:e("email.sendingStatus")})]})]})})})]})})}},76521:(e,t,a)=>{Promise.resolve().then(a.bind(a,61537))}},e=>{e.O(0,[2084,977,8720,5376,615,3884,8441,1255,7358],()=>e(e.s=76521)),_N_E=e.O()}]);