(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2010],{69829:(e,r,t)=>{Promise.resolve().then(t.bind(t,85312))},85312:(e,r,t)=>{"use strict";t.d(r,{PayrollEditClient:()=>j});var s=t(95155),a=t(12115),l=t(26497),d=t(8751),o=t(42529),n=t(6132),i=t(35299),x=t(89715),c=t(52987),b=t(80647),m=t(91761),p=t(30814),g=t(46046),h=t(52619),u=t.n(h),y=t(20063);function j(e){let r,t,h,{payroll:j,companyId:f}=e,N=(0,y.useRouter)(),[w,v]=(0,a.useState)(!1),[_,k]=(0,a.useState)(j.items||[]),[z,C]=(0,a.useState)({show:!1,type:"success",title:"",message:""}),A=(e,r,t)=>{C({show:!0,type:e,title:r,message:t}),"loading"!==e&&setTimeout(()=>C(e=>({...e,show:!1})),3e3)},F=(0,a.useCallback)(e=>{let r=j.work_type||"salary",t=0,s=0,a=0,l=Number(e.basic_salary)||0,d=Number(e.internal_bonus)||0,o=Number(e.operator_deduction)||0,n=Number(e.internal_deduction)||0,i=Number(e.wallet_deduction)||0,x=Number(e.successful_orders)||0,c=o+n+i;if("salary"===r)t=l+d-c;else if("target"===r){let r=Number(e.target||j.monthly_target||0),o=Number(j.bonus_after_target)||10;x<r?s=r>0?l/r*(r-x):0:a=(x-r)*o,t=l+a+d-s-c}else t=l+d-c;return{...e,target_deduction:s,monthly_bonus:a,net_salary:t}},[j]),S=(e,r,t)=>{k(s=>{let a=[...s];return a[e]={...a[e],[r]:t},a[e]=F(a[e]),a})},O=async()=>{v(!0),A("loading","جاري الحفظ","جاري حفظ التعديلات...");try{let e=await fetch("/api/payrolls/".concat(j.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:_})});if(e.ok)A("success","تم الحفظ بنجاح","تم حفظ التعديلات بنجاح"),setTimeout(()=>{N.push("/payrolls"),N.refresh()},1500);else{let r=await e.json();A("error","فشل الحفظ",r.error||"فشل حفظ التعديلات")}}catch(e){A("error","خطأ","حدث خطأ أثناء الحفظ")}finally{v(!1)}},E=(r=0,t=0,h=0,_.forEach(e=>{e.net_salary>=0&&(r+=e.net_salary),t+=e.successful_orders,h+=e.target_deduction+e.operator_deduction+e.internal_deduction+e.wallet_deduction}),{totalSalary:r,totalOrders:t,totalDeductions:h});return(0,s.jsxs)("div",{className:"h-full flex flex-col",children:[(0,s.jsx)(l.N,{children:z.show&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:()=>"loading"!==z.type&&C(e=>({...e,show:!1}))}),(0,s.jsx)(d.P.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 w-full max-w-md",children:(0,s.jsx)("div",{className:"bg-white rounded-3xl p-8 shadow-2xl border-t-4 ".concat("success"===z.type?"border-emerald-500":"error"===z.type?"border-red-500":"border-blue-500"),children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"h-20 w-20 rounded-full mx-auto mb-6 flex items-center justify-center ".concat("success"===z.type?"bg-emerald-100 text-emerald-500":"error"===z.type?"bg-red-100 text-red-500":"bg-blue-100 text-blue-500"),children:["success"===z.type&&(0,s.jsx)(o.A,{size:40}),"error"===z.type&&(0,s.jsx)(n.A,{size:40}),"loading"===z.type&&(0,s.jsx)(i.A,{size:40,className:"animate-spin"})]}),(0,s.jsx)("h3",{className:"text-2xl font-black text-gray-900 mb-2",children:z.title}),(0,s.jsx)("p",{className:"text-gray-500 mb-6",children:z.message}),"loading"!==z.type&&(0,s.jsx)("button",{onClick:()=>C(e=>({...e,show:!1})),className:"px-8 py-3 rounded-xl font-bold text-white transition-all ".concat("success"===z.type?"bg-emerald-500 hover:bg-emerald-600":"bg-red-500 hover:bg-red-600"),children:"حسناً"})]})})})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-auto p-6",children:(0,s.jsxs)("div",{className:"max-w-[1600px] mx-auto space-y-6",children:[(0,s.jsxs)("div",{className:"relative overflow-hidden bg-gradient-to-br from-[#1a237e] to-[#283593] rounded-2xl p-6 text-white shadow-xl",children:[(0,s.jsx)("div",{className:"relative z-10",children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"h-14 w-14 rounded-xl bg-amber-500 flex items-center justify-center shadow-lg",children:(0,s.jsx)(x.A,{size:28})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-black",children:"تعديل مسير الرواتب"}),(0,s.jsxs)("p",{className:"text-white/60 text-sm",children:[j.payroll_month," - ",j.package_name]})]})]}),(0,s.jsx)(u(),{href:"/payrolls/".concat(j.id),children:(0,s.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/10 text-white font-bold text-sm hover:bg-white/20 transition-all border border-white/10",children:[(0,s.jsx)(c.A,{size:16}),(0,s.jsx)("span",{children:"العودة"})]})})]})}),(0,s.jsx)("div",{className:"absolute top-0 right-0 w-40 h-40 bg-white/5 rounded-full -mr-20 -mt-20 blur-2xl"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-br from-[#1a237e] to-[#283593] px-4 py-3 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-white",children:[(0,s.jsx)(b.A,{size:18}),(0,s.jsx)("h3",{className:"font-bold text-sm",children:"تعديل بيانات الموظفين"})]}),(0,s.jsxs)("span",{className:"bg-white/20 text-white px-2 py-0.5 rounded text-xs font-bold",children:[_.length," موظف"]})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm border-collapse",children:[(0,s.jsx)("thead",{className:"bg-gray-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"الاسم"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"الإقامة"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"الكود"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"الراتب"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"التارقت"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"الطلبات"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"خصم"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"بونص"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"مشغل"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"داخلي"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"محفظة"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"مكافأة"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"صافي"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"الدفع"})]})}),(0,s.jsx)("tbody",{children:_.map((e,r)=>(0,s.jsxs)("tr",{className:"transition-colors duration-150 hover:bg-blue-50/50 ".concat(e.net_salary<0?"bg-red-50 hover:bg-red-100/50":""),children:[(0,s.jsx)("td",{className:"px-3 py-2.5 font-bold text-gray-900 whitespace-nowrap border border-gray-200",children:e.employee_name}),(0,s.jsx)("td",{className:"px-3 py-2.5 text-gray-600 whitespace-nowrap border border-gray-200",children:e.iqama_number}),(0,s.jsx)("td",{className:"px-3 py-2.5 text-gray-600 border border-gray-200",children:e.user_code}),(0,s.jsx)("td",{className:"px-3 py-2.5 font-bold border border-gray-200",children:e.basic_salary}),(0,s.jsx)("td",{className:"px-3 py-2.5 text-gray-600 border border-gray-200",children:e.target}),(0,s.jsx)("td",{className:"px-3 py-2.5 border border-gray-200",children:(0,s.jsx)("input",{type:"number",value:e.successful_orders,onChange:e=>S(r,"successful_orders",parseFloat(e.target.value)||0),className:"w-16 px-2 py-1 rounded-lg border border-gray-200 text-center text-sm focus:border-blue-400 focus:ring-1 focus:ring-blue-200 transition-all",min:"0"})}),(0,s.jsx)("td",{className:"px-3 py-2.5 border border-gray-200",children:(0,s.jsx)("input",{type:"text",value:(Number(e.target_deduction)||0).toFixed(2),readOnly:!0,className:"w-16 px-2 py-1 rounded-lg border border-gray-100 bg-gray-50 text-center text-sm text-red-600"})}),(0,s.jsx)("td",{className:"px-3 py-2.5 border border-gray-200",children:(0,s.jsx)("input",{type:"text",value:(Number(e.monthly_bonus)||0).toFixed(2),readOnly:!0,className:"w-16 px-2 py-1 rounded-lg border border-gray-100 bg-gray-50 text-center text-sm text-emerald-600"})}),(0,s.jsx)("td",{className:"px-3 py-2.5 border border-gray-200",children:(0,s.jsx)("input",{type:"number",value:e.operator_deduction,onChange:e=>S(r,"operator_deduction",parseFloat(e.target.value)||0),className:"w-16 px-2 py-1 rounded-lg border border-gray-200 text-center text-sm focus:border-blue-400 focus:ring-1 focus:ring-blue-200 transition-all",min:"0"})}),(0,s.jsx)("td",{className:"px-3 py-2.5 border border-gray-200",children:(0,s.jsx)("input",{type:"number",value:e.internal_deduction,onChange:e=>S(r,"internal_deduction",parseFloat(e.target.value)||0),className:"w-16 px-2 py-1 rounded-lg border border-gray-200 text-center text-sm focus:border-blue-400 focus:ring-1 focus:ring-blue-200 transition-all",min:"0"})}),(0,s.jsx)("td",{className:"px-3 py-2.5 border border-gray-200",children:(0,s.jsx)("input",{type:"number",value:e.wallet_deduction,onChange:e=>S(r,"wallet_deduction",parseFloat(e.target.value)||0),className:"w-16 px-2 py-1 rounded-lg border border-gray-200 text-center text-sm focus:border-blue-400 focus:ring-1 focus:ring-blue-200 transition-all",min:"0"})}),(0,s.jsx)("td",{className:"px-3 py-2.5 border border-gray-200",children:(0,s.jsx)("input",{type:"number",value:e.internal_bonus,onChange:e=>S(r,"internal_bonus",parseFloat(e.target.value)||0),className:"w-16 px-2 py-1 rounded-lg border border-gray-200 text-center text-sm focus:border-blue-400 focus:ring-1 focus:ring-blue-200 transition-all",min:"0"})}),(0,s.jsx)("td",{className:"px-3 py-2.5 border border-gray-200",children:(0,s.jsx)("input",{type:"text",value:(Number(e.net_salary)||0).toFixed(2),readOnly:!0,className:"w-20 px-2 py-1 rounded-lg border text-center text-sm font-bold ".concat(e.net_salary<0?"bg-red-100 border-red-200 text-red-600":"bg-emerald-50 border-emerald-200 text-emerald-600")})}),(0,s.jsx)("td",{className:"px-3 py-2.5 border border-gray-200",children:(0,s.jsxs)("select",{value:e.payment_method,onChange:e=>S(r,"payment_method",e.target.value),className:"w-20 px-2 py-1 rounded-lg border border-gray-200 text-sm focus:border-blue-400 focus:ring-1 focus:ring-blue-200 transition-all",children:[(0,s.jsx)("option",{value:"مدد",children:"مدد"}),(0,s.jsx)("option",{value:"كاش",children:"كاش"}),(0,s.jsx)("option",{value:"تحويل",children:"تحويل"})]})})]},e.id))})]})}),(0,s.jsx)("div",{className:"bg-gradient-to-r from-gray-50 to-blue-50 p-4 border-t border-gray-100",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-gray-100 text-center",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 text-emerald-600 mb-2",children:[(0,s.jsx)(m.A,{size:18}),(0,s.jsx)("span",{className:"text-sm font-bold",children:"إجمالي الرواتب"})]}),(0,s.jsxs)("p",{className:"text-2xl font-black text-emerald-600",children:[E.totalSalary.toLocaleString("en-US",{minimumFractionDigits:2})," ريال"]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-gray-100 text-center",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 text-blue-600 mb-2",children:[(0,s.jsx)(p.A,{size:18}),(0,s.jsx)("span",{className:"text-sm font-bold",children:"الطلبات الناجحة"})]}),(0,s.jsx)("p",{className:"text-2xl font-black text-blue-600",children:E.totalOrders})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-gray-100 text-center",children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 text-red-600 mb-2",children:[(0,s.jsx)(n.A,{size:18}),(0,s.jsx)("span",{className:"text-sm font-bold",children:"إجمالي الخصومات"})]}),(0,s.jsxs)("p",{className:"text-2xl font-black text-red-600",children:[E.totalDeductions.toLocaleString("en-US",{minimumFractionDigits:2})," ريال"]})]})]})})]}),(0,s.jsxs)("div",{className:"flex justify-center gap-4 pb-6",children:[(0,s.jsx)(u(),{href:"/payrolls/".concat(j.id),children:(0,s.jsxs)("button",{className:"flex items-center gap-2 px-6 py-3 rounded-xl bg-gray-100 text-gray-700 font-bold text-sm hover:bg-gray-200 transition-all",children:[(0,s.jsx)(c.A,{size:16}),(0,s.jsx)("span",{children:"إلغاء"})]})}),(0,s.jsxs)("button",{onClick:O,disabled:w,className:"flex items-center gap-2 px-8 py-3 rounded-xl bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-bold text-sm hover:from-emerald-600 hover:to-teal-600 transition-all disabled:opacity-50 shadow-lg shadow-emerald-500/25",children:[w?(0,s.jsx)(i.A,{size:16,className:"animate-spin"}):(0,s.jsx)(g.A,{size:16}),(0,s.jsx)("span",{children:"حفظ التعديلات"})]})]})]})})]})}}},e=>{e.O(0,[977,2619,3047,8441,1255,7358],()=>e(e.s=69829)),_N_E=e.O()}]);