(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6493],{45726:(e,t,r)=>{"use strict";r.d(t,{PayrollViewClient:()=>A});var s=r(95155),a=r(12115),l=r(26497),n=r(8751),d=r(42529),i=r(6132),o=r(35299),c=r(89715),x=r(52987),m=r(11010),h=r(309),p=r(39867),b=r(71360),g=r(16485),y=r(79397),j=r(91169),u=r(26983),N=r(19408),f=r(20508),w=r(52619),v=r.n(w),_=r(20063),z=r(86550),k=r(94222);function A(e){var t,w,A;let{payroll:S,company:D,companyId:F}=e,P=(0,_.useRouter)(),[C,L]=(0,a.useState)(!1),[U,E]=(0,a.useState)(!1),R=(0,a.useRef)(null),[T,O]=(0,a.useState)({show:!1,type:"success",title:"",message:""}),q=(e,t,r)=>{O({show:!0,type:e,title:t,message:r})},H=()=>{O(e=>({...e,show:!1}))},M=async()=>{if(confirm('هل أنت متأكد من حذف مسير "'.concat(S.payroll_month,'"؟'))){L(!0),q("loading","جاري الحذف","جاري حذف المسير...");try{(await fetch("/api/payrolls/".concat(S.id),{method:"DELETE"})).ok?(q("success","تم الحذف بنجاح","تم حذف المسير بنجاح"),setTimeout(()=>{P.push("/payrolls"),P.refresh()},1500)):q("error","فشل الحذف","فشل حذف المسير")}catch(e){q("error","خطأ","حدث خطأ أثناء الحذف")}finally{L(!1)}}},G=(0,k.useReactToPrint)({contentRef:R,documentTitle:"مسير رواتب - ".concat(S.payroll_month)}),V=async()=>{E(!0);try{let e=(await Promise.all([r.e(4316),r.e(4628)]).then(r.t.bind(r,19589,23))).default,t=R.current;if(!t)return;let s={margin:[10,10,10,10],filename:"مسير-رواتب-".concat(S.payroll_month,".pdf"),image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,letterRendering:!0},jsPDF:{unit:"mm",format:"a4",orientation:"landscape"},pagebreak:{mode:"avoid-all"}};await e().set(s).from(t).save()}catch(e){console.error("Error generating PDF:",e),q("error","خطأ","حدث خطأ أثناء تحميل PDF")}finally{E(!1)}};return(0,s.jsxs)("div",{className:"h-full flex flex-col",children:[(0,s.jsx)(l.N,{children:T.show&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 print:hidden",onClick:()=>"loading"!==T.type&&H()}),(0,s.jsx)(n.P.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 w-full max-w-md print:hidden",children:(0,s.jsx)("div",{className:"bg-white rounded-3xl p-8 shadow-2xl border-t-4 ".concat("success"===T.type?"border-emerald-500":"error"===T.type?"border-red-500":"border-blue-500"),children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"h-20 w-20 rounded-full mx-auto mb-6 flex items-center justify-center ".concat("success"===T.type?"bg-emerald-100 text-emerald-500":"error"===T.type?"bg-red-100 text-red-500":"bg-blue-100 text-blue-500"),children:["success"===T.type&&(0,s.jsx)(d.A,{size:40}),"error"===T.type&&(0,s.jsx)(i.A,{size:40}),"loading"===T.type&&(0,s.jsx)(o.A,{size:40,className:"animate-spin"})]}),(0,s.jsx)("h3",{className:"text-2xl font-black text-gray-900 mb-2",children:T.title}),(0,s.jsx)("p",{className:"text-gray-500 mb-6",children:T.message}),"loading"!==T.type&&(0,s.jsx)("button",{onClick:H,className:"px-8 py-3 rounded-xl font-bold text-white transition-all ".concat("success"===T.type?"bg-emerald-500 hover:bg-emerald-600":"bg-red-500 hover:bg-red-600"),children:"حسناً"})]})})})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-auto p-6 print:p-0",children:(0,s.jsxs)("div",{className:"max-w-[1400px] mx-auto space-y-6",children:[(0,s.jsxs)("div",{className:"relative overflow-hidden bg-gradient-to-br from-[#1a237e] to-[#283593] rounded-2xl p-6 text-white shadow-xl print:hidden",children:[(0,s.jsx)("div",{className:"relative z-10",children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"h-14 w-14 rounded-xl bg-amber-500 flex items-center justify-center shadow-lg",children:(0,s.jsx)(c.A,{size:28})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-black",children:"تفاصيل مسير الرواتب"}),(0,s.jsx)("p",{className:"text-white/60 text-sm",children:S.payroll_month})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsx)(v(),{href:"/payrolls",children:(0,s.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/10 text-white font-bold text-sm hover:bg-white/20 transition-all border border-white/10",children:[(0,s.jsx)(x.A,{size:16}),(0,s.jsx)("span",{children:"القائمة"})]})}),(0,s.jsx)(v(),{href:"/payrolls/".concat(S.id,"/edit"),children:(0,s.jsxs)("button",{className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-amber-500 text-white font-bold text-sm hover:bg-amber-600 transition-all",children:[(0,s.jsx)(m.A,{size:16}),(0,s.jsx)("span",{children:"تعديل"})]})}),(0,s.jsxs)("button",{onClick:()=>G(),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-blue-500 text-white font-bold text-sm hover:bg-blue-600 transition-all",children:[(0,s.jsx)(h.A,{size:16}),(0,s.jsx)("span",{children:"طباعة"})]}),(0,s.jsxs)("button",{onClick:V,disabled:U,className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-blue-500 text-white font-bold text-sm hover:bg-blue-600 transition-all disabled:opacity-50",children:[U?(0,s.jsx)(o.A,{size:16,className:"animate-spin"}):(0,s.jsx)(p.A,{size:16}),(0,s.jsx)("span",{children:"تحميل PDF"})]}),(0,s.jsxs)("button",{onClick:M,disabled:C,className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-red-500 text-white font-bold text-sm hover:bg-red-600 transition-all disabled:opacity-50",children:[C?(0,s.jsx)(o.A,{size:16,className:"animate-spin"}):(0,s.jsx)(b.A,{size:16}),(0,s.jsx)("span",{children:"حذف"})]})]})]})}),(0,s.jsx)("div",{className:"absolute top-0 right-0 w-40 h-40 bg-white/5 rounded-full -mr-20 -mt-20 blur-2xl"})]}),(0,s.jsxs)("div",{ref:R,className:"space-y-6",children:[(0,s.jsx)("style",{children:"\n              @media print {\n                .no-print, .print\\:hidden { display: none !important; }\n                body { \n                  background: white !important; \n                  margin: 0 !important; \n                  padding: 10mm !important;\n                }\n                .print-content { \n                  box-shadow: none !important; \n                  margin: 0 !important; \n                  width: 100% !important; \n                  max-width: 100% !important; \n                  border: none !important;\n                  background: white !important;\n                  -webkit-print-color-adjust: exact !important;\n                  print-color-adjust: exact !important;\n                }\n                @page {\n                  size: A4 landscape;\n                  margin: 0;\n                }\n                * {\n                  -webkit-print-color-adjust: exact !important;\n                  print-color-adjust: exact !important;\n                }\n              }\n            "}),(0,s.jsxs)("div",{className:"print:block hidden text-center mb-6",children:[(0,s.jsxs)("h1",{className:"text-2xl font-black text-gray-900",children:["مسير رواتب ",S.payroll_month]}),(0,s.jsx)("p",{className:"text-gray-500",children:D.name})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsx)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4 print:shadow-none print:border",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"h-10 w-10 rounded-lg bg-blue-50 flex items-center justify-center text-blue-500",children:(0,s.jsx)(g.A,{size:18})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"شهر المسير"}),(0,s.jsx)("p",{className:"font-bold text-gray-900",children:S.payroll_month})]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4 print:shadow-none print:border",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"h-10 w-10 rounded-lg bg-purple-50 flex items-center justify-center text-purple-500",children:(0,s.jsx)(y.A,{size:18})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"الباقة"}),(0,s.jsx)("p",{className:"font-bold text-gray-900",children:S.package_name||"غير محدد"})]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4 print:shadow-none print:border",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"h-10 w-10 rounded-lg bg-teal-50 flex items-center justify-center text-teal-500",children:(0,s.jsx)(j.A,{size:18})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"عدد الموظفين"}),(0,s.jsx)("p",{className:"font-bold text-gray-900",children:(null==(t=S.items)?void 0:t.length)||0})]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4 print:shadow-none print:border",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"h-10 w-10 rounded-lg flex items-center justify-center ".concat(S.is_draft?"bg-amber-50 text-amber-500":"bg-emerald-50 text-emerald-500"),children:S.is_draft?(0,s.jsx)(u.A,{size:18}):(0,s.jsx)(d.A,{size:18})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"الحالة"}),(0,s.jsx)("p",{className:"font-bold text-gray-900",children:S.is_draft?"مسودة":"تم التأكيد"})]})]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4 print:shadow-none print:border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,s.jsx)(N.A,{size:18,className:"text-gray-400"}),(0,s.jsx)("h3",{className:"font-bold text-gray-900",children:"بيانات المنشأة"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"الاسم:"})," ",(0,s.jsx)("span",{className:"font-bold",children:D.name})]}),(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"الرقم الضريبي:"})," ",(0,s.jsx)("span",{className:"font-bold",children:D.vat_number})]}),(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"العنوان:"})," ",(0,s.jsx)("span",{className:"font-bold",children:D.short_address})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-4 print:shadow-none print:border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,s.jsx)(f.A,{size:18,className:"text-gray-400"}),(0,s.jsx)("h3",{className:"font-bold text-gray-900",children:"معلومات المسير"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"أنشئ بواسطة:"})," ",(0,s.jsx)("span",{className:"font-bold",children:S.saved_by||"مدير النظام"})]}),(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"تاريخ الإنشاء:"})," ",(0,s.jsx)("span",{className:"font-bold",children:S.created_at?(0,z.GP)(new Date(S.created_at),"yyyy/MM/dd HH:mm"):"-"})]}),(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"نظام العمل:"})," ",(0,s.jsx)("span",{className:"font-bold",children:(e=>{switch(e){case"salary":return"الراتب الثابت";case"target":return"نظام التارقت";case"tiers":return"نظام الشرائح";case"commission":return"نظام العمولة";default:return e}})(S.work_type)})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden print:shadow-none print:border",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-br from-[#1a237e] to-[#283593] px-4 py-3 flex justify-between items-center print:bg-gray-100",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-white print:text-gray-800",children:[(0,s.jsx)(c.A,{size:18}),(0,s.jsx)("h3",{className:"font-bold text-sm",children:"تفاصيل الرواتب"})]}),(0,s.jsxs)("span",{className:"bg-white/20 text-white px-2 py-0.5 rounded text-xs font-bold print:bg-gray-200 print:text-gray-800",children:[(null==(w=S.items)?void 0:w.length)||0," موظف"]})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm border-collapse",children:[(0,s.jsx)("thead",{className:"bg-gray-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"#"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"الاسم"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"الإقامة"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"الكود"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"الراتب"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"التارقت"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"الطلبات"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"خصم"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"بونص"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"خ.مشغل"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"خ.داخلي"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"خ.محفظة"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"مكافأة"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"صافي"}),(0,s.jsx)("th",{className:"text-right px-3 py-3 text-xs font-bold text-gray-700 border border-gray-200",children:"الدفع"})]})}),(0,s.jsxs)("tbody",{children:[null==(A=S.items)?void 0:A.map((e,t)=>(0,s.jsxs)("tr",{className:"transition-colors duration-150 hover:bg-blue-50/50 ".concat(e.net_salary<0?"bg-red-50 hover:bg-red-100/50":""),children:[(0,s.jsx)("td",{className:"px-3 py-2.5 text-gray-500 border border-gray-200 text-center",children:t+1}),(0,s.jsx)("td",{className:"px-3 py-2.5 font-bold text-gray-900 whitespace-nowrap border border-gray-200",children:e.employee_name}),(0,s.jsx)("td",{className:"px-3 py-2.5 text-gray-600 whitespace-nowrap border border-gray-200",children:e.iqama_number}),(0,s.jsx)("td",{className:"px-3 py-2.5 text-gray-600 border border-gray-200",children:e.user_code}),(0,s.jsx)("td",{className:"px-3 py-2.5 font-bold border border-gray-200",children:Number(e.basic_salary||0).toLocaleString("en-US",{minimumFractionDigits:2})}),(0,s.jsx)("td",{className:"px-3 py-2.5 text-gray-600 border border-gray-200 text-center",children:e.target||0}),(0,s.jsx)("td",{className:"px-3 py-2.5 font-bold text-blue-600 border border-gray-200 text-center",children:e.successful_orders||0}),(0,s.jsx)("td",{className:"px-3 py-2.5 text-red-600 border border-gray-200",children:Number(e.target_deduction||0).toLocaleString("en-US",{minimumFractionDigits:2})}),(0,s.jsx)("td",{className:"px-3 py-2.5 text-emerald-600 border border-gray-200",children:Number(e.monthly_bonus||0).toLocaleString("en-US",{minimumFractionDigits:2})}),(0,s.jsx)("td",{className:"px-3 py-2.5 text-red-600 border border-gray-200",children:Number(e.operator_deduction||0).toLocaleString("en-US",{minimumFractionDigits:2})}),(0,s.jsx)("td",{className:"px-3 py-2.5 text-red-600 border border-gray-200",children:Number(e.internal_deduction||0).toLocaleString("en-US",{minimumFractionDigits:2})}),(0,s.jsx)("td",{className:"px-3 py-2.5 text-red-600 border border-gray-200",children:Number(e.wallet_deduction||0).toLocaleString("en-US",{minimumFractionDigits:2})}),(0,s.jsx)("td",{className:"px-3 py-2.5 text-emerald-600 border border-gray-200",children:Number(e.internal_bonus||0).toLocaleString("en-US",{minimumFractionDigits:2})}),(0,s.jsx)("td",{className:"px-3 py-2.5 font-bold border border-gray-200 ".concat(e.net_salary<0?"text-red-600":"text-emerald-600"),children:Number(e.net_salary||0).toLocaleString("en-US",{minimumFractionDigits:2})}),(0,s.jsx)("td",{className:"px-3 py-2.5 text-gray-600 border border-gray-200 text-center",children:e.payment_method})]},e.id)),(0,s.jsxs)("tr",{className:"bg-emerald-100 font-bold",children:[(0,s.jsx)("td",{colSpan:13,className:"px-3 py-3 text-left text-emerald-800 border border-gray-200",children:"الإجمالي:"}),(0,s.jsxs)("td",{className:"px-3 py-3 text-emerald-800 border border-gray-200",children:[Number(S.total_net||0).toLocaleString("en-US",{minimumFractionDigits:2})," ريال"]}),(0,s.jsx)("td",{className:"border border-gray-200"})]})]})]})})]})]}),(0,s.jsxs)("div",{className:"flex justify-center gap-3 pb-6 print:hidden mt-6",children:[(0,s.jsx)(v(),{href:"/payrolls",children:(0,s.jsxs)("button",{className:"flex items-center gap-2 px-5 py-2.5 rounded-xl bg-gray-100 text-gray-700 font-bold text-sm hover:bg-gray-200 transition-all",children:[(0,s.jsx)(x.A,{size:16}),(0,s.jsx)("span",{children:"العودة"})]})}),(0,s.jsx)(v(),{href:"/payrolls/".concat(S.id,"/edit"),children:(0,s.jsxs)("button",{className:"flex items-center gap-2 px-5 py-2.5 rounded-xl bg-amber-500 text-white font-bold text-sm hover:bg-amber-600 transition-all",children:[(0,s.jsx)(m.A,{size:16}),(0,s.jsx)("span",{children:"تعديل"})]})}),(0,s.jsxs)("button",{onClick:()=>G(),className:"flex items-center gap-2 px-5 py-2.5 rounded-xl bg-blue-500 text-white font-bold text-sm hover:bg-blue-600 transition-all",children:[(0,s.jsx)(h.A,{size:16}),(0,s.jsx)("span",{children:"طباعة"})]}),(0,s.jsxs)("button",{onClick:V,disabled:U,className:"flex items-center gap-2 px-5 py-2.5 rounded-xl bg-blue-500 text-white font-bold text-sm hover:bg-blue-600 transition-all disabled:opacity-50",children:[U?(0,s.jsx)(o.A,{size:16,className:"animate-spin"}):(0,s.jsx)(p.A,{size:16}),(0,s.jsx)("span",{children:"تحميل PDF"})]})]})]})})]})}},79414:(e,t,r)=>{Promise.resolve().then(r.bind(r,45726))}},e=>{e.O(0,[977,2619,6550,9604,8441,1255,7358],()=>e(e.s=79414)),_N_E=e.O()}]);